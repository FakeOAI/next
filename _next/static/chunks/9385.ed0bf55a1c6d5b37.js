"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9385],{49385:function(e,t,r){r.r(t),r.d(t,{TextMessageEditor:function(){return A}});var n,c=r(94521),o=r(17379),a=r(92524),s=r(41141),i=r(61457),l=r(98506),u=r(93747),d=r(15236),f=r(92379),p=r(68306),b=r(62984),j=r(74091),O=r(85734),g=r(86021),v=r(5443),y=r(19841),m=r(651);let h=["className"];function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let x=(0,f.forwardRef)(function(e,t){let{className:r}=e,n=(0,o.Z)(e,h);return(0,m.jsxs)("div",{className:"grid",children:[(0,m.jsx)("textarea",function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach(function(t){(0,c.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({className:(0,y.default)("col-start-1 col-end-2 row-start-1 row-end-2 resize-none overflow-hidden",r),ref:t},n)),(0,m.jsxs)("span",{className:"invisible col-start-1 col-end-2 row-start-1 row-end-2 whitespace-pre-wrap p-2",children:[e.value," "]})]})});var P=r(48572),E=r(73746);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach(function(t){(0,c.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let S=(0,p.vU)({saveAndSubmit:{id:"NodeEditor.saveAndSubmit",defaultMessage:"Save & Submit"},cancel:{id:"NodeEditor.cancel",defaultMessage:"Cancel"}});function C(e){let{initialText:t,clientThreadId:r,currentLeaf:n,onChangeItemInView:c,onExitEdit:o,onRequestCompletion:a,disabled:s,attachments:p}=e,j=(0,f.useId)(),y="".concat(n,"-").concat(j),{0:h,1:w}=(0,f.useState)(null!=t?t:""),k=(0,f.useRef)(null),C=(0,l.BL)(),M=(0,f.useCallback)(e=>{w(e.currentTarget.value)},[]),Z=(0,f.useCallback)(()=>{a({type:O.Os.Next,promptId:y,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!0,completionMetadata:{conversationMode:g.iN.getConversationMode(r)},updateTree:()=>{g.tQ.updateTree(r,e=>{let t=e.getParentId(n);e.addNode(y,h,t,O.uU.User,void 0,p?{attachments:p}:void 0)}),c(y)}}),o(),u.A.logEvent(d.M.changeNode,{intent:"edit_save"})},[p,r,n,y,h,c,a,o]),A=(0,f.useCallback)(()=>{c(n),u.A.logEvent(d.M.changeNode,{intent:"edit_cancel"}),o(),u.A.logEvent(d.M.cancelEditPrompt,{threadId:g.tQ.getServerThreadId(r)})},[n,c,o,r]);(0,f.useEffect)(()=>{let e=k.current;if(e){e.focus();let t=e.value.length;e.setSelectionRange(t,t)}},[]),(0,f.useEffect)(()=>{let e=k.current,t=e=>{"Enter"===e.key&&e.metaKey?Z():"Escape"===e.key&&A()};return e&&e.addEventListener("keydown",t),()=>{e&&e.removeEventListener("keydown",t)}},[A,Z]);let I=p&&p.length>0,_=(0,E.Q)(),z=I&&(0,m.jsx)(D,{children:p.map(e=>(0,m.jsx)(P.Z,{width:C?"normal":"wide",file:e.name,contextConnectorInfo:(0,i.xA)(e.context_connector_info)},e.id))}),R=(0,m.jsx)(x,{ref:k,value:h,onChange:M,className:"m-0 resize-none border-0 bg-transparent p-0 focus:ring-0 focus-visible:ring-0 juice:w-full juice:p-2"});return _?(0,m.jsxs)("div",{className:"rounded-3xl bg-token-main-surface-tertiary px-3 py-2 juice:py-3",children:[z,R,(0,m.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,m.jsx)(v.z,{as:"button",color:"secondary",onClick:A,children:(0,m.jsx)(b.Z,{id:"D9gbPp",defaultMessage:"Cancel"})}),(0,m.jsx)(v.z,{as:"button",onClick:Z,disabled:s,children:(0,m.jsx)(b.Z,{id:"KGxIJG",defaultMessage:"Send"})})]})]}):(0,m.jsxs)(m.Fragment,{children:[z,R,(0,m.jsxs)("div",{className:"mt-2 flex justify-center text-center",children:[(0,m.jsx)(v.z,{as:"button",onClick:Z,className:"mr-2",disabled:s,children:(0,m.jsx)(b.Z,N({},S.saveAndSubmit))}),(0,m.jsx)(v.z,{as:"button",color:"secondary",onClick:A,children:(0,m.jsx)(b.Z,N({},S.cancel))})]})]})}let D=j.Z.div(n||(n=(0,s.Z)(["flex gap-2 flex-wrap"]))),M=["message"];function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function A(e){var t;let{message:r}=e,n=(0,o.Z)(e,M);return(0,m.jsx)(C,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach(function(t){(0,c.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({currentLeaf:r.nodeId,initialText:(0,a.RR)(r.message),attachments:null===(t=r.message.metadata)||void 0===t?void 0:t.attachments},n))}}}]);
//# sourceMappingURL=9385.ed0bf55a1c6d5b37.js.map