"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1214,9042],{19042:function(e,s,t){t.r(s),t.d(s,{DebugModal:function(){return y},DebugModalContents:function(){return M}});var n=t(11550),r=t(39358),l=t(30115),a=t(28146),i=t(24434),c=t(67330),d=t(91111),o=t(97193),u=t(27313),x=t(5132),h=t(30757),f=t(79746),m=t(19841),j=t(38482),g=t.n(j),p=t(92379),b=t(15478),v=t(19229),w=t(651);let k=g()(()=>Promise.all([t.e(3904),t.e(6476)]).then(t.bind(t,16476)).then(e=>e.default),{ssr:!1,loadableGenerated:{webpack:()=>[16476]}});function y(e){let{threadId:s,threadUserId:t}=e;return(0,o.W6)(o.bM.isDebugModalOpen)&&(0,w.jsx)(i.Z,{isOpen:!0,onClose:()=>o.vm.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:(0,w.jsx)(M,{threadId:s,threadUserId:t,onClose:()=>o.vm.toggleDebugModalOpen()})})}let N=(e,s)=>{let t=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),n=window.URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,r.click(),window.URL.revokeObjectURL(n)},_="<|im_start|>",C="<|im_sep|>",O="<|im_end|>";function E(e){let{prompt:s}=e,t=[],n=0;for(;;){let e=s.indexOf(_,n);if(-1===e)break;let r=s.indexOf(C,e);if(-1===r)break;let l=s.indexOf(O,r),a=s.indexOf("<|fim_suffix|>",r);if(-1!==a&&(-1===l||a<l)&&(l=a),-1===l)break;let i=s.substring(e+_.length,r),c=s.substring(r+C.length,l);t.push((0,w.jsxs)("div",{children:[(0,w.jsxs)("span",{className:"font-semibold",children:["[",i,"]"]})," ",c]},e)),n=l+O.length}return t}let L=b.Z.div`mb-[-5px] px-2 pb-1 font-semibold uppercase border-b-2 ${e=>{let{$isSelected:s}=e;return s?"border-black dark:border-white":"border-transparent"}}`;function M(e){let{threadId:s,threadUserId:t,message:r,onClose:i}=e,{sessionUser:o}=(0,d.A)(),{0:f,1:j}=(0,p.useState)(r?"message":"json"),{data:g,isLoading:b,refetch:v}=(0,u.Y)({threadId:s,threadUserId:t,refetchOnMount:"always"}),k=g?.thread;if((0,p.useEffect)(()=>{j(r?"message":k?.turns.length?`turn${k?.turns.length-1}`:"thread")},[k?.turns.length,r]),!b&&!k&&!r)return(0,w.jsxs)(c.bW,{onClickRetry:()=>v(),children:["Failed to load."," "]});if(b)return(0,w.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});let y=k?.turns,_=k?.turns[k.turns.length-1]?.artifacts__?.model_snapshots?.default_id,C=t&&s?(0,x.t5)(t,s):null;return(0,w.jsx)("div",{className:"flex flex-col gap-2 break-words font-mono text-xs",children:(0,w.jsxs)(h.fC,{orientation:"vertical",value:f,onValueChange:e=>j(e),children:[(0,w.jsxs)(h.aV,{className:"flex items-center justify-center gap-2 px-4 py-1",children:[r&&(0,w.jsx)(h.xz,{value:"message",children:(0,w.jsx)(L,{$isSelected:"message"===f,children:"Message"})},"message"),k&&(0,w.jsx)(h.xz,{value:"thread",children:(0,w.jsx)(L,{$isSelected:"thread"===f,children:"Thread"})},"thread"),y?.map((e,s)=>w.jsxs(p.Fragment,{children:[w.jsx(h.xz,{value:`turn${s}`,children:w.jsxs(L,{$isSelected:f===`turn${s}`,children:["Turn[",s,"]"]})},s),e.artifacts__?.debug_ddtrace_urls?.map(e=>w.jsx(L,{$isSelected:!1,children:w.jsxs("a",{target:"_blank",href:e,className:"text-nowrap",children:["Trace[",s,"] â†—"]})},e))]},s)),(0,w.jsx)("div",{className:"flex-grow"}),_&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(F,{name:"Model",id:_})," ",(0,w.jsx)("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),o&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(F,{name:"User ID",id:o.id})," ",(0,w.jsx)("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),C&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(F,{name:"Permalink",id:C}),(0,w.jsx)("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),k&&(0,w.jsxs)(n.z,{size:"small",color:"secondary",onClick:()=>N("thread.json",k),children:[(0,w.jsx)(a._8t,{className:"icon-sm"})," thread.json"]}),(0,w.jsx)(l.P,{onClick:i})]}),y?.map((e,s)=>w.jsxs(h.VY,{value:`turn${s}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[w.jsxs("div",{className:m.default("flex flex-col gap-1 p-6",e.index%2==0&&"bg-token-main-surface-tertiary"),children:[w.jsx(E,{prompt:e.artifacts__?.debug_info?.main_model_response?.prompt_string??""}),w.jsxs("div",{children:[w.jsx("span",{className:"font-semibold",children:"[assistant]"})," ",e.model_response?.text]})]})," "]},s)),k&&(0,w.jsx)(h.VY,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-6",children:(0,w.jsx)(z,{data:k,collapsed:4})}),r&&(0,w.jsx)(h.VY,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-6",children:(0,w.jsx)(z,{data:r,collapsed:4})})]},k?.turns.length??"message")})}function z(e){let{data:s,collapsed:t}=e,{0:n,1:r}=(0,p.useState)(t??!0);return(0,w.jsxs)("div",{className:"flex flex-col items-start gap-1",children:[(0,w.jsx)("button",{onClick:()=>r(!n),className:"flex items-center gap-1",children:n?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(v.rIY,{size:14})," Expand all"]}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(v.NsE,{size:14})," Collapse all"]})}),(0,w.jsx)("div",{className:"w-full",children:(0,w.jsx)(k,{json:s,jsonViewProps:{collapsed:n,shortenTextAfterLength:0}},String(n))})]})}function F(e){let{name:s,id:t}=e,n=(0,p.useCallback)(()=>{(0,f.v)(t)},[t]);return(0,w.jsxs)("div",{className:"flex items-center gap-2 truncate",children:[(0,w.jsxs)("span",{className:"text-nowrap font-semibold",children:[s,":"]}),(0,w.jsx)("span",{title:t,className:"truncate text-gray-500 dark:text-white",children:t}),(0,w.jsx)(r.Z,{onCopy:n})]})}},21214:function(e,s,t){t.r(s),t.d(s,{PermalinkPage:function(){return m}});var n=t(75770),r=t(26925),l=t(27313),a=t(97537),i=t(2428),c=t.n(i),d=t(34977),o=t(92379),u=t(19042),x=t(51837),h=t(651);function f(){return(0,h.jsx)("div",{className:"mt-3 flex justify-center",children:(0,h.jsx)(a.Z,{})})}function m(){return(0,h.jsx)(r.HC,{children:(0,h.jsx)(j,{})})}function j(){let{permalink:e}=(0,d.useRouter)().query;if(!c()(e)||2!==e.length)throw Error("Invalid permalink");let[s,t]=e,{query:a,isLoading:i}=(0,l.v)({threadId:t,threadUserId:s}),m=r.ne.useStore();(0,o.useEffect)(()=>{i||m.setQueryInput(a)},[m,i]);let j=(0,x.L)();return i?(0,h.jsx)(f,{}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(n.u,{}),j&&(0,h.jsx)(u.DebugModal,{threadId:t,threadUserId:s})]})}},27313:function(e,s,t){t.d(s,{Y:function(){return i},v:function(){return c}});var n=t(84760),r=t(92379),l=t(81014),a=t(12381);function i(e){let{threadId:s,threadUserId:t,refetchOnMount:r}=e;return(0,n.a)({queryKey:["thread",s,t],queryFn:async()=>{if(!s)return{thread:null,turns:null};let e=await (0,l.K8)({threadId:s,threadUserId:t}),n=e.turns;return{thread:e,turns:n}},enabled:!!s,refetchOnMount:r})}function c(e){let{threadId:s,threadUserId:t}=e,n=i({threadId:s,threadUserId:t}),l=n.data;return(0,r.useEffect)(()=>{s&&a.P3.setThread(s,l?.turns??[])},[s,l]),{query:n.data?.turns[0]?.user_query,refetch:n.refetch,isLoading:n.isLoading,isError:n.isError}}}}]);
//# sourceMappingURL=1214.4986f5d058794c71.js.map