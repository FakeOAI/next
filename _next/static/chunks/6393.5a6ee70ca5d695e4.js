"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6393],{76393:function(e,t,i){i.r(t),i.d(t,{JITPluginMessage:function(){return R}});var a,s=i(98601),n=i(52088),r=i(99333),l=i(16757),o=i(40743),d=i(24434),c=i(45027),m=i(93866),u=i(55357),g=i(39004),f=i(11550),p=i(99555),y=i(92745),h=i(3551),j=i(75325),_=i(47584),x=i(651);function v(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,a)}return i}function w(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?v(Object(i),!0).forEach(function(t){(0,s.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function P(e){let{action:t,handleUserAction:i,userActionParams:a,displayParams:s}=e;return"deny"===t.type?(0,x.jsx)(f.z,{color:"secondary",size:"small",onClick:()=>{i(w(w({},a),{},{actionData:w({type:"deny"},t.deny)}))},children:(0,x.jsx)(j.Z,w({},"decline"===t.name?M.decline:M.deny))}):"allow"===t.type?(0,x.jsx)(f.z,{color:"primary",size:"small",onClick:()=>{i(w(w({},a),{},{actionData:w({type:"allow"},t.allow)}))},children:(0,x.jsx)(j.Z,w({},"allow"===t.name?M.allow:M.confirm))}):"always_allow"===t.type?(0,x.jsx)(f.z,{color:"secondary",size:"small",onClick:async()=>{i(w(w({},a),{},{actionData:w({type:"always_allow"},t.always_allow)}))},children:(0,x.jsx)(j.Z,w({},M.alwaysAllow))}):"oauth_redirect"===t.type?(0,x.jsx)(f.z,{color:"primary",size:"small",onClick:()=>{b(t.oauth_redirect,a.clientThreadId,a.turnGizmo)},children:(0,x.jsx)(j.Z,w(w({},M.signInButton),{},{values:{domain:s.domain}}))}):"contact_gizmo"===t.type?(0,x.jsx)(f.z,{color:"secondary",size:"small",onClick:async()=>{i(w(w({},a),{},{actionData:w({type:"contact_gizmo"},t.contact_gizmo)}))},children:(0,x.jsx)(j.Z,w({},M.allow))}):null}async function b(e,t,i){let a=y.tQ.getServerThreadId(t),s=y.iN.getConversationMode(t)?.kind===l.OL.GizmoTest,n=a&&!s?(0,h.ZV)(a,i):window.location.href;p.U.doOAuthRedirect(e.gizmo_id,e.gizmo_action_id,e.domain,n,s)}let M=(0,_.vU)({alwaysAllow:{id:"jitPluginMessage.alwaysAllow",defaultMessage:"Always Allow"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},decline:{id:"jitPluginMessage.decline",defaultMessage:"Decline"},confirm:{id:"jitPluginMessage.confirm",defaultMessage:"Confirm"},deny:{id:"jitPluginMessage.deny",defaultMessage:"Deny"},signInButton:{id:"jitPluginMessage.signInButton",defaultMessage:"Sign in with {domain}"}});var O=i(36368),N=i(22433),k=i(34977),S=i(92379),z=i(49764),T=i(15478),D=i(92054),Z=i(99529),I=i(42117),C=i(54028);let U=["oauth_success"];function E(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,a)}return i}function L(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?E(Object(i),!0).forEach(function(t){(0,s.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):E(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let F="openaiFileIdRefs";var A=((a=A||{})[a.Running=0]="Running",a[a.Finished=1]="Finished",a[a.Error=2]="Error",a[a.Stopped=3]="Stopped",a[a.OauthLogin=4]="OauthLogin",a[a.UserConfirmation=5]="UserConfirmation",a[a.Denied=6]="Denied",a[a.Hidden=7]="Hidden",a);function R(e){let t,{messages:i,clientThreadId:a,isLastTurnInConversation:s,onRequestCompletion:d}=e,f=(0,k.useRouter)(),[p,...h]=i,_=(0,z.Z)(),v=(0,y.h9)(),w=(0,y.eV)(a),b=p.message.metadata?.gizmo_id??w,M=(0,y.WA)(a,b),O=(0,u.X)(M)&&M.gizmo_id===b,D=g.b9(b,O)?.data,{0:E,1:R}=(0,S.useState)(!1),q=(0,N.Lx)(p.message.recipient);if(q?.functionName!=null&&D?.tools!=null){for(let e of D.tools)if(function(e,t){if(e.type!==r.qK.JIT_PLUGIN||!e.metadata.json_schema)return!1;let i=!1;return!function e(a){for(let s in a)"operationId"===s&&a[s]===t&&(i=!0),a[s]&&"object"==typeof a[s]&&e(a[s])}(e.metadata.json_schema),i}(e,q.functionName)){t=e;break}}let W=h.filter(e=>e.message.metadata?.jit_plugin_data?.from_server?.type==="debug"),{uiState:$,jitPluginData:K,fileAttachments:Y}=function(e,t,i){if(e.message.metadata?.jit_plugin_data?.from_server?.type==="send_test")return{uiState:A.Hidden};if(e.message.metadata?.jit_plugin_data?.from_server?.type==="debug")return{uiState:A.Stopped};if(t.some(e=>e.message.content.content_type===l.PX.SystemError))return{uiState:A.Error};if((0,C.We)(e.message))return{uiState:A.Stopped};for(let e=t.length-1;e>=0;e--){let a=t[e];if(a.message.metadata?.invoked_plugin){let e=[];return t.forEach(t=>{let i=t.message.metadata?.attachments?.filter(e=>e.display_files_from_actions_ext);i&&e.push(...i)}),{uiState:A.Finished,jitPluginData:a.message.metadata.jit_plugin_data,fileAttachments:e}}let s=H(a.message.metadata?.jit_plugin_data?.from_client);if(null!=s){if(s?.type==="contact_gizmo")return{uiState:A.Finished,jitPluginData:t[e-1]?.message.metadata?.jit_plugin_data};if(s?.type==="deny")return{uiState:A.Denied};if(s?.type==="oauth_success")return{uiState:A.Running,jitPluginData:a.message.metadata?.jit_plugin_data};break}let n=a.message.metadata?.jit_plugin_data?.from_server;if(n?.type==="preview"&&i)return{uiState:A.Running,jitPluginData:a.message.metadata?.jit_plugin_data};if(n?.type==="confirm_action"&&i)return{uiState:A.UserConfirmation,jitPluginData:a.message.metadata?.jit_plugin_data};if(n?.type==="oauth_required"&&i)return{uiState:A.OauthLogin,jitPluginData:a.message.metadata?.jit_plugin_data}}let a=t.find(e=>e.message.author.role===l.uU.Tool&&e.message.author.name?.split(".")[0]==="gizmo_contacts");return a?{uiState:A.Finished,jitPluginData:a.message.metadata?.jit_plugin_data}:{uiState:i?A.Running:A.Stopped}}(p,h.filter(e=>!["debug","send_test"].some(t=>t===e.message.metadata?.jit_plugin_data?.from_server?.type)),s),ee=K?.from_server?.type!=="denied_by_user"?K?.from_server?.body.domain:t?.metadata?.domain,et=t?.metadata?.privacy_policy_url;if((0,S.useEffect)(()=>{if(M?.kind===l.OL.GizmoInteraction&&H(K?.from_client)?.type!=="oauth_success"&&K?.from_server?.type==="oauth_required"&&f.query.oauth_success){let e=f.query,{oauth_success:t}=e,s=(0,n.Z)(e,U);if(t){for(let e of K.from_server.body.actions)if("oauth_redirect"===e.type){X({assistantMessage:p,allMessages:i,clientThreadId:a,onRequestCompletion:d,actionData:{type:"oauth_success",target_message_id:e.oauth_redirect.target_message_id},conversationMode:M});return}f.replace({pathname:f.pathname,query:s})}}},[M,f,p,i,a,d,K,s]),!D)return null;let ei=Z.X.Running,ea=ee?Q.running:Q.starting,es={domain:ee},en=null;if($===A.Hidden)return null;if($===A.OauthLogin||$===A.UserConfirmation){ei=Z.X.Paused,ea=Q.confirmingSimple;let e={gizmoName:D.gizmo.display.name,domain:ee};en=_.formatMessage(Q.confirmParamsTitle,e),es=L(L({},e),{},{title:e=>(0,x.jsxs)("div",{className:"inline-flex items-center gap-1 text-sm",children:[e,(0,x.jsx)(o.Tg4,{className:"icon-sm"})]}),subtitle:e=>(0,x.jsx)("div",{className:"text-xs",children:e})})}else $===A.Finished?(ei=Z.X.Finished,ea=Q.finished,en=_.formatMessage(Q.sentParamsTitle,{gizmoName:D.gizmo.display.name,domain:ee}),es={domain:ee}):$===A.Error?(ei=Z.X.Error,ea=Q.error):($===A.Stopped||$===A.Denied)&&(ei=Z.X.Stopped,ea=$===A.Denied?Q.declined:Q.stopped);let er={assistantMessage:p,allMessages:i,clientThreadId:a,turnGizmo:D,onRequestCompletion:d,conversationMode:M},el={domain:ee},eo=K?.from_server?.type!=="denied_by_user"?K?.from_server?.body.actions.map((e,t)=>x.jsx(P,{action:e,displayParams:el,handleUserAction:X,userActionParams:er},t)):null,ed=ea?_.formatMessage(ea,es):null,ec=T.Z.div`flex gap-2 flex-wrap mt-1 empty:hidden`,em=K?B(K):null,eu=em?.[F]??[],eg=!!em??eu.length>0;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(V,{debugMessages:W}),(0,x.jsx)(I.D,{highlightedCommand:ed,status:ei,showWorkUserSetting:!1,children:eg?(0,x.jsx)(J,{privacyPolicyUrl:et,data:K,isPromptingForPermission:ei===Z.X.Paused}):null}),(0,x.jsx)(ec,{children:Y?.map(e=>x.jsx(c.Z,{file:e.name,fileId:e.id,width:"wide",alwaysShowData:!0,showDownloadButton:!0,downloadLink:e.download_url,contextConnectorInfo:m.xA(e.context_connector_info)},e.id))}),($===A.UserConfirmation||$===A.OauthLogin)&&eo&&!v&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"mb-2 flex gap-2",children:eo}),(0,x.jsxs)("div",{className:"my-1 flex items-center gap-2 text-sm",children:[(0,x.jsx)(o.ETw,{className:"icon-sm"}),(0,x.jsx)(j.Z,L({},Q.confirmingSubtitle))]})]}),null!==en&&(0,x.jsx)(G,{title:en,privacyPolicyUrl:et,data:K,onClose:()=>R(!1),isOpen:E,actionButtons:eo})]})}function q(e){let{messageMetadata:t}=e,{0:i,1:a}=(0,S.useState)(!1);return(0,x.jsxs)("div",{className:"my-2 flex flex-col text-sm",children:[(0,x.jsxs)("div",{className:"flex flex-row items-center hover:cursor-pointer",onClick:()=>{a(!i)},children:[i?(0,x.jsx)(o.Tg4,{className:"icon-sm"}):(0,x.jsx)(o.ob9,{className:"icon-sm"}),(0,x.jsx)("div",{className:"font-semibold",children:t.display_message})]}),i&&(0,x.jsx)("pre",{children:JSON.stringify(t.data,null,2)})]})}function V(e){let{debugMessages:t}=e;return 0===t.length?null:(0,x.jsx)("div",{children:t.map((e,t)=>{let i=e.message.metadata?.jit_plugin_data?.from_server;return i&&"debug"===i.type?(0,x.jsx)(q,{messageMetadata:i.body},t):null})})}function X(e){let{actionData:t,assistantMessage:i,allMessages:a,clientThreadId:s,turnGizmo:n,onRequestCompletion:r,conversationMode:o}=e,d={id:(0,D.Z)(),author:{role:l.uU.Tool,name:i.message.recipient},content:{content_type:l.PX.Text,parts:[""]},recipient:"all",metadata:{jit_plugin_data:{from_client:t}}};o=o??{kind:l.OL.PrimaryAssistant},n?.gizmo.id&&(d.metadata.gizmo_id=n.gizmo.id),y.tQ.updateTree(s,e=>{e.addNode(d.id,d,a[a.length-1].message.id,l.uU.Tool,{completionSampleFinishTime:Date.now()})}),y.tQ.setThreadCurrentLeafId(s,d.id),r({type:l.Os.Next,promptId:d.id,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:o}})}function B(e){if(e.from_server?.type==="confirm_action"||e.from_server?.type==="oauth_required"||e.from_server?.type==="preview")return e.from_server.body.params}function J(e){let{data:t,privacyPolicyUrl:i,isPromptingForPermission:a}=e,s=t?B(t):null,n=(s?.[F]??[]).map((e,t)=>{let i=e.name.startsWith("dalle-"),a=e.name;return i&&(a=`${a}.webp`),(0,x.jsx)(c.Z,{file:a,fileId:e.id},t)});return(0,x.jsxs)("div",{className:"mb-4 mt-1 divide-y divide-token-border-light overflow-hidden rounded-xl border border-token-border-light",children:[(0,x.jsxs)("div",{className:"flex justify-between bg-token-main-surface-tertiary px-4 py-2 text-sm text-token-text-secondary",children:[a?(0,x.jsx)(j.Z,{id:"JITPluginMessage.params.sharing.present",defaultMessage:"The following will be shared:"}):(0,x.jsx)(j.Z,{id:"JITPluginMessage.params.sharing.past",defaultMessage:"The following was shared:"}),i&&(0,x.jsx)("a",{href:(0,O.k)(i),className:"text-token-text-primary",target:"_blank",rel:"noreferrer",children:(0,x.jsx)(j.Z,L({},Q.privacyPolicyLink))})]}),s&&Object.keys(s).map((e,t)=>e===F?null:(0,x.jsxs)("div",{className:"flex items-center space-x-2 px-4 py-2 font-mono",children:[(0,x.jsx)("span",{className:"text-token-text-tertiary",children:`${e}:`}),(0,x.jsx)("span",{children:JSON.stringify(s[e],null,2)})]},t)),n.length>0&&(0,x.jsx)("div",{className:"px-4 py-2",children:n})]})}function W(e){let{title:t,data:i,privacyPolicyUrl:a,actionButtons:s}=e,n=i?B(i):null,r=n?.[F]??[],l=r.filter(e=>!e.mime_type?.startsWith("image/")).map((e,t)=>(0,x.jsx)(c.Z,{file:e.name,fileId:e.id},t)),o=r.filter(e=>e.mime_type?.startsWith("image/")).map((e,t)=>{let i=e.name.startsWith("dalle-"),a=e.name;return i&&(a=`${a}.webp`),(0,x.jsx)(c.Z,{file:a,fileId:e.id},t)});return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"font-semibold",children:t}),n&&Object.keys(n).map((e,t)=>e===F?null:(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)("div",{className:"text-token-text-tertiary",children:e}),(0,x.jsx)("div",{children:JSON.stringify(n[e],null,2)})]},t)),o.length>0&&(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-token-text-tertiary",children:(0,x.jsx)(j.Z,{id:"jitPluginMessage.paramsModalImages",defaultMessage:"Images"})}),o]}),l.length>0&&(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-token-text-tertiary",children:(0,x.jsx)(j.Z,{id:"jitPluginMessage.paramsModalFiles",defaultMessage:"Files"})}),l]}),(0,x.jsxs)("div",{className:"flex flex-row items-center justify-between pt-4",children:[null!==s&&(0,x.jsx)("div",{className:"space-x-2",children:s}),a&&(0,x.jsx)("a",{className:"text-xs font-semibold",href:(0,O.k)(a),children:(0,x.jsx)(j.Z,L({},Q.privacyPolicyLink))})]})]})}function G(e){let{title:t,data:i,privacyPolicyUrl:a,onClose:s,isOpen:n,actionButtons:r}=e;return(0,x.jsx)(d.Z,{isOpen:n,onClose:s,type:"success",hideSeparator:!0,showCloseButton:!0,size:"normal",title:(0,x.jsx)(j.Z,{id:"jitPluginMessage.paramsModalTitle",defaultMessage:"Review action"}),children:(0,x.jsx)("div",{className:"relative flex h-full flex-col gap-2 overflow-hidden",children:(0,x.jsx)("div",{className:"space-y-2",children:(0,x.jsx)(W,{title:t,data:i,privacyPolicyUrl:a,actionButtons:r})})})})}function H(e){if(e&&"user_action"in e){let t=e.user_action;"target_message_id"in(e=L(L({},e),t.data))&&t.target_message_id&&(e.target_message_id=t.target_message_id)}return e}let Q=(0,_.vU)({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirming:{id:"jitPluginMessage.confirmingV4",defaultMessage:"<title>{gizmoName} wants to talk to {domain}</title><subtitle>Only allow sites you trust</subtitle>"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"}})}}]);
//# sourceMappingURL=6393.5a6ee70ca5d695e4.js.map