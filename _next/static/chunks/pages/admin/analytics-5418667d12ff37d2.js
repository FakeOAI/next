(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{51516:function(e,t,r){"use strict";function n(e,t){if(t.length<e)throw TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}r.d(t,{Z:function(){return n}})},92266:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return L},default:function(){return T}});var n,a,i,o,s=r(98601),l=r(34142),c=r(2346),d=r(2721),u=r(84760),f=r(65998),p=r(99661),m=r(11941),g=r.n(m),y=r(92379),b=r(55969),v=r(75172),h=r(62984),w=r(68306),x=r(15478),k=r(651);function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}async function P(e){let{queryKey:[t,{workspaceId:r}]}=e;return d.Z.getWorkspaceAnalytics(r)}function E(e){let{data:t,label:r,getWeekValue:n}=e,a=(0,v.Z)(),i=(0,p.F)().theme,o=(0,y.useMemo)(()=>(function(e){let t=getComputedStyle(document.body);return{animation:!1,scales:{y:{position:"right",beginAtZero:!0,ticks:{stepSize:3,color:t.getPropertyValue("--text-tertiary"),padding:12},grid:{tickLength:0,color:t.getPropertyValue("--border-medium")},border:{display:!1}},x:{grid:{display:!1},ticks:{color:t.getPropertyValue("--text-tertiary"),padding:20}}},plugins:{legend:!1,tooltip:{backgroundColor:t.getPropertyValue("--surface-primary"),titleColor:t.getPropertyValue("--text-primary"),bodyColor:t.getPropertyValue("--text-secondary"),displayColors:!1,padding:{top:8,left:8,right:8,bottom:8}}}}})(0),[i]),s=(0,y.useMemo)(()=>getComputedStyle(document.body).getPropertyValue("--text-secondary"),[i]),l={labels:t.weekly_data.map(e=>a.formatDate(e.week,{month:"numeric",day:"numeric"})),datasets:[{label:r,data:t.weekly_data.map(n),borderWidth:0,backgroundColor:s,barThickness:20}]};return(0,k.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-token-main-surface-secondary p-4",children:(0,k.jsx)(b.$Q,{options:o,data:l,height:192})})}function M(e){let{label:t,value:r}=e;return(0,k.jsxs)("div",{className:"w-1/3 rounded bg-token-main-surface-secondary px-4 py-2",children:[(0,k.jsx)("label",{className:"text-sm text-token-text-secondary",children:t}),(0,k.jsx)("div",{className:"text-xl font-semibold text-token-text-primary",children:r})]})}function F(e){let{data:t}=e,r=(0,v.Z)(),n=t.weekly_data[t.weekly_data.length-2];return(0,k.jsxs)("div",{className:"mt-10",children:[(0,k.jsx)("div",{className:"mb-2 font-semibold text-token-text-primary",children:(0,k.jsx)(h.Z,O({},I.totals))}),(0,k.jsxs)("div",{className:"mb-16 flex gap-4",children:[(0,k.jsx)(M,{label:r.formatMessage(I.usersLabel),value:t.total_users}),(0,k.jsx)(M,{label:r.formatMessage(I.conversationsLabel),value:t.total_conversations}),(0,k.jsx)(M,{label:r.formatMessage(I.messagesLabel),value:t.total_messages})]}),(0,k.jsxs)(_,{children:[(0,k.jsx)("div",{className:"flex flex-col justify-between p-4",children:(0,k.jsxs)("div",{children:[(0,k.jsx)(C,{children:(0,k.jsx)(h.Z,O({},I.usageTitle))}),null!=n&&(0,k.jsxs)("div",{children:[(0,k.jsx)(U,{children:n.message_count}),(0,k.jsx)(A,{children:(0,k.jsx)(h.Z,O({},I.messagesLastWeek))})]})]})}),(0,k.jsx)("div",{children:(0,k.jsx)(E,{data:t,label:r.formatMessage(I.messagesChartLabel),getWeekValue:e=>e.message_count})})]}),(0,k.jsxs)(_,{children:[(0,k.jsx)("div",{children:(0,k.jsx)(E,{data:t,label:r.formatMessage(I.activeUsersChartLabel),getWeekValue:e=>e.active_users_count})}),(0,k.jsx)("div",{className:"flex grow flex-col justify-between p-4",children:(0,k.jsxs)("div",{children:[(0,k.jsx)(C,{children:(0,k.jsx)(h.Z,O({},I.weeklyUsersTitle))}),null!=n&&(0,k.jsxs)("div",{children:[(0,k.jsx)(U,{children:n.active_users_count}),(0,k.jsx)(A,{children:(0,k.jsx)(h.Z,O({},I.activeUsersLastWeek))})]})]})})]})]})}f.kL.register(f.uw,f.f$,f.od,f.ZL,f.Dx,f.u,f.De);let _=x.Z.div(n||(n=(0,c.Z)(["mb-12 grid grid-cols-1 rounded-lg overflow-hidden border border-token-border-light sm:grid-cols-2"]))),C=x.Z.div(a||(a=(0,c.Z)(["font-semibold"]))),U=x.Z.div(i||(i=(0,c.Z)(["font-semibold text-3xl"]))),A=x.Z.div(o||(o=(0,c.Z)(["text-sm text-token-text-tertiary"])));function S(e){let{currentWorkspaceId:t}=e,r=(0,v.Z)(),{data:n,isLoading:a}=(0,u.a)({queryKey:["workspace-analytics",{workspaceId:t}],queryFn:P});return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(g(),{children:(0,k.jsx)("title",{children:r.formatMessage(I.title)})}),(0,k.jsx)(l.yG,{title:r.formatMessage(I.title),subtitle:r.formatMessage(I.pageDescription)}),(0,k.jsx)(l.hb,{showSpinner:a,children:void 0!==n?(0,k.jsx)(F,{data:n}):null})]})}let I=(0,w.vU)({title:{id:"workspaceAnalytics.title",defaultMessage:"Workspace Analytics"},pageDescription:{id:"workspaceAnalytics.understand",defaultMessage:"Understand how your workspace is using ChatGPT"},totals:{id:"workspaceAnalytics.totals",defaultMessage:"Totals over last 30 days"},usersLabel:{id:"workspaceAnalytics.usersLabel",defaultMessage:"Users"},conversationsLabel:{id:"workspaceAnalytics.conversationsLabel",defaultMessage:"Conversations"},messagesLabel:{id:"workspaceAnalytics.messagesLabel",defaultMessage:"Messages"},usageTitle:{id:"workspaceAnalytics.usageTitle",defaultMessage:"Usage"},messagesLastWeek:{id:"workspaceAnalytics.messagesLastWeek",defaultMessage:"Messages processed last week"},messagesLast30Days:{id:"workspaceAnalytics.messagesLast30Days",defaultMessage:"{count, plural, =0 {No messages} one {# message} other {# messages}} processed over last 30 days"},messagesChartLabel:{id:"workspaceAnalytics.messagesChartLabel",defaultMessage:"Messages"},weeklyUsersTitle:{id:"workspaceAnalytics.weeklyUsersTitle",defaultMessage:"Weekly users"},activeUsersChartLabel:{id:"workspaceAnalytics.activeUsersChartLabel",defaultMessage:"Active users"},activeUsersLastWeek:{id:"workspaceAnalytics.activeUsersLastWeek",defaultMessage:"Active users last week"},usersLast30Days:{id:"workspaceAnalytics.usersLast30Days",defaultMessage:"{count, plural, =0 {No active users} one {# active user} other {# active user}} over last 30 days"}});function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var L=!0;function T(e){return(0,k.jsx)(S,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e))}T.getLayout=function(e){return(0,k.jsx)(l.ZP,{mobilePageTitle:"Analytics",requireAdminPrivileges:!0,children:e})}},84082:function(e,t,r){"use strict";r.d(t,{$e:function(){return i},EZ:function(){return o},Ql:function(){return a},dO:function(){return n},xC:function(){return s}});let n=10,a=4,i={duration:20,hasCloseButton:!0},o=512,s=536870912},98628:function(e,t,r){"use strict";r.d(t,{R3:function(){return x},W7:function(){return v},cT:function(){return w},lU:function(){return k},po:function(){return h}});var n=r(98601),a=r(99333),i=r(2721),o=r(92319),s=r(99976),l=r(61619),c=r(82363),d=r(68306),u=r(88815),f=r(24740),p=r(62166),m=r(66114);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let b={duration:20,hasCloseButton:!0};function v(e){return JSON.stringify({file:e.name,modified:e.lastModified,currentTime:new Date().toString()})}function h(e){return new Promise((t,r)=>{let n=new FileReader,a=new Image;n.onload=()=>{a.onload=()=>t(a),a.onerror=e=>r(e),a.src=n.result},n.readAsDataURL(e)})}async function w(e,t,r,n,c,d){var p,m,g;let y=u.N.getState().resetRateLimits,v=a.EG.Initial;s.A.logEvent(l.M.uploadFileInitiated,{client:"web",useCase:n.kind,uploadEntry:"local"});let h=d.usesRetrievalIndex?performance.now():void 0;try{let{file_id:o,upload_url:s}=await i.Z.createFile(t.name,t.size,n,!!y);c.onFileCreated(e,o,s),v=a.EG.FileCreated;let l=n.kind===a.Ei.Gizmo?n.gizmoId:void 0,u=null!==(p=d.shouldUpdateProgress)&&void 0!==p&&p,g=null!==(m=d.usesRetrievalIndex)&&void 0!==m&&m,w=await i.Z.uploadFileToAzureStorage(t,s,t=>{u&&c.onFileUploadProgress(e,10+80*t)});if(c.onFileUploadProgress(e,90),201!==w.status&&O(w,o,g),v=a.EG.FileUploaded,await i.Z.processFileUpload(o,{gizmoId:l}),v=a.EG.FileProcessed,d.usesRetrievalIndex){let t=await j(o,l);(null==t?void 0:t.status)===a.Xf.Skipped&&f.m.danger(r.formatMessage(E.retrievalSkippedFile,{fileName:t.name}),b),c.onFileUploaded(e,o,void 0,{fileTokenSize:t.file_size_tokens}),v=a.EG.RetrievalIndexCreated}else c.onFileUploaded(e,o,d.imageDimensions);null!=h&&i.Z.postRetrievalTiming({e2eLatencyMs:performance.now()-h,type:"file"})}catch(i){P(r,t.name,i);let a="NotInstanceOfError";i instanceof o.gK?a=i.name:i instanceof o.Q0?a="FatalServerError_type_".concat(null!==(g=i.type)&&void 0!==g?g:"undefined"):i instanceof Error?a=i.name:i instanceof o.vq&&(a=i.name),c.onError(e,"error",a,n,v)}}async function x(e,t,r,n,d,u,g){let v=performance.now();s.A.logEvent(l.M.uploadFileInitiated,{client:"web",useCase:r.kind,contextConnector:d.contextConnector,fileSourceType:d.type});let h=a.EG.Initial;r.kind===a.Ei.Gizmo&&(r=y(y({},r),{},{kind:n.includes(t.type)?a.Ei.Multimodal:a.Ei.MyFiles}));try{let n=await i.Z.uploadConnectorAPI(e,d.contextConnector,r,t,u,d.o365DriveId);switch(n.type){case"error":throw function(e){let{status_code:t,error_code:r,error_message:n}=e;if(!t||!(t<500))return new o.Q0(n);{let e="internal_error";return r?e=r:404===t?e="file_not_found":403===t?e="permission_error":413===t&&(e="file_too_large"),new o.vq(n,e)}}(n.error);case"file":switch(p.MP.onFileCreated(e,n.file.id,"",d.contextConnector),h=a.EG.FileProcessed,r.kind){case a.Ei.MyFiles:{p.MP.onFileUploadProgress(e,90);let t=await j(n.file.file_id,u);(null==t?void 0:t.status)===a.Xf.Skipped&&f.m.danger(g.formatMessage(E.retrievalSkippedFile,{fileName:t.name}),b),p.MP.onFileUploaded(e,n.file.file_id,void 0,{fileTokenSize:t.file_size_tokens,mimeType:n.file.mime_type}),h=a.EG.RetrievalIndexCreated;break}case a.Ei.Multimodal:p.MP.onFileUploaded(e,n.file.file_id,{width:512,height:512},{mimeType:n.file.mime_type});break;case a.Ei.AceUpload:p.MP.onFileUploaded(e,n.file.file_id,void 0,{mimeType:n.file.mime_type});break;case a.Ei.DalleAgent:case a.Ei.Gizmo:case a.Ei.ProfilePicture:throw new o.vq("Use case not supported by cloud doc: ".concat(r.kind))}break;case"folder":throw new o.vq("Folder type not supported")}i.Z.postRetrievalTiming({e2eLatencyMs:performance.now()-v,type:d.contextConnector})}catch(n){c.U.addError(Error("Failed to upload connected file by ".concat(d.contextConnector),{cause:n})),P(g,(0,m.Ad)(t.name,null==d?void 0:d.syntheticExtension),n);let r="NotInstanceOfError";if(n instanceof o.Q0){var w;r="FatalServerError_type_".concat(null!==(w=n.type)&&void 0!==w?w:"undefined")}else(n instanceof o.gK||n instanceof Error||n instanceof o.vq)&&(r=n.name);p.MP.onError(e,"error",r,{kind:a.Ei.MyFiles},h)}}async function k(e,t,r,n,a){let{width:i,height:o}=await h(t);return w(e,t,r,{kind:n},a,{imageDimensions:{width:i,height:o}})}async function j(e,t){let r=Date.now()+6e4,n=e=>new Promise(t=>setTimeout(t,e)),s=0;for(;Date.now()<r;){let r=await i.Z.getRetrievalStatus(e,t);if(r.status===a.Xf.Success||r.status===a.Xf.Skipped)return r;if(r.status===a.Xf.Failed)throw new o.vq("Context extraction failed",r.error_code);s++,await n(Math.min(1e3,100*s))}throw new o.vq("Retrieval indexing timed out")}async function O(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n="Unknown error";try{n=await e.data}catch(e){}throw r&&i.Z.markFileUploadFailed(t,{error:n}),new o.vq("File upload to blobstore failed","failed_upload_to_blobstore")}function P(e,t,r){let n=(0,m.kr)(e,"default_upload_error",{fileName:t});r instanceof o.vq&&null!=r.code&&(n=(0,m.kr)(e,r.code)),f.m.danger(n,b)}let E=(0,d.vU)({retrievalSkippedFile:{id:"useFilePickerState.retrievalSkippedFile",defaultMessage:'Unable to extract text from "{fileName}"'}})},62166:function(e,t,r){"use strict";r.d(t,{Dw:function(){return w},HR:function(){return h},MP:function(){return x},gF:function(){return v}});var n=r(98601),a=r(99333),i=r(99976),o=r(61619),s=r(82363),l=r(68306),c=r(68810),d=r(24740),u=r(84082),f=r(93866),p=r(98628),m=r(66114);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let b={files:[],connectorFileData:{}},v=(0,c.Ue)(()=>b),h={hasUploadInProgress:e=>{let{files:t}=e;return t.some(e=>e.status===f.XX.Uploading)},getReadyFiles:e=>{let{files:t}=e;return t.filter(e=>e.status===f.XX.Ready)}},w={reset:()=>{v.setState(b)},uploadFile:async function(e,t,r,n,l){let c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},g=arguments.length>6?arguments[6]:void 0,y=arguments.length>7?arguments[7]:void 0,{gizmoId:b}=c,h=v.getState().files,w=(0,m.xs)(r,t.name,t.type,null==y?void 0:y.contextConnector,g),j={tempId:e,gizmoId:c.gizmoId,status:f.XX.Uploading,file:t,progress:1,fileId:null,cdnUrl:null,contextConnectorInfo:y,contextConnector:null==y?void 0:y.contextConnector};if(h.length===u.dO)i.A.logEvent(o.M.uploadedMaxFilesError),d.m.danger(l.formatMessage(k.maxUploadsAtATime,{maxUploads:u.dO,fileName:t.name}),u.$e);else if(h.some(t=>t.tempId===e))i.A.logEvent(o.M.uploadedDuplicateFileError),d.m.danger(l.formatMessage(k.duplicateFileAttached,{fileName:t.name.length>20?t.name.slice(0,19)+"…":t.name}),u.$e);else{let r;v.setState(e=>{let{files:t}=e;return{files:[...t,j]}});let i={};if(n.includes(t.type)){if(r={kind:a.Ei.Multimodal},!y){let{width:e,height:r}=await (0,p.po)(t);if(e>2048||r>2048)try{let n=await (0,m.Tu)(t,2048),a=await (0,p.po)(n);e=a.width,r=a.height,t=n}catch(e){s.U.addError(Error("Error resizing image:",{cause:e}))}i.imageDimensions={width:e,height:r}}}else switch(w){case f.AJ.Multimodal:throw Error("Multimodal file upload not supported mime type, ".concat(t.type,"\nSupported mime types: ")+n.join(", "));case f.AJ.Interpreter:r={kind:a.Ei.AceUpload};break;case f.AJ.Retrieval:r={kind:a.Ei.MyFiles},i.usesRetrievalIndex=!0;break;case f.AJ.ProfilePicture:throw Error("cannot upload profile picture via uploadFile");case f.AJ.ContextConnector:case f.AJ.None:return}null!=b&&(r={kind:a.Ei.Gizmo,gizmoId:b}),c.skipUpload||(y?await (0,p.R3)(e,t,r,n,y,c.gizmoId,l):await (0,p.cT)(e,t,l,r,x,i))}},createFileCompleted:(e,t,r,n)=>{let a=v.getState().files,i=a.findIndex(t=>t.tempId===e),o=a[i];if(i>=0&&o.status===f.XX.Uploading){let e=[...a];e.splice(i,1,y(y({},o),{},{progress:10,fileId:t,cdnUrl:r,contextConnector:n})),v.setState({files:e})}},updateProgress:(e,t)=>{let r=v.getState().files,n=r.findIndex(t=>t.tempId===e),a=r[n];if(n>=0&&a.status===f.XX.Uploading){let e=[...r];e.splice(n,1,y(y({},a),{},{progress:t})),v.setState({files:e})}},uploadCompleted:(e,t,r,n,a)=>{let s=v.getState().files,l=s.findIndex(t=>t.tempId===e);if(l>=0&&s[l].status===f.XX.Uploading&&null!=s[l].fileId){var c,d,u;let t=s[l],p=[...s],g=y(y({},t),{},{tempId:e,status:f.XX.Ready,progress:100,fileSpec:y(y({name:t.file.name,id:t.fileId,size:t.file.size,contextConnectorInfo:t.contextConnectorInfo,mimeType:null!==(c=null!==(d=null==n?void 0:n.mimeType)&&void 0!==d?d:t.file.type)&&void 0!==c?c:(0,m.s1)(t.file.name)},r||{}),n||{})});p.splice(l,1,g);let b=y({},v.getState().connectorFileData);a&&(b[null==a?void 0:a.file_id]=a),v.setState({files:p,connectorFileData:b}),i.A.logEvent(o.M.uploadFileCompleted,{status:t.status,fileId:t.fileId,contextConnector:null!==(u=t.contextConnector)&&void 0!==u?u:"local"})}},remove:(e,t,r,n,a)=>{let s=v.getState().files,l=s.findIndex(t=>t.tempId===e);if(l>=0){let e=s[l];"error"===t?i.A.logEvent(o.M.uploadFileError,{status:e.status,fileId:e.fileId,client:"web",errorClassName:null!=r?r:"undefined",useCaseType:n,uploadStatus:null!=a?a:"undefined",contextConnector:e.contextConnector}):i.A.logEvent(o.M.removeFile,{status:e.status,fileId:e.fileId});let c=[...s];c.splice(l,1),v.setState({files:c})}}},x={onFileCreated:w.createFileCompleted,onFileUploadProgress:w.updateProgress,onFileUploaded:w.uploadCompleted,onError:w.remove},k=(0,l.vU)({maxUploadsAtATime:{id:"useFilePickerState.maxUploadsAtATime",defaultMessage:"Unable to upload {fileName}. Max {maxUploads} uploads at a time"},duplicateFileAttached:{id:"useFilePickerState.duplicateFileAttached",defaultMessage:"Unable to upload {fileName} because an identical file has already been attached to this message."}})},88815:function(e,t,r){"use strict";r.d(t,{J:function(){return a},N:function(){return i}});var n=r(68810);let a={label:"Auto",value:""},i=(0,n.Ue)(()=>({forceParagen:!1,forceParagenModel:a,forceNulligen:!1,forceIndepthFeedback:!1,forceIndepthFeedbackPrompt:"The user has opted in to provide additional feedback on the previous response. Encourage the user to share feedback that you can store in a memory to better meet their needs in future. Use no more than 3 turns. If at any point the user indicates no longer wanting to provide feedback, return to the original topic.",forceRateLimit:!1,resetRateLimits:!1,showDebugConversationTurns:!1,rebaseSystemMessageContent:null}))},61062:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/analytics",function(){return r(92266)}])}},function(e){e.O(0,[6835,2205,4198,6636,4089,5182,4384,3088,8500,1612,3183,2349,893,5162,7437,4315,6803,8557,9857,211,449,2879,6384,2888,9774,179],function(){return e(e.s=61062)}),_N_E=e.O()}]);
//# sourceMappingURL=analytics-5418667d12ff37d2.js.map