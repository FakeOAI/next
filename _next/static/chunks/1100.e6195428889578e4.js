(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1100],{73216:function(e,t,r){"use strict";r.r(t),r.d(t,{DynamicDrawingCanvas:function(){return d}});var n=r(98601),o=r(52088),a=r(37671),l=r(23763),u=r.n(l),s=r(68003),i=r.n(s),c=r(92379),f=r(651);let p=["drawingCanvasRef"];function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function d(e){let{drawingCanvasRef:t}=e,r=(0,o.Z)(e,p);return(0,f.jsx)(h,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({ref:t},r))}let h=(0,c.forwardRef)(function(e,t){var r;let{color:n,dashedOutlineColor:o,cursorWidth:a,canvasWidth:l,canvasHeight:s,currentDrawnShape:p,onNewDrawnShape:v}=e,d=(0,c.useRef)(null),h=(0,c.useRef)(null),{0:C,1:y}=(0,c.useState)(),{0:O,1:k}=(0,c.useState)(!1);(0,c.useImperativeHandle)(t,()=>({getImageData:()=>{let e=w(d);null!=p&&(g(p),i().view.update());let t=e.getContext("2d")?.getImageData(0,0,e.width,e.height);if(null==t)throw Error("Failed to get image data from canvas");return null!=p&&null!=o&&b(p,new(i()).Color(o)),t}}));let j=(0,c.useMemo)(()=>u()(e=>{if(null!=h.current){let t=m(e.point,w(d)),r=function(e,t,r){let n=e.getDistance(t),o=new(i()).Rectangle(e.subtract([r/2,r/2]),new(i()).Size(n+r,r)),a=new(i()).Size(r/2,r/2),l=new(i()).Path.Rectangle(o,a);return l.rotate(t.subtract(e).angle,e),l}(h.current.prevPoint,t,a);if(null!=h.current.shape){let e=h.current.shape;h.current.shape=h.current.shape.unite(r),e.remove(),r.remove()}else h.current.shape=r;h.current.shape.fillColor=new(i()).Color(n),h.current.prevPoint=t}},50),[n,a]),E=(0,c.useCallback)(e=>j(e),[j]),P=(0,c.useCallback)(()=>{if(j.cancel(),h.current?.shape!=null){let e=new(i()).Path.Rectangle({point:[0,0],size:i().view.size}),t=h.current.shape.intersect(e);t.fillColor=new(i()).Color(n),null!=o&&b(t,new(i()).Color(o)),v(t),h.current.shape.remove(),e.remove()}h.current=null,k(!1)},[j,n,o,v]),x=(0,c.useCallback)(e=>{let t=null;null!=p&&(g(t=p.clone()),p.remove()),h.current={shape:t,prevPoint:m(e.point,w(d))},k(!0)},[p]),D=(0,c.useCallback)(()=>{null!=p&&p.dashArray.length>0&&(p.dashOffset+=.2)},[p]),L=(0,c.useCallback)(e=>{e.preventDefault()},[]),S=(0,c.useCallback)(e=>{"mouse"===e.pointerType&&y(new(i()).Point([e.offsetX,e.offsetY]))},[]),_=(0,c.useCallback)(e=>{"mouse"===e.pointerType&&y(new(i()).Point([e.offsetX,e.offsetY]))},[]),R=(0,c.useCallback)(e=>{"mouse"===e.pointerType&&y(void 0)},[]);(0,c.useEffect)(()=>{i().setup(w(d)),i().view.viewSize=new(i()).Size(l,s)},[]),(0,c.useEffect)(()=>{i().project.activeLayer.removeChildren(),null!=p&&i().project.activeLayer.addChild(p)},[p]),(0,c.useEffect)(()=>{let e=w(d);return e.addEventListener("pointerover",S),e.addEventListener("pointermove",_),e.addEventListener("pointerout",R),e.addEventListener("touchstart",L),()=>{e.removeEventListener("pointerover",S),e.removeEventListener("pointermove",_),e.removeEventListener("pointerout",R),e.removeEventListener("touchstart",L)}},[S,_,R,L]),(0,c.useEffect)(()=>(i().view.on("mousedown",x),i().view.on("mousedrag",E),i().view.on("mouseup",P),i().view.on("frame",D),()=>{i().view.off("mousedown",x),i().view.off("mousedrag",E),i().view.off("mouseup",P),i().view.off("frame",D)}),[x,E,P,D]);let z=d.current?a*(r=d.current).offsetWidth/r.width:a;return(0,f.jsxs)("div",{className:"relative h-full w-full cursor-none",children:[(0,f.jsx)("canvas",{ref:d,width:l,height:s,className:"h-full w-full","data-paper-hidpi":"off"}),C&&(0,f.jsx)("div",{className:"pointer-events-none absolute left-0 top-0 rounded-full border-[3px] shadow-[0_2px_3px_0_rgba(0,0,0,0.25)]",style:{width:`${z}px`,height:`${z}px`,transform:`translate(${C.x-z/2}px, ${C.y-z/2}px) scale(${O?1:1.05})`}})]})});function w(e){return(0,a.S)(e.current)}function m(e,t){return e.multiply(t.width/t.offsetWidth)}function b(e,t){e.strokeColor=t,e.strokeWidth=2,e.strokeCap="round",e.dashArray=[6,8],e.dashOffset=0}function g(e){e.strokeColor=null,e.strokeWidth=0,e.dashArray=[],e.dashOffset=0}},16094:function(){},79465:function(){}}]);
//# sourceMappingURL=1100.e6195428889578e4.js.map