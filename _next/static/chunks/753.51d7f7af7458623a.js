"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[753],{50753:function(e,t,n){n.r(t),n.d(t,{SystemHintSuggestor:function(){return y}});var r=n(92379),i=n(50863),s=n(36348),a=n(28146),c=n(2721),o=n(84760),u=n(19841),l=n(49764),d=n(25009),h=n(651);let p=e=>{let{svgString:t,className:n}=e,r=(0,h.jsx)("div",{className:n});return(0,h.jsx)(d.S,{name:"StringToSVG",fallback:r,children:(0,h.jsx)("div",{className:(0,u.default)("[&_svg]:h-full [&_svg]:w-full",n),dangerouslySetInnerHTML:{__html:t}})})};var f=n(17167),m=n(91399);let g=(0,h.jsx)("span",{children:"..."});function v(e){let{composerController:t}=e,n=(0,o.a)({queryKey:["system-hints"],queryFn:async()=>(await c.Z.getSystemHints()).system_hints.map(e=>{let{name:t,description:n,logo:r,system_hint:i}=e;return{name:t,description:n,logo:r,systemHint:i}}),select:void 0,staleTime:1/0}),{0:s,1:a}=(0,r.useState)([]),u=(0,r.useMemo)(()=>n.data??[],[n.data]),{0:d,1:v}=(0,r.useState)(void 0),{0:y,1:w}=(0,r.useState)(0);(0,r.useEffect)(()=>{d?a(u.filter(e=>e.name.toLowerCase().includes(d.text.toLowerCase()))):a([])},[d,u]);let b=t.useState(e=>e.getSystemHints().length>0);(0,r.useEffect)(()=>{t.view.dispatch(t.view.state.tr.setMeta(m.o4,{onHintMatch:e=>{v(t=>t&&e&&t.text===e.text&&t.range.from===e.range.to&&t.range.to?t:e)}}))},[t]);let j=b||n.data?.length===0||!!n.error||!s.length||!d;(0,r.useEffect)(()=>{j&&w(0)},[j]);let S=s.length,O=(0,r.useCallback)(e=>{w(t=>(e(t)%S+S)%S)},[S]),k=s[y],M=e=>{let{hintToSave:n=k,expectPerfectMatch:r,appendSpace:i=!0}=e;d&&k&&(!r||n.name.toLowerCase()===d.text.toLowerCase())&&((0,m.vt)(t.view,{id:n.systemHint,hint:n.name},d.range,i),(0,f.am)(t.view))},P=(0,r.useRef)(M);P.current=M;let T=(0,r.useRef)(O);T.current=O,(0,r.useRef)(d).current=d;let E=t.view;(0,r.useEffect)(()=>(j||(0,f.$b)(E,e=>{"up"===e?T.current(e=>e-1):"down"===e?T.current(e=>e+1):"cancel"===e?(0,f.am)(E):"submit"===e?(P.current({expectPerfectMatch:!1}),(0,f.am)(E)):"checkMatch"===e&&P.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>(0,f.am)(E)),[j,E]);let C=(0,l.Z)();return j?null:(0,h.jsx)(i.w5,{className:"max-w-60",children:n.isLoading?(0,h.jsx)(x,{title:C.formatMessage({id:"gN/1Ui",defaultMessage:"Loading hints"}),icon:g}):s.map((e,n)=>(0,h.jsx)("div",{children:(0,h.jsx)(i.gG,{autoFocus:!1,className:"rounded-xl px-1 py-2",spoofHovered:n===y,onMouseOver:()=>w(n),onClick:()=>{M({hintToSave:e,expectPerfectMatch:!1}),t.focus()},children:(0,h.jsx)(x,{title:e.name,description:e.description,icon:e.logo?(0,h.jsx)(p,{svgString:e.logo,className:"icon-lg text-token-text-secondary"}):g,checked:!1})})},e.systemHint))})}function x(e){let{title:t,description:n,icon:r,onClick:i,checked:s}=e;return(0,h.jsxs)("div",{className:"inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",onClick:i,children:[(0,h.jsx)("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:r}),(0,h.jsxs)("div",{className:"shrink grow basis-0",children:[(0,h.jsxs)("span",{className:"text-sm font-normal leading-tight text-token-text-primary",children:[t,(0,h.jsx)("br",{})]}),!!n&&(0,h.jsx)("span",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:n})]}),s&&(0,h.jsx)(a.kvR,{className:(0,u.default)("icon-md text-token-text-primary",{"group-hover:hidden":!s})})]})}function y(e){let{composerController:t}=e;return t instanceof s.F?(0,h.jsx)(v,{composerController:t}):null}},36348:function(e,t,n){n.d(t,{F:function(){return u}});var r=n(59749),i=n(92379),s=n(17167),a=n(81945),c=n(91399),o=n(48710);class u extends o.N{constructor(e){super(),this.view=e}isEmpty(){return!this.view.state.doc.textContent}trimLeadingText(e){let t=this.view.state.tr,n=!1,r=!1;return t.doc.descendants((i,s)=>{!n&&i.isText&&(n=!0,i.text?.startsWith(e)&&(r=!0,t.insertText(i.text.replace(e,""),s,s+i.text.length)))}),r&&this.view.dispatch(t),r}replaceAll(e,t){let n=this.view.state.tr,r=[],i=0;n.doc.descendants((e,t)=>{e.isText&&void 0!==e.text&&(r.push({node:e,pos:t}),i=Math.max(i,t))}),r.reverse(),r.forEach(r=>{let{node:i,pos:s}=r;i.isText&&void 0!==i.text&&i.text.includes(e)&&n.insertText(i.text.replaceAll(e,t),s,s+i.text.length)}),this.view.dispatch(n)}appendText(e){this.view.dispatch(this.view.state.tr.insertText(e))}focus(){this.view.dom.focus()}setText(e){let{tr:t,schema:n}=this.view.state,r=e?n.nodes.paragraph.create(null,n.text(e)):n.nodes.paragraph.create();this.view.dispatch(t.replaceWith(0,this.view.state.doc.content.size,r))}getCurrentText(){return this.view.state.doc.textContent}getTextToSend(){let e="";return this.view.state.doc.descendants(t=>{t.isText?e+=t.text:"hard_break"===t.type.name&&(e+="\n")}),e}resize(){}isReady(){return!!this.view.state.doc}setPlaceholder(e){this.view.dispatch(this.view.state.tr.setMeta(a.e,{placeholder:e}))}getSelectionStart(){return this.view.state.selection.ranges[0].$from.pos}acceptLegacyKeydown(){return!s.Mw.getState(this.view.state).active}subscribe(e,t){return this.view.dom?.addEventListener(e,t),()=>{this.view.dom?.removeEventListener(e,t)}}useState(e){return(0,i.useSyncExternalStore)(e=>(0,r.qv)(this.view,e),()=>e(this))}getSystemHints(){let e=(0,c.C6)(this.view.state.tr.doc);return e.length?[e[0]]:[]}}},17167:function(e,t,n){n.d(t,{$b:function(){return u},Mw:function(){return c},_:function(){return l},am:function(){return o}});var r=n(98601),i=n(60314);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let c=new i.H$("menuSelectorPlugin");function o(e){e.dispatch(e.state.tr.setMeta(c,{active:!1,onMenuAction:void 0}))}function u(e,t){e.dispatch(e.state.tr.setMeta(c,{active:!0,onMenuAction:t}))}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{submitKeys:["Enter","Tab"],cancelKeys:["Escape"],checkStrictMatchKeys:[]};return new i.Sy({key:c,state:{init:()=>a(a({},e),{},{active:!1}),apply(e,t){let n=e.getMeta(c);return n?a(a({},t),n):t}},props:{handleKeyDown(e,t){let n=c.getState(e.state);return!!n.active&&(n.submitKeys.includes(t.key)?(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),n.onMenuAction?.("submit"),o(e),!0):n.cancelKeys.includes(t.key)?(t.preventDefault(),n.onMenuAction?.("cancel"),u(e,n.onMenuAction),!0):"ArrowUp"===t.key?(t.preventDefault(),n.onMenuAction?.("up"),!0):"ArrowDown"===t.key?(t.preventDefault(),n.onMenuAction?.("down"),!0):(n.checkStrictMatchKeys.includes(t.key)&&n.onMenuAction?.("checkMatch"),!1))}}})}},81945:function(e,t,n){n.d(t,{c:function(){return a},e:function(){return s}});var r=n(60314),i=n(59231);let s=new r.H$("placeholderPlugin");function a(e){return new r.Sy({key:s,state:{init:()=>({placeholder:e}),apply:(e,t)=>e.getMeta(s)?{placeholder:e.getMeta(s).placeholder}:t},props:{decorations(e){let{doc:t}=e;if(1===t.childCount&&t.firstChild?.isTextblock&&0===t.firstChild.content.size){let n=[],{placeholder:r}=s.getState(e);return e.doc.descendants((e,t)=>{let s=i.p.node(t,t+e.nodeSize,{class:"placeholder","data-placeholder":r});n.push(s)}),i.EH.create(t,n)}}}})}},91399:function(e,t,n){n.d(t,{C6:function(){return h},L:function(){return c},e5:function(){return p},o4:function(){return u},ow:function(){return o},vt:function(){return d}});var r=n(98601),i=n(60314);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let c="command_token",o={group:"inline",inline:!0,atom:!0,content:"text*",attrs:{id:"",hint:""},selectable:!1,draggable:!1,toDOM:e=>["span",{"data-mention-id":e.attrs.id,"data-mention-hint":e.attrs.hint,class:"shimmer-blue"},e.attrs.hint],parseDOM:[{tag:"span[data-mention-id][data-mention-hint]",getAttrs:e=>({id:e.getAttribute("data-mention-id"),hint:e.getAttribute("data-mention-hint")})}]},u=new i.H$("slashCommandPlugin");function l(){return{queryText:"",active:!1,range:void 0}}function d(e,t,n,r){let i=e.state.schema.nodes[c].create(a({},t),e.state.schema.text(t.hint)),s=e.state.tr.replaceWith(n.from,n.to,i);r&&s.insertText(" ",n.from+i.nodeSize),e.dispatch(s)}function h(e){let t=[];return e.descendants(e=>{e.type.name===c&&"string"==typeof e.attrs?.id&&t.push(e.attrs.id)}),t}function p(){return new i.Sy({key:u,state:{init:()=>l(),apply(e,t){let n=e.getMeta(u),r=e.selection,i=function(e){let t=e.before(),n=e.doc.textBetween(t,e.pos,"\n","\0").match(new RegExp(/(^|\s)\/(\w*)$/));if(n&&void 0!==n.index){let t=n[0].startsWith(" ")?n.index+1:n.index,r=n[0].startsWith(" ")?n[0].length-1:n[0].length,i=e.start()+t;return{range:{from:i,to:i+r},queryText:n[2]}}}(r.$from),s=a(a(a({},l()),t),n);return r.from!==r.to||(s.active=!!i,i&&(s.queryText=i.queryText,s.range=i.range)),function(e){let{active:t,range:n,queryText:r,onHintMatch:i}=e;i?i(t&&n?{text:r,range:n}:void 0):void 0}(s),s}}})}},59749:function(e,t,n){n.d(t,{Bi:function(){return s},Vk:function(){return c},qv:function(){return a}});var r=n(60314);let i=new r.H$("transactionEventPlugin"),s="prosemirrorDispatchTransaction";function a(e,t){let{eventTarget:n}=i.getState(e.state);return n.addEventListener(s,t),()=>{n.removeEventListener(s,t)}}function c(e){return new r.Sy({key:i,state:{init:()=>({eventTarget:e}),apply:(e,t)=>t}})}}}]);
//# sourceMappingURL=753.51d7f7af7458623a.js.map