"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5165],{81354:function(e,t,n){n.d(t,{Z:function(){return r}});var i=n(19841),o=n(651);function r(e){let{percentage:t,thickness:n=1/12,className:r,backgroundStrokeClassName:a="stroke-gray-400",transitionDuration:l,transitionTimingFunction:s,onTransitionEnd:d}=e,c=120*n,u=(120-c)/2,f=2*Math.PI*u;return(0,o.jsxs)("svg",{width:120,height:120,viewBox:"0 0 ".concat(120," ").concat(120),className:r,children:[(0,o.jsx)("circle",{className:(0,i.default)("origin-[50%_50%] -rotate-90",a),strokeWidth:c,fill:"transparent",r:u,cx:60,cy:60}),(0,o.jsx)("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:c,strokeDashoffset:f-t/100*f,strokeDasharray:"".concat(f," ").concat(f),fill:"transparent",r:u,cx:60,cy:60,style:{transitionDuration:l,transitionTimingFunction:s},onTransitionEnd:d})]})}},18532:function(e,t,n){n.d(t,{$e:function(){return r},EZ:function(){return a},Ql:function(){return o},dO:function(){return i},xC:function(){return l}});let i=10,o=4,r={duration:20,hasCloseButton:!0},a=512,l=536870912},37234:function(e,t,n){n.d(t,{R3:function(){return w},W7:function(){return g},cT:function(){return y},lU:function(){return F},po:function(){return v}});var i=n(21904),o=n(93223),r=n(91208),a=n(93747),l=n(15236),s=n(59031),d=n(25940),c=n(34565),u=n(94982),f=n(14161),p=n(58543);let m={duration:20,hasCloseButton:!0};function g(e){return JSON.stringify({file:e.name,modified:e.lastModified,currentTime:new Date().toString()})}function v(e){return new Promise((t,n)=>{let i=new FileReader,o=new Image;i.onload=()=>{o.onload=()=>t(o),o.onerror=e=>n(e),o.src=i.result},i.readAsDataURL(e)})}async function y(e,t,n,s,d,f){var p,g,v;let y=c.N.getState().resetRateLimits,w=i.EG.Initial;a.A.logEvent(l.M.uploadFileInitiated,{client:"web",useCase:s.kind,uploadEntry:"local"});let F=f.usesRetrievalIndex?performance.now():void 0;try{let{file_id:r,upload_url:a}=await o.Z.createFile(t.name,t.size,s,!!y);d.onFileCreated(e,r,a),w=i.EG.FileCreated;let l=s.kind===i.Ei.Gizmo?s.gizmoId:void 0,c=null!==(p=f.shouldUpdateProgress)&&void 0!==p&&p,v=null!==(g=f.usesRetrievalIndex)&&void 0!==g&&g,k=await o.Z.uploadFileToAzureStorage(t,a,t=>{c&&d.onFileUploadProgress(e,10+80*t)});if(d.onFileUploadProgress(e,90),201!==k.status&&E(k,r,v),w=i.EG.FileUploaded,await o.Z.processFileUpload(r,{gizmoId:l}),w=i.EG.FileProcessed,f.usesRetrievalIndex){let t=await h(r,l);(null==t?void 0:t.status)===i.Xf.Skipped&&u.m.danger(n.formatMessage(x.retrievalSkippedFile,{fileName:t.name}),m),d.onFileUploaded(e,r,void 0,{fileTokenSize:t.file_size_tokens}),w=i.EG.RetrievalIndexCreated}else d.onFileUploaded(e,r,f.imageDimensions);null!=F&&o.Z.postRetrievalTiming({e2eLatencyMs:performance.now()-F,type:"file"})}catch(o){k(n,t.name,o);let i="NotInstanceOfError";o instanceof r.gK?i=o.name:o instanceof r.Q0?i="FatalServerError_type_".concat(null!==(v=o.type)&&void 0!==v?v:"undefined"):o instanceof Error?i=o.name:o instanceof r.vq&&(i=o.name),d.onError(e,"error",i,s,w)}}async function w(e,t,n,d,c){let g=performance.now();a.A.logEvent(l.M.uploadFileInitiated,{client:"web",useCase:n.kind,contextConnector:d.contextConnector,fileSourceType:d.type});let v=i.EG.Initial;try{let a=await o.Z.uploadConnectorAPI(e,d.contextConnector,n,t,void 0,d.o365DriveId);switch(a.type){case"error":throw function(e){let{status_code:t,error_code:n,error_message:i}=e;if(!t||!(t<500))return new r.Q0(i);{let e="internal_error";return n?e=n:404===t?e="file_not_found":403===t?e="permission_error":413===t&&(e="file_too_large"),new r.vq(i,e)}}(a.error);case"file":switch(f.MP.onFileCreated(e,a.file.id,"",d.contextConnector),v=i.EG.FileProcessed,n.kind){case i.Ei.MyFiles:{f.MP.onFileUploadProgress(e,90);let t=await h(a.file.file_id);(null==t?void 0:t.status)===i.Xf.Skipped&&u.m.danger(c.formatMessage(x.retrievalSkippedFile,{fileName:t.name}),m),f.MP.onFileUploaded(e,a.file.file_id,void 0,{fileTokenSize:t.file_size_tokens,mimeType:a.file.mime_type}),v=i.EG.RetrievalIndexCreated;break}case i.Ei.Multimodal:f.MP.onFileUploaded(e,a.file.file_id,{width:512,height:512},{mimeType:a.file.mime_type});break;case i.Ei.AceUpload:f.MP.onFileUploaded(e,a.file.file_id,void 0,{mimeType:a.file.mime_type});break;case i.Ei.DalleAgent:case i.Ei.Gizmo:case i.Ei.ProfilePicture:throw new r.vq("Use case not supported by cloud doc: ".concat(n.kind))}break;case"folder":throw new r.vq("Folder type not supported")}o.Z.postRetrievalTiming({e2eLatencyMs:performance.now()-g,type:d.contextConnector})}catch(o){s.U.addError(Error("Failed to upload connected file by ".concat(d.contextConnector),{cause:o})),k(c,(0,p.Ad)(t.name,null==d?void 0:d.syntheticExtension),o);let n="NotInstanceOfError";if(o instanceof r.Q0){var y;n="FatalServerError_type_".concat(null!==(y=o.type)&&void 0!==y?y:"undefined")}else(o instanceof r.gK||o instanceof Error||o instanceof r.vq)&&(n=o.name);f.MP.onError(e,"error",n,{kind:i.Ei.MyFiles},v)}}async function F(e,t,n,i,o){let{width:r,height:a}=await v(t);return y(e,t,n,{kind:i},o,{imageDimensions:{width:r,height:a}})}async function h(e,t){let n=Date.now()+6e4,a=e=>new Promise(t=>setTimeout(t,e)),l=0;for(;Date.now()<n;){let n=await o.Z.getRetrievalStatus(e,t);if(n.status===i.Xf.Success||n.status===i.Xf.Skipped)return n;if(n.status===i.Xf.Failed)throw new r.vq("Context extraction failed",n.error_code);l++,await a(Math.min(1e3,100*l))}throw new r.vq("Retrieval indexing timed out")}async function E(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i="Unknown error";try{i=await e.data}catch(e){}throw n&&o.Z.markFileUploadFailed(t,{error:i}),new r.vq("File upload to blobstore failed","failed_upload_to_blobstore")}function k(e,t,n){let i=(0,p.kr)(e,"default_upload_error",{fileName:t});n instanceof r.vq&&null!=n.code&&(i=(0,p.kr)(e,n.code)),u.m.danger(i,m)}let x=(0,d.vU)({retrievalSkippedFile:{id:"useFilePickerState.retrievalSkippedFile",defaultMessage:'Unable to extract text from "{fileName}"'}})},14161:function(e,t,n){n.d(t,{Dw:function(){return h},HR:function(){return F},MP:function(){return E},gF:function(){return w}});var i=n(94521),o=n(21904),r=n(93747),a=n(15236),l=n(59031),s=n(25940),d=n(68810),c=n(94982),u=n(18532),f=n(61457),p=n(37234),m=n(58543);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let y={files:[],connectorFileData:{}},w=(0,d.Ue)(()=>y),F={hasUploadInProgress:e=>{let{files:t}=e;return t.some(e=>e.status===f.XX.Uploading)},getReadyFiles:e=>{let{files:t}=e;return t.filter(e=>e.status===f.XX.Ready)}},h={reset:()=>{w.setState(y)},uploadFile:async function(e,t,n,i,s){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},g=arguments.length>6?arguments[6]:void 0,v=arguments.length>7?arguments[7]:void 0,{gizmoId:y}=d,F=w.getState().files,h=(0,m.xs)(n,t.name,t.type,null==v?void 0:v.contextConnector,g),x={tempId:e,gizmoId:d.gizmoId,status:f.XX.Uploading,file:t,progress:1,fileId:null,cdnUrl:null,contextConnectorInfo:v,contextConnector:null==v?void 0:v.contextConnector};if(F.length===u.dO)r.A.logEvent(a.M.uploadedMaxFilesError),c.m.danger(s.formatMessage(k.maxUploadsAtATime,{maxUploads:u.dO,fileName:t.name}),u.$e);else if(F.some(t=>t.tempId===e))r.A.logEvent(a.M.uploadedDuplicateFileError),c.m.danger(s.formatMessage(k.duplicateFileAttached,{fileName:t.name.length>20?t.name.slice(0,19)+"â€¦":t.name}),u.$e);else{let n;w.setState(e=>{let{files:t}=e;return{files:[...t,x]}});let r={};if(i.includes(t.type)){if(n={kind:o.Ei.Multimodal},!v){let{width:e,height:n}=await (0,p.po)(t);if(e>2048||n>2048)try{let i=await (0,m.Tu)(t,2048),o=await (0,p.po)(i);e=o.width,n=o.height,t=i}catch(e){l.U.addError(Error("Error resizing image:",{cause:e}))}r.imageDimensions={width:e,height:n}}}else switch(h){case f.AJ.Multimodal:throw Error("Multimodal file upload not supported mime type, ".concat(t.type,"\nSupported mime types: ")+i.join(", "));case f.AJ.Interpreter:n={kind:o.Ei.AceUpload};break;case f.AJ.Retrieval:n={kind:o.Ei.MyFiles},r.usesRetrievalIndex=!0;break;case f.AJ.ProfilePicture:throw Error("cannot upload profile picture via uploadFile");case f.AJ.ContextConnector:case f.AJ.None:return}null!=y&&(n={kind:o.Ei.Gizmo,gizmoId:y}),d.skipUpload||(v?await (0,p.R3)(e,t,n,v,s):await (0,p.cT)(e,t,s,n,E,r))}},createFileCompleted:(e,t,n,i)=>{let o=w.getState().files,r=o.findIndex(t=>t.tempId===e),a=o[r];if(r>=0&&a.status===f.XX.Uploading){let e=[...o];e.splice(r,1,v(v({},a),{},{progress:10,fileId:t,cdnUrl:n,contextConnector:i})),w.setState({files:e})}},updateProgress:(e,t)=>{let n=w.getState().files,i=n.findIndex(t=>t.tempId===e),o=n[i];if(i>=0&&o.status===f.XX.Uploading){let e=[...n];e.splice(i,1,v(v({},o),{},{progress:t})),w.setState({files:e})}},uploadCompleted:(e,t,n,i,o)=>{let l=w.getState().files,s=l.findIndex(t=>t.tempId===e);if(s>=0&&l[s].status===f.XX.Uploading&&null!==l[s].fileId){var d,c,u;let t=l[s],p=[...l],g=v(v({},t),{},{tempId:e,status:f.XX.Ready,progress:100,fileSpec:v(v({name:t.file.name,id:t.fileId,size:t.file.size,contextConnectorInfo:t.contextConnectorInfo,mimeType:null!==(d=null!==(c=null==i?void 0:i.mimeType)&&void 0!==c?c:t.file.type)&&void 0!==d?d:(0,m.s1)(t.file.name)},n||{}),i||{})});p.splice(s,1,g);let y=v({},w.getState().connectorFileData);o&&(y[null==o?void 0:o.file_id]=o),w.setState({files:p,connectorFileData:y}),r.A.logEvent(a.M.uploadFileCompleted,{status:t.status,fileId:t.fileId,contextConnector:null!==(u=t.contextConnector)&&void 0!==u?u:"local"})}},remove:(e,t,n,i,o)=>{let l=w.getState().files,s=l.findIndex(t=>t.tempId===e);if(s>=0){let e=l[s];"error"===t?r.A.logEvent(a.M.uploadFileError,{status:e.status,fileId:e.fileId,client:"web",errorClassName:null!=n?n:"undefined",useCaseType:i,uploadStatus:null!=o?o:"undefined",contextConnector:e.contextConnector}):r.A.logEvent(a.M.removeFile,{status:e.status,fileId:e.fileId});let d=[...l];d.splice(s,1),w.setState({files:d})}}},E={onFileCreated:h.createFileCompleted,onFileUploadProgress:h.updateProgress,onFileUploaded:h.uploadCompleted,onError:h.remove},k=(0,s.vU)({maxUploadsAtATime:{id:"useFilePickerState.maxUploadsAtATime",defaultMessage:"Unable to upload {fileName}. Max {maxUploads} uploads at a time"},duplicateFileAttached:{id:"useFilePickerState.duplicateFileAttached",defaultMessage:"Unable to upload {fileName} because an identical file has already been attached to this message."}})},34565:function(e,t,n){n.d(t,{J:function(){return o},N:function(){return r}});var i=n(68810);let o={label:"Auto",value:""},r=(0,i.Ue)(()=>({forceParagen:!1,forceNulligen:!1,forceParagenModel:o,forceRateLimit:!1,resetRateLimits:!1,showDebugConversationTurns:!1,rebaseSystemMessageContent:null}))}}]);
//# sourceMappingURL=5165-b8162d9bffddbe56.js.map