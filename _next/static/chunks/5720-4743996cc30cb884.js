"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5720],{29707:function(e,t,i){i.d(t,{YK:function(){return r},ai:function(){return n},nJ:function(){return l}});var s=i(16645);function a(e){return e==s.Zz.User||e==s.Zz.Group?s.Zz.Private:e==s.Zz.WorkspaceLink?s.Zz.Workspace:e}function r(e,t){return e=a(e),void 0!==t&&t.some(t=>t.recipient===e&&t.allowed)}function n(e,t){if(void 0===t)return[];e=a(e);let i=t.find(t=>t.recipient===e);return null==i?void 0:i.moderated_fields}function l(e,t){let i=n(e,t);return i&&i.length>0}i(651)},81892:function(e,t,i){i.d(t,{JE:function(){return A},MU:function(){return F},Te:function(){return S},UJ:function(){return T},z$:function(){return E}});var s,a,r,n,l,o=i(94521),d=i(41141),c=i(8649),u=i(49217),m=i(82823),p=i(56029),g=i(16645),f=i(4702),h=i(35226),x=i(48580),v=i(82920),j=i(91530),b=i.n(j),y=i(92379),w=i(25940),k=i(72256),z=i(26123),N=i(74091),P=i(29707),M=i(651);function Z(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function C(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(i),!0).forEach(function(t){(0,o.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let O=N.Z.a(n||(n=(0,d.Z)(["bold underline"]))),_=N.Z.textarea(l||(l=(0,d.Z)(["w-full text-sm overflow-y-auto rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 border-token-border-medium bg-token-main-surface-primary h-32"]))),T=((s={})[s.None=0]="None",s[s.AppealAvailable=1]="AppealAvailable",s[s.AppealSent=2]="AppealSent",s),S=((a={})[a.None=0]="None",a[a.PublishBlocked=1]="PublishBlocked",a[a.RemovedFromMarketplace=2]="RemovedFromMarketplace",a[a.RemovedFromPublic=3]="RemovedFromPublic",a[a.RemovedFromPrivate=4]="RemovedFromPrivate",a[a.Recategorized=5]="Recategorized",a);function E(e){var t;if(!e)return;let i=(null===(t=e.gizmo.appeal_info)||void 0===t?void 0:t.state.kind)==="appeal_sent",s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=new Set(t.filter(e=>e.allowed).map(e=>e.recipient));if(!e||(e in I&&(e=I[e]),i.has(e)))return S.None;let s=i.has(g.Zz.Private)||i.has(g.Zz.Workspace),a=i.has(g.Zz.Link)||i.has(g.Zz.Marketplace);return e===g.Zz.Marketplace&&a?S.RemovedFromMarketplace:!a&&s?S.RemovedFromPublic:S.RemovedFromPrivate}(e.gizmo.share_recipient,e.gizmo.sharing_targets);return{sharingRecipient:e.gizmo.share_recipient,categories:e.gizmo.categories,gizmoId:e.gizmo.id,moderationType:s,sharingTargets:e.gizmo.sharing_targets,showModal:i?T.AppealSent:s!==S.None?T.AppealAvailable:T.None}}let I={[g.Zz.User]:g.Zz.Private,[g.Zz.Group]:g.Zz.Private,[g.Zz.WorkspaceLink]:g.Zz.Workspace};function L(e){switch(e){case S.None:case S.PublishBlocked:return(0,w.Em)({id:"gizmo.appeals.publishBlockedTitle",defaultMessage:"Your changes couldn’t be published"});case S.RemovedFromMarketplace:return(0,w.Em)({id:"gizmo.appeals.removedFromMarketplaceTitle",defaultMessage:"Your GPT has been removed from the marketplace"});case S.RemovedFromPublic:return(0,w.Em)({id:"gizmo.appeals.removedFromPublicTitle",defaultMessage:"Your GPT has been removed from public view"});case S.Recategorized:return(0,w.Em)({id:"gizmo.appeals.recategorizedTitle",defaultMessage:"Your GPT has been recategorized"});default:(0,v.ZP)(e)}}function A(e){let{sharingRecipient:t,moderatedFields:i,appealAvailable:s}=e,a=i.length;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)("p",{children:[(0,M.jsx)(k.Z,C(C({},function(e){switch(e){case g.Zz.Private:case g.Zz.Workspace:return(0,w.Em)({id:"gizmo.appeals.privateRecipientModerationText",defaultMessage:"Your GPT can’t be updated because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case g.Zz.Link:return(0,w.Em)({id:"gizmo.appeals.linkRecipientModerationText",defaultMessage:"Your GPT can’t be shared publicly because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});case g.Zz.Marketplace:return(0,w.Em)({id:"gizmo.appeals.marketplaceRecipientModerationText",defaultMessage:"Your GPT can’t appear in the Explore GPTs page because it violates our {usagePolicyLink}Usage Policies{usagePolicyLink}."});default:(0,v.ZP)(e)}}(t)),{},{values:{usagePolicyLink:e=>(0,M.jsx)(O,{target:"_blank",href:"https://openai.com/policies/usage-policies",rel:"noreferrer",children:e})}}))," ",a>0&&(0,M.jsx)(k.Z,{id:"gizmo.appeals.seeBelowForSpecificIssues",defaultMessage:"{numModeratedFields, plural, one {See below for the specific issue:} other {See below for the specific issues:} }",values:{numModeratedFields:a}})]}),a>0&&(null==i?void 0:i.map(e=>(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("p",{className:"font-bold",children:(0,M.jsx)(k.Z,C({},function(e){switch(e){case"profile_picture":return(0,w.Em)({id:"gizmo.appeals.profilePictureFieldName",defaultMessage:"Profile Picture"});case"gizmo_name":return(0,w.Em)({id:"gizmo.appeals.gizmoNameFieldName",defaultMessage:"Name"});case"gizmo_description":return(0,w.Em)({id:"gizmo.appeals.gizmoDescriptionFieldName",defaultMessage:"Description"});case"gizmo_instructions":return(0,w.Em)({id:"gizmo.appeals.gizmoInstructionsFieldName",defaultMessage:"Instructions"});case"gizmo_welcome_message":return(0,w.Em)({id:"gizmo.appeals.gizmoWelcomeMessageFieldName",defaultMessage:"Welcome Message"});case"custom_actions":return(0,w.Em)({id:"gizmo.appeals.customActionsFieldName",defaultMessage:"Custom Actions"});case"conversation_starter":return(0,w.Em)({id:"gizmo.appeals.conversationStarterFieldName",defaultMessage:"Conversation Starter"});case"file":return(0,w.Em)({id:"gizmo.appeals.fileFieldName",defaultMessage:"File"});case"gizmo_combined_content":return(0,w.Em)({id:"gizmo.appeals.gizmoCombinedContentFieldName",defaultMessage:"Overall GPT Config"})}}(e.name)))}),(0,M.jsx)("ul",{className:"list-disc pl-5",children:e.reasons.map(e=>(0,M.jsxs)("li",{children:[e.description," ",e.link?(0,M.jsx)(O,{href:e.link,target:"_blank",rel:"noreferrer",children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.learnMore",defaultMessage:"Learn more"})}):""]},e.description))})]}))),s&&(0,M.jsx)("p",{children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.appealAvailableText",defaultMessage:"Alternatively you may appeal this decision and we will get back to you as soon as possible. Or you can publish to “Only me” and use this GPT privately."})})]})}var G=((r=G||{})[r.Initial=0]="Initial",r[r.AppealForm=1]="AppealForm",r[r.SubmittedConfirmation=2]="SubmittedConfirmation",r);function D(e){var t;let{gizmoId:i,sharingRecipient:s,categories:a,moderationType:r,sharingTargets:n,appealAvailable:l,onClose:o,onAppealSubmitted:d}=e,m=(0,z.Z)(),{0:g,1:x}=(0,y.useState)(""),{0:v,1:j}=(0,y.useState)(G.Initial),b=(0,h.NL)(),w=async()=>{await p.U.postGizmoAppeal(b,i,g,s,a),j(G.SubmittedConfirmation),null==d||d()},N=(0,P.ai)(s,n),Z=null!==(t=null==N?void 0:N.length)&&void 0!==t?t:0,C=(0,f.t)();if(0==Z&&(null==C?void 0:C.isEnterprise()))return(0,M.jsx)(u.Z,{title:m.formatMessage(L(r)),isOpen:!0,onClose:o,showCloseButton:!0,type:"warning",primaryButton:(0,M.jsx)(c.Z.Button,{color:"primary",onClick:o,children:(0,M.jsx)(k.Z,{id:"wEsAOU",defaultMessage:"OK"})}),children:(0,M.jsx)("p",{className:"text-sm",children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.workspaceSettingsMessage",defaultMessage:"Access to your GPT has been reduced by your workspace's GPT sharing settings. An owner of the workspace can change these settings in the workspace settings page."})})});switch(v){case G.Initial:return(0,M.jsx)(u.Z,{title:m.formatMessage(L(r)),isOpen:!0,onClose:o,showCloseButton:!0,primaryButton:(0,M.jsx)(c.Z.Button,{color:"primary",onClick:o,children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.contunueButton",defaultMessage:"Continue"})}),secondaryButton:l?(0,M.jsx)(c.Z.Button,{onClick:()=>j(G.AppealForm),children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.appealButton",defaultMessage:"Appeal"})}):void 0,type:"warning",children:(0,M.jsx)("div",{className:"flex flex-col gap-2 text-sm",children:(0,M.jsx)(A,{sharingRecipient:s,moderatedFields:null!=N?N:[],appealAvailable:l})})});case G.AppealForm:return(0,M.jsx)(u.Z,{title:m.formatMessage({id:"gizmo.appeals.appealModalTitle",defaultMessage:"Appeal"}),isOpen:!0,onClose:o,showCloseButton:!0,shouldIgnoreClickOutside:!0,primaryButton:(0,M.jsx)(c.Z.Button,{color:"primary",onClick:w,disabled:0===g.trim().length,children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.submitAppealButton",defaultMessage:"Submit"})}),secondaryButton:(0,M.jsx)(c.Z.Button,{onClick:()=>j(G.Initial),children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.backButton",defaultMessage:"Back"})}),type:"warning",children:(0,M.jsxs)("div",{className:"flex flex-col gap-2 text-sm",children:[(0,M.jsx)("p",{children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.appealReasonText",defaultMessage:"Please provide a reason for why you believe this GPT doesn’t violate our policies and should be published"})}),(0,M.jsx)(_,{value:g,onChange:e=>x(e.target.value)})]})});case G.SubmittedConfirmation:return(0,M.jsx)(M.Fragment,{})}}function R(e){let{onClose:t}=e,i=(0,z.Z)();return(0,M.jsx)(u.Z,{title:i.formatMessage({id:"gizmo.appeals.appealSubmittedModalTitle",defaultMessage:"Appeal submitted"}),isOpen:!0,onClose:t,showCloseButton:!0,primaryButton:(0,M.jsx)(c.Z.Button,{color:"primary",onClick:t,children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.closeButton",defaultMessage:"Close"})}),type:"success",children:(0,M.jsx)("div",{className:"flex flex-col gap-2 text-sm",children:(0,M.jsx)("div",{children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.appealSubmittedText",defaultMessage:"Your appeal has been submitted. We will get back to you as soon as possible."})})})})}function U(e){let{gizmoId:t,onClose:i}=e,{data:s}=(0,m.b9)(t,!0),a=(0,h.NL)(),r=async()=>{await p.U.postGizmoCancelAppeal(a,t)};return(0,M.jsx)(u.Z,{isOpen:!0,onClose:b(),primaryButton:(0,M.jsx)(c.Z.Button,{color:"primary",onClick:()=>{r(),null==i||i()},children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.cancelAppealButton",defaultMessage:"Cancel appeal"})}),type:"warning",children:(0,M.jsxs)("div",{className:"flex flex-col gap-2 text-sm",children:[(0,M.jsx)("h2",{className:"text-lg font-semibold",children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.appealReviewingHeader",defaultMessage:"Reviewing your appeal"})}),(0,M.jsx)("p",{children:(0,M.jsx)(k.Z,{id:"gizmo.appeals.appealSentModalText",defaultMessage:"During the review you can continue using “{gizmoName}” as your private GPT, but won’t be able to update it or share it with others.",values:{gizmoName:null==s?void 0:s.gizmo.display.name}})})]})})}function F(e){let{appealState:t,onAppealClose:i,onAppealSubmitted:s}=e,{value:a}=(0,x.sB)("chatgpt-gizmo-appeals"),{0:r,1:n}=(0,y.useState)(!1);return r?(0,M.jsx)(R,{onClose:()=>{n(!1),null==s||s()}}):(0,M.jsxs)(M.Fragment,{children:[(null==t?void 0:t.showModal)==T.AppealSent&&(0,M.jsx)(U,{gizmoId:t.gizmoId,onClose:i}),(null==t?void 0:t.showModal)==T.AppealAvailable&&(0,M.jsx)(D,{gizmoId:t.gizmoId,sharingRecipient:t.sharingRecipient,categories:t.categories,moderationType:t.moderationType,sharingTargets:t.sharingTargets,appealAvailable:a,onClose:()=>null==i?void 0:i(),onAppealSubmitted:()=>n(!0)})]})}},25720:function(e,t,i){i.d(t,{V9:function(){return tt},yf:function(){return e3}});var s,a,r=i(94521),n=i(21904),l=i(85734),o=i(50684),d=i(81816),c=i(81892),u=i(95284),m=i(82823),p=i(16645),g=i(94982),f=i(55059),h=i(4702),x=i(27603),v=i(86021),j=i(24040),b=i(91208),y=i(32512),w=i(27860),k=i(92379),z=i(98131),N=i(35226),P=i(93747),M=i(15236),Z=i(59031),C=i(17927),O=i(19841),_=i(61888),T=i(86078),S=i.n(T),E=i(43128),I=i.n(E),L=i(26123),A=i(25940),G=i(41141),D=i(83252),R=i(52899),U=i(81412),F=i(2933),B=i(55371),W=i(48580),Q=i(72256),V=i(74091),K=i(14910),Y=i(67165),q=i(66246),J=i(31310),H=i(56029),X=i(93696),$=i(5443),ee=i(49217),et=i(62484),ei=i(29707),es=i(97821),ea=i(651);function er(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function en(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?er(Object(i),!0).forEach(function(t){(0,r.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):er(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function el(e){let{gizmo:t,updateGizmo:i,publishedGizmo:s,promoteGizmo:a,appealGizmo:r,setAppealState:n,showActionsModal:l,shareOnly:o,onClose:d}=e,{0:c,1:u}=(0,k.useState)({type:"privacy"});return"privacy"===c.type?(0,ea.jsx)(eo,{gizmo:t,updateGizmo:i,publishedGizmo:s,promoteGizmo:a,appealGizmo:r,setAppealState:n,setStep:u,showActionsModal:l,shareOnly:o,onClose:d}):(0,ea.jsx)(ed,{publishedGizmo:c.publishedGizmo,onClose:d})}function eo(e){var t,i,s,a;let{gizmo:r,publishedGizmo:l,updateGizmo:o,promoteGizmo:d,appealGizmo:u,setAppealState:f,setStep:x,showActionsModal:v,shareOnly:b,onClose:y}=e,{0:w,1:P}=(0,k.useState)(!1),M=(0,j.ec)(j.F_.isBusinessWorkspace),Z=(0,L.Z)(),{0:C,1:O}=(0,k.useState)((0,m.Sg)(r)?M?p.Zz.Workspace:p.Zz.Link:r.sharingRecipient),T=(0,N.NL)(),S=(0,ei.YK)(C,r.sharingTargets),{data:E,isLoading:I}=(0,m.WL)(),A=(0,m.Z1)(),{0:G,1:D}=(0,k.useState)(null!=l&&l.gizmo.display.categories.length>0?null===(t=A.data)||void 0===t||null===(t=t.categories.find(e=>e.id===l.gizmo.display.categories[0]))||void 0===t?void 0:t.id:void 0);(0,k.useEffect)(()=>{D(null==l?void 0:l.gizmo.display.categories[0])},[null==l?void 0:l.gizmo.display.categories]);let{0:R,1:U}=(0,k.useState)(void 0),F=(0,k.useRef)((0,_.throttle)((e,t)=>H.U.generateCategory(e,t),1e3)),B=null!=E&&E.is_verified?void 0:Z.formatMessage({id:"qEQtmt",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile."});C!==p.Zz.Marketplace||null==B||I||O(p.Zz.Link);let V=M&&!(null!==(i=r.sharingTargets)&&void 0!==i&&i.some(e=>e.recipient===p.Zz.Link)),K=(0,J.bw)(r,C,G),Y=K.includes(J.hs.MissingPublicActionPrivacyPolicyURL),q=r.tools.find(e=>e.type===n.qK.JIT_PLUGIN&&!e.metadata.privacy_policy_url),et=(0,j.ec)(e=>e.currentWorkspace),es=(0,h.hz)();(0,k.useEffect)(()=>{let e=!0;return(async()=>{try{if(null!=G)return;let t=await F.current(r.name,r.instructions);e&&null==G&&(t?D(t.id):U(!0))}catch(t){e&&null==G&&U(!0)}})(),()=>{e=!1}},[r.instructions,r.name,es,G]);let{value:er}=(0,W.sB)("chatgpt-gizmo-appeals");return(0,ea.jsx)(ee.Z,{type:"success",isOpen:!0,onClose:y,title:(0,ea.jsx)(Q.Z,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:S?(0,ea.jsx)($.z,{color:"primary",disabled:K.length>0,loading:w,onClick:async()=>{try{if(P(!0),b){if(!(null!=l&&l.gizmo.id)){g.m.danger(Z.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}let e=await H.U.shareGizmo(l.gizmo.id,G?{sharing:(0,p.Mj)(C,[],p.EL),categories:[G]}:{sharing:(0,p.Mj)(C,[],p.EL)});e.error?(g.m.warning(Z.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),o({sharingTargets:e.sharing_targets}),f({gizmoId:l.gizmo.id,sharingRecipient:C,categories:l.gizmo.display.categories,moderationType:c.Te.PublishBlocked,sharingTargets:e.sharing_targets,showModal:c.UJ.AppealAvailable})):(T.setQueryData(["gizmo",{gizmoId:l.gizmo.id},{draft:!1}],t=>e.resource),o(e=>en(en({},e),{},{sharingRecipient:C})),g.m.success(Z.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),y())}else{let e=await d({recipient:C,subjects:(0,p.Mj)(C,[],p.EL)},G);e?(x({type:"published",publishedGizmo:e}),o(t=>en(en({},t),{},{id:e.gizmo.id,sharingRecipient:C})),null!=e.gizmo.live_version&&o({liveVersion:e.gizmo.live_version}),g.m.success(Z.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}))):(g.m.warning(Z.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),y())}}finally{P(!1)}},children:(0,ea.jsx)(Q.Z,{id:"SW4DG4",defaultMessage:"Save"})}):er?(0,ea.jsx)(ea.Fragment,{children:(0,ea.jsx)($.z,{color:"primary",onClick:async()=>{await u(C,G)},children:(0,ea.jsx)(Q.Z,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,children:(0,ea.jsxs)("div",{className:"flex flex-col gap-3 text-sm",children:[(0,ea.jsxs)(z.fC,{value:C,onValueChange:e=>O(e),className:"space-y-2",children:[r.sharingTargets&&r.sharingTargets.map((e,t)=>(0,ea.jsx)(eu,{value:e.recipient,disabled:e.recipient===p.Zz.Marketplace&&null!=B,tooltipText:e.recipient===p.Zz.Marketplace?null!=B?B:Z.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:e.recipient},t)),V&&(0,ea.jsxs)(ea.Fragment,{children:[(0,ea.jsx)(eu,{value:p.Zz.Link,disabled:!0,tooltipText:Z.formatMessage(ec.workspaceDisabledHint),shareLevel:p.Zz.Link,workspaceName:null==et?void 0:et.name}),(0,ea.jsx)(eu,{value:p.Zz.Marketplace,disabled:!0,tooltipText:Z.formatMessage(ec.workspaceDisabledHint),shareLevel:p.Zz.Marketplace,workspaceName:null==et?void 0:et.name})]})]}),Y&&(0,ea.jsx)("div",{className:"text-xs text-red-500",children:(0,ea.jsx)(Q.Z,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:e=>(0,ea.jsx)("button",{onClick:()=>{v(null==q?void 0:q.metadata.action_id)},className:"underline",children:e})}})}),C!==p.Zz.Private&&(0,ea.jsx)(X.O2,{gizmo:r,category:G,categories:C===p.Zz.Marketplace?null!==(s=null===(a=A.data)||void 0===a?void 0:a.categories)&&void 0!==s?s:[]:void 0,onCategoryChange:C===p.Zz.Marketplace?e=>D(e.id):void 0}),C===p.Zz.Marketplace&&(R?(0,ea.jsx)("div",{className:"text-xs text-red-500",children:(0,ea.jsx)(Q.Z,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!S&&er&&(0,ea.jsx)("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:(0,ea.jsx)(Q.Z,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function ed(e){let{publishedGizmo:t,onClose:i}=e,s=(0,es.Rb)(t),a=(0,L.Z)();return(0,ea.jsx)(ee.Z,{type:"success",isOpen:!0,onClose:i,title:(0,ea.jsx)(Q.Z,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:(0,ea.jsx)($.z,{color:"primary",as:"link",to:s,children:(0,ea.jsx)(Q.Z,{id:"lyZz44",defaultMessage:"View GPT"})}),children:(0,ea.jsx)("div",{className:"flex flex-col gap-2",children:(0,ea.jsxs)("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[(0,ea.jsx)("div",{className:"line-clamp-1 text-ellipsis break-all",children:s}),(0,ea.jsx)("button",{onClick:()=>{(0,es.A4)(t,a.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary",children:(0,ea.jsx)(q.TIy,{className:"icon-sm"})})]})})})}let ec=(0,A.vU)({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function eu(e){let{shareLevel:t,workspaceName:i,disabled:s=!1,tooltipText:a,value:r}=e,n=(0,k.useId)();return(0,ea.jsxs)("div",{className:(0,O.default)("flex h-14 items-center justify-between gap-2 py-1.5 font-semibold",s?"opacity-50":""),children:[(0,ea.jsx)(et.E,{disabled:null==a,label:a,side:"right",children:(0,ea.jsx)("label",{htmlFor:n,className:"flex cursor-pointer items-center gap-1",children:(0,ea.jsx)(X.C6,{shareLevel:t,workspaceName:null!=i?i:"",hasInviteSharing:!1})})}),(0,ea.jsx)(z.ck,{id:n,value:r,disabled:s,className:"mr-1 flex h-5 w-5 shrink-0 items-center justify-center rounded-full border border-gray-500 bg-white dark:border-gray-600 dark:bg-gray-700",children:(0,ea.jsx)(z.z$,{className:"h-2 w-2 rounded-full bg-gray-950 dark:bg-white"})})]})}function em(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function ep(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?em(Object(i),!0).forEach(function(t){(0,r.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):em(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function eg(e){window.history.length>1?e.back():e.push((0,w.L7)())}function ef(e){var t;let{gizmo:i,publishedGizmo:s,isLoading:a,isUploadingProfilePic:r,isGeneratingProfilePic:n,updateGizmo:l,promoteGizmo:o,appealGizmo:d,setAppealState:c,showActionsModal:u}=e,g=(0,h.t)(),f=null!=i?(0,J.bw)(i):[];(null==i||a)&&f.push(J.hs.Loading),r&&f.push(J.hs.UploadingProfilePic),n&&f.push(J.hs.GeneratingProfilePic);let x=(0,m.Sg)(i),{0:v,1:j}=(0,k.useState)(!1),{0:b,1:y}=(0,k.useState)(!1),w=i.sharingRecipient?X.P6[i.sharingRecipient]:X.P6.private;return(0,ea.jsxs)(ea.Fragment,{children:[x?(0,ea.jsx)(F.cY,{color:"primary",onClick:()=>j("promote"),loading:a,disabled:void 0===i.id||f.length>0,tooltip:f.length>0?f.map(J.sw).join("\n"):void 0,children:(0,ea.jsx)(Q.Z,{id:"svUGIb",defaultMessage:"Create"})}):(0,ea.jsxs)(ea.Fragment,{children:[(0,ea.jsxs)(F.cY,{color:"secondary",loading:a||!s,onClick:()=>j("share"),children:[(0,ea.jsx)(w,{className:"icon-sm shrink-0"}),(0,ea.jsx)(Q.Z,{id:"aXKW4G",defaultMessage:"Share"})]}),(0,ea.jsx)(F.cY,{color:"primary",onClick:async()=>{var e;let t=i.sharing.subjects.map(X.xH),a=(0,p.H$)(i.sharing.subjects);t=(0,p.Mj)(i.sharing.recipient,t,null!==(e=null==a?void 0:a.capabilities)&&void 0!==e?e:p.EL),await o({recipient:i.sharing.recipient,subjects:t},null==s?void 0:s.gizmo.display.categories[0])&&y(!0)},loading:a||!s,disabled:f.length>0,tooltip:f.length>0?f.map(J.sw).join("\n"):void 0,children:(0,ea.jsx)(Q.Z,{id:"84QVoj",defaultMessage:"Update"})})]}),v&&((null==g?void 0:g.getWorkspaceId())==void 0?(0,ea.jsx)(el,{gizmo:i,publishedGizmo:s,promoteGizmo:o,appealGizmo:d,setAppealState:c,showActionsModal:u,updateGizmo:l,shareOnly:"share"===v,onClose:()=>j(!1)}):(0,ea.jsx)(X.hD,{gizmo:i,publishedGizmo:s,promoteGizmo:o,appealGizmo:d,setAppealState:c,showActionsModal:u,updateGizmo:l,onClose:()=>j(!1),shareOnly:"share"===v})),b&&(0,ea.jsx)(X.uj,{publishedGizmo:s,sharing:s.gizmo.sharing,onClose:()=>y(!1),workspaceName:null!==(t=null==g?void 0:g.data.name)&&void 0!==t?t:""})]})}function eh(e){let{gizmoEditorData:t,publishedGizmo:i,revertDraft:s}=e,a=(0,L.Z)(),{0:r,1:n}=(0,k.useState)(!1),l=(0,h.hz)(),{value:o}=(0,W.sB)("chatgpt-gizmo-version-history");return null!=l&&l.includes("debug")||(null==t?void 0:t.id)!=null?(0,ea.jsxs)(ea.Fragment,{children:[(0,ea.jsxs)(Y.d,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:(0,ea.jsx)(F.cY,{color:"ghost",icon:q.nWS}),children:[null!=i&&(0,ea.jsxs)(Y.Z.Item,{onClick:()=>{(0,es.A4)(i)},children:[(0,ea.jsx)(U.HN,{className:"icon-sm"}),(0,ea.jsx)(Q.Z,ep({},ey.copyLink))]}),null!=s&&(0,ea.jsxs)(Y.Z.Item,{onClick:()=>{window.confirm(a.formatMessage(ey.revertConfirm))&&s()},children:[(0,ea.jsx)(q.Ezi,{className:"icon-sm"}),(0,ea.jsx)(Q.Z,{id:"W2blnV",defaultMessage:"Revert..."})]}),(null==t?void 0:t.id)!=null&&o&&t.liveVersion>0&&(0,ea.jsxs)(ea.Fragment,{children:[(0,ea.jsxs)(Y.Z.Item,{onClick:()=>{I().push("/g/".concat(t.id,"/view"))},children:[(0,ea.jsx)(U.Eo,{className:"icon-sm"}),(0,ea.jsx)(Q.Z,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),(0,ea.jsxs)(Y.Z.Item,{onClick:async()=>{let e=await H.U.copyGizmo({gizmoId:t.id});e.gizmo.id&&I().push("/gpts/editor/".concat(e.gizmo.id))},children:[(0,ea.jsx)(q.TIy,{className:"icon-sm"}),(0,ea.jsx)(Q.Z,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),(null==t?void 0:t.id)!=null&&(0,ea.jsxs)(Y.Z.Item,{color:"danger",onClick:()=>{n(!0)},children:[(0,ea.jsx)(q.XHJ,{className:"icon-sm"}),(0,ea.jsx)(Q.Z,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),(null==l?void 0:l.includes("debug"))&&(0,ea.jsxs)(ea.Fragment,{children:[(0,ea.jsx)(Y.Z.Separator,{}),(0,ea.jsxs)(Y.Z.Item,{onClick:()=>{B.vm.toggleActiveSidebar("debug")},children:[(0,ea.jsx)(q.reV,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),r&&(0,ea.jsx)(R.b,{gizmoId:t.id,onSuccess:()=>eg(I()),onClose:()=>{n(!1)}})]}):null}let ex=V.Z.div(a||(a=(0,G.Z)(["flex items-center gap-1"])));function ev(e){let{gizmoEditorData:t}=e,i=(0,j.ec)(e=>{var t;return null===(t=e.currentWorkspace)||void 0===t?void 0:t.name});switch(t.sharingRecipient){case p.Zz.Private:return(0,ea.jsxs)(ex,{children:[(0,ea.jsx)(U.LX,{className:"icon-xs"}),(0,ea.jsx)(Q.Z,ep({},ey.onlyMe))]});case p.Zz.Link:return(0,ea.jsxs)(ex,{children:[(0,ea.jsx)(U.HN,{className:"icon-xs"}),(0,ea.jsx)(Q.Z,ep({},ey.anyoneWithLink))]});case p.Zz.Workspace:return(0,ea.jsxs)(ex,{children:[(0,ea.jsx)(q.ZyV,{className:"icon-xs"}),i]});case p.Zz.Marketplace:return(0,ea.jsxs)(ex,{children:[(0,ea.jsx)(q.frp,{className:"icon-xs"}),(0,ea.jsx)(Q.Z,ep({},ey.public))]});default:return(0,ea.jsx)("div",{})}}function ej(e){let{gizmoEditorData:t}=e;return(0,ea.jsxs)("div",{className:"flex items-center gap-2",children:[null!=t.profilePictureUrl?(0,ea.jsx)(D.Z,{isFirstParty:!1,src:t.profilePictureUrl,className:"h-8 w-8"}):(0,ea.jsx)("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),(0,ea.jsxs)("div",{children:[(0,ea.jsx)("div",{className:"text-sm font-semibold",children:t.name||(0,ea.jsx)(Q.Z,ep({},ey.newGPT))}),(0,ea.jsx)("div",{className:"text-xs text-token-text-secondary",children:(0,m.Sg)(t)?(0,ea.jsxs)("div",{className:"flex items-center gap-1",children:[(0,ea.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),(0,ea.jsx)(Q.Z,ep({},ey.draft))]}):(0,ea.jsxs)("div",{className:"flex items-center gap-1",children:[(0,ea.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),t.sharingRecipient===p.Zz.Marketplace?(0,ea.jsx)(Q.Z,ep({},ey.published)):(0,ea.jsx)(Q.Z,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," \xb7 ",(0,ea.jsx)(ev,{gizmoEditorData:t})]})})]})]})}function eb(e){let{gizmoEditorData:t,isLoading:i,isUploadingProfilePic:s,isGeneratingProfilePic:a,publishedGizmo:r,updateGizmo:n,promoteGizmo:l,appealGizmo:o,setAppealState:d,revertDraft:c,draftMessage:u,className:m,hasUnpublishedChanges:p,showActionsModal:g}=e;return(0,ea.jsxs)("div",{className:(0,O.default)("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",m),children:[(0,ea.jsxs)("div",{className:"flex items-center gap-2",children:[(0,ea.jsx)("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>eg(I()),children:(0,ea.jsx)(K.Dz,{className:"icon-lg"})}),(0,ea.jsx)(ej,{gizmoEditorData:t})]}),(0,ea.jsxs)("div",{className:"flex items-center gap-2",children:[u,(0,ea.jsx)(eh,{gizmoEditorData:t,publishedGizmo:r,revertDraft:c}),(0,ea.jsx)(ef,{gizmo:t,publishedGizmo:r,isLoading:i,isUploadingProfilePic:s,isGeneratingProfilePic:a,updateGizmo:n,promoteGizmo:l,appealGizmo:o,setAppealState:d,hasUnpublishedChanges:p,showActionsModal:g})]})]})}let ey=(0,A.vU)({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}});var ew=i(89987);function ek(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function ez(e){let{upsertDraftError:t}=e,i=function(e,t){let i=e.response,s=(0,b.Ot)(e);if(!Array.isArray(i))return s;let a=(0,_.compact)(i.map(e=>{if("value_error.any_str.max_length"===e.type)switch(e.loc[1]){case"display":switch(e.loc[2]){case"name":return t.formatMessage(ew.sY.nameTooLong,{length:e.ctx.limit_value});case"description":return t.formatMessage(ew.sY.descriptionTooLong,{length:e.ctx.limit_value})}break;case"instructions":return t.formatMessage(ew.sY.instructionsTooLong,{length:e.ctx.limit_value})}if("string"==typeof e.msg)return e.msg}));return a.length>0?a.join("\n"):s}(t,(0,L.Z)());return(0,ea.jsxs)("div",{className:"flex items-center gap-2 text-red-500",children:[(0,ea.jsx)("div",{children:(0,ea.jsx)(Q.Z,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ek(Object(i),!0).forEach(function(t){(0,r.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ek(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({},eP.errorSavingDraft))}),null!=i&&(0,ea.jsx)(et.u,{label:i,children:(0,ea.jsx)(q.szr,{className:"icon-sm"})})]})}function eN(e){let{isPublished:t,isSavingDraft:i,hasUnpublishedChanges:s,upsertDraftError:a,className:r}=e;return a instanceof b.Q0?(0,ea.jsx)(ez,{upsertDraftError:a}):s?(0,ea.jsxs)("div",{className:(0,O.default)("flex items-center gap-2",r),children:[(0,ea.jsx)("span",{className:"text-token-text-secondary",children:t?(0,ea.jsx)(Q.Z,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):(0,ea.jsx)(Q.Z,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),(0,ea.jsx)("div",{className:"w-4 text-token-text-tertiary",children:i&&(0,ea.jsx)(o.Z,{})})]}):null}let eP=(0,A.vU)({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}});var eM=i(6175),eZ=i(71611),eC=i(61457),eO=i(14161),e_=i(8230),eT=i(27480),eS=i(8844),eE=i(21629),eI=i(58543),eL=i(69965),eA=i(93223),eG=i(20408),eD=i(18850),eR=i(55179),eU=i(23016),eF=i(71199),eB=i(82660);function eW(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function eQ(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?eW(Object(i),!0).forEach(function(t){(0,r.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eW(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}async function eV(e){let t;for(let i of e)if("gizmo_editor.generate_profile_pic"===i.author.name){let e=eG.U.getImageAssetPointers(i);e.length>0&&(t=e.at(-1))}if(null!=t){let e=(0,eI.Iy)(t.asset_pointer),i=await eA.Z.getFileDownloadLink(e);if(i.status===n.KF.Success)return{id:e,permalink:i.download_url}}}async function eK(e,t,i){var s,a;let r=function(e,t){let i=v.tQ.getThreadCurrentLeafId(e),s=v.tQ.getTree(e),a=[],r=s.getNodeByIdOrMessageId(i);for(;null!=r&&(null==t||r.id!==t);)a.unshift(r.message),r=""!==r.parentId?s.getNodeByIdOrMessageId(r.parentId):void 0;return a}(t,i),l=r.filter(e=>"gizmo_editor.update_behavior"===e.recipient).flatMap(e=>"text"===e.content.content_type?e.content.parts:"code"===e.content.content_type?[e.content.text]:[]).map(e=>JSON.parse(e)).reduce((e,t)=>eQ(eQ({},e),t),{}),o=await eV(r);if((0,_.isEmpty)(l)&&null==o)return;let{name:d,context:c,description:u,profile_pic_file_id:m,prompt_starters:p}=l;if(null!=m)try{let t=await eA.Z.getFileDownloadLink(m,e.id);t.status===n.KF.Success&&(o={id:m,permalink:t.download_url})}catch(e){Z.U.addError(Error("Error while retrieving profile pic in update",{cause:e})),g.m.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}let f={name:"string"==typeof d?d:void 0,description:"string"==typeof u?u:void 0,instructions:"string"==typeof c?c:void 0,promptStarters:Array.isArray(p)?p:void 0,profilePictureId:null===(s=o)||void 0===s?void 0:s.id,profilePictureUrl:null===(a=o)||void 0===a?void 0:a.permalink};return(0,_.pickBy)(f,e=>null!=e)}function eY(e,t,i,s){var a,r,n,o,d,c,u,m,p,g,f;let h=i.current,x=s.current;if((0,_.isEqual)(h,x))return;let j={};h.name!==(null==x?void 0:x.name)&&(j.name=h.name),(null!==(a=h.description)&&void 0!==a?a:"")!==(null!==(r=null==x?void 0:x.description)&&void 0!==r?r:"")&&(j.description=null!==(g=h.description)&&void 0!==g?g:""),h.instructions!==(null!==(n=null==x?void 0:x.instructions)&&void 0!==n?n:"")&&(j.context=null!==(f=h.instructions)&&void 0!==f?f:"");let b=new Set(null!==(o=null==x||null===(d=x.files)||void 0===d?void 0:d.map(e=>e.file_id))&&void 0!==o?o:[]),y=new Set(null!==(c=null===(u=h.files)||void 0===u?void 0:u.map(e=>e.file_id))&&void 0!==c?c:[]),w=(null!==(m=h.files)&&void 0!==m?m:[]).filter(e=>!b.has(e.file_id)),k=(null!==(p=null==x?void 0:x.files)&&void 0!==p?p:[]).filter(e=>!y.has(e.file_id));if((0,_.isEmpty)(j)&&0===w.length&&0===k.length)return;let z=[];if(!(0,_.isEmpty)(j)){let e="Explicitly update the GPT's behavior to the following exact fields:\n\n    ".concat(JSON.stringify(j,null,2),'\n\n    "Do not call update_behavior yet. Instead, use these updated fields as the GPT\'s current behavior, and in the next call to update_behavior, incorporate these changes."\n    ');z.push(eD.Cv.getTextAsMessage(e,l.uU.System))}k.length>0&&z.push(eD.Cv.getTextAsMessage("The user has removed the following files from the GPT. You can no longer reference these files: ".concat(k.map(e=>e.file_id).join(", ")),l.uU.System)),w.length>0&&z.push(eD.Cv.getTextAsMessage("The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ".concat(w.map(e=>e.file_id).join(", ")),l.uU.System,{attachments:w.map(e=>({id:e.file_id,name:e.name,size:e.size}))})),z.length>0&&v.tQ.updateTree(e,e=>{let i=e.getNodeByIdOrMessageId(t).parentId;for(let s of z){let a=(0,eS.Z)();e.insertNodeBefore(t,{id:a,children:[],parentId:i,message:s,metadata:{isClientCreatedSystemMessage:!0}}),i=a}})}function eq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function eJ(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?eq(Object(i),!0).forEach(function(t){(0,r.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eq(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let eH=k.memo(function(e){let{gizmoEditorData:t,updateGizmo:i,clientThreadId:s,completionCallbackResponse:a,gizmoEditorDataRef:r,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:o,requireGizmoId:d}=e,c=(0,k.useMemo)(()=>({gizmoEditorData:t,gizmoId:t.id,mode:"magic",behaviorOverrides:n,getGizmoId:d}),[d,t,n]),u=(0,eO.gF)(e=>e.files.filter(e=>e.status===eC.XX.Ready&&null!=e.gizmoId)),m=(0,k.useCallback)((e,t)=>{!function(e,t,i){if(0===i.length)return;let s=(0,eS.Z)(),a="The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ".concat(i.map(e=>'"'.concat(e.fileId,'"')).join(", "));v.tQ.updateTree(e,e=>{let i=e.getNodeByIdOrMessageId(t).parentId;e.insertNodeBefore(t,{id:s,children:[],parentId:i,message:eD.Cv.getTextAsMessage(a,l.uU.System),metadata:{isClientCreatedSystemMessage:!0}})})}(e,t,u),eY(e,t,r,o),function(e,t){let i="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",s=v.tQ.getThreadCurrentLeafId(e),a=v.tQ.getTree(e),r=a.getNodeByIdOrMessageId(s);for(;null!=r&&r.message.author.role!==l.uU.User;){if("text"===r.message.content.content_type&&r.message.content.parts[0]===i)return;r=""!==r.parentId?a.getNodeByIdOrMessageId(r.parentId):void 0}v.tQ.updateTree(e,e=>{let s=e.getNodeByIdOrMessageId(t).parentId;e.insertNodeBefore(t,{id:(0,eS.Z)(),children:[],parentId:s,message:eD.Cv.getTextAsMessage(i,l.uU.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}(e,t),i(e=>{var t;return eJ(eJ({},e),{},{files:[...null!==(t=e.files)&&void 0!==t?t:[],...(0,_.compact)(u.map(e=>{var t;return null!=e.fileId&&{file_id:e.fileId,name:e.file.name,size:e.file.size,type:e.file.type,last_modified:e.file.lastModified,file_size_tokens:null===(t=e.fileSpec)||void 0===t?void 0:t.fileTokenSize}}))]})}),o.current=(0,_.cloneDeep)(r.current)},[r,o,u,i]),p=(0,B.tN)(e=>e.activeSidebar);return(0,ea.jsx)(eE.D.Provider,{value:c,children:(0,ea.jsxs)("div",{className:"relative flex h-full grow overflow-auto",children:[(0,ea.jsx)("div",{className:"grow",children:(0,ea.jsx)(eZ.Z,{clientThreadId:s,onCompletionFinished:a,preRequestCompletion:m,hideHeader:!0,prependThreadChildren:(0,ea.jsx)("div",{className:"h-8"})})}),"debug"===p&&(0,ea.jsx)(e_.DebugConversationSidebar,{clientThreadId:s,slideOver:!1,onClose:()=>B.vm.toggleActiveSidebar("debug"),isOpen:!0})]})})});var eX=i(75438);function e$(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function e0(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?e$(Object(i),!0).forEach(function(t){(0,r.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):e$(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let e1=S()(()=>Promise.all([i.e(1703),i.e(4205)]).then(i.bind(i,74205)).then(e=>e.GizmoActionsEditor),{loadableGenerated:{webpack:()=>[74205]}});var e2=((s=e2||{}).MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s);function e4(e){let{value:t,label:i}=e;return(0,ea.jsx)(z.ck,{value:t,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2",children:i})}function e5(e){let{className:t,editorTab:i,setEditorTab:s}=e,a=(0,L.Z)();return(0,ea.jsxs)(z.fC,{className:(0,O.default)("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",t),value:i,onValueChange:e=>{s(e)},children:[(0,ea.jsx)(e4,{value:e2.MAGIC_MAKER,label:a.formatMessage(ti.magicMakerLabel)}),(0,ea.jsx)(e4,{value:e2.ADVANCED,label:a.formatMessage(ti.configureLabel)}),(0,ea.jsx)("div",{className:"flex w-1/3 md:hidden",children:(0,ea.jsx)(e4,{value:e2.PREVIEW,label:a.formatMessage(ti.previewLabel)})})]})}let e8={id:void 0,instructions:"",name:"",description:"",profilePictureId:void 0,profilePictureUrl:void 0,promptStarters:[],sharing:{recipient:p.Zz.Private,subjects:[]},tools:[{type:n.qK.DALLE}],files:[],trainingDisabled:!1,liveVersion:0,useGPT4ForEnterprise:!1},e6=e0(e0({},e8),{},{tools:[...e8.tools,{type:n.qK.BROWSER}]});function e3(e){var t,i,s,a,r,n;return{id:e.gizmo.id,instructions:e.gizmo.instructions,name:e.gizmo.display.name,description:null!==(t=e.gizmo.display.description)&&void 0!==t?t:"",profilePictureId:null!==(i=e.gizmo.display.profile_pic_id)&&void 0!==i?i:void 0,profilePictureUrl:null!==(s=e.gizmo.display.profile_picture_url)&&void 0!==s?s:void 0,promptStarters:null!==(a=e.gizmo.display.prompt_starters)&&void 0!==a?a:[],tools:(0,_.cloneDeep)(e.tools),files:(0,_.cloneDeep)(e.files),sharing:e.gizmo.sharing?(0,_.cloneDeep)(e.gizmo.sharing):{subjects:[],recipient:e.gizmo.share_recipient},trainingDisabled:null!==(r=e.gizmo.training_disabled)&&void 0!==r&&r,useGPT4ForEnterprise:"gpt-4"===e.gizmo.model,sharingRecipient:e.gizmo.share_recipient,sharingTargets:(0,_.cloneDeep)(e.gizmo.sharing_targets),liveVersion:null!==(n=e.gizmo.live_version)&&void 0!==n?n:0}}let e9=e=>{var t;let{gizmo:i,onNewGizmoId:s}=e,a=(0,N.NL)(),r=(0,d.C)(x.L0.BrowsingAvailable),o=(0,L.Z)(),h=(0,k.useRef)(null!=i?e3(i):r?e6:e8),j=(0,k.useRef)(i),y=(0,k.useRef)(h.current),{0:w,1:z}=(0,k.useState)(()=>h.current),{0:T,1:S}=(0,k.useState)(()=>(0,v.OX)()),{0:E}=(0,k.useState)(()=>({context_message:function(e){var t,i,s;let a=new Set;for(let t of e.tools)a.add(t.type);let r=null!==(t=e.name)&&void 0!==t?t:"",n=null!==(i=e.description)&&void 0!==i?i:"",l=null!==(s=e.instructions)&&void 0!==s?s:"",o=Array.from(a).join(","),d=""===r&&""===n&&""===l,c=null!=e.profilePictureUrl;return d?"The GPT you are about to has the following abilities: ".concat(o,"."):"This is the GPT's current set of fields:\n\nname: ".concat(r,"\n\ndescription: ").concat(n,"\n\ncontext: ").concat(l,"\n\nabilities: ").concat(o,"\n\n").concat(c?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior.","\n")}(h.current),model_slug:"unused",enabled_tools:[{tool_id:null!=i?"gizmo_editor":"gizmo_creator"}]}));!function(e,t,i){(0,eT.a)(e,{kind:l.OL.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i}),(0,k.useEffect)(()=>{v.tQ.updateConversationMode(e,{kind:l.OL.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i})},[e,t.id,i]);let{0:s}=(0,k.useState)(()=>{let e=null==t.id,i=null!=t.id&&""!==t.name&&null!=t.description&&""!==t.instructions&&null!=t.profilePictureUrl;return e?'Hi! I\'ll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."\n\nWhat would you like to make?':i?"Welcome back! Is there anything ".concat(t.name," should be doing better? Anything you'd like to change?"):"You're back! Let's continue where we left off..."});(0,k.useEffect)(()=>{let t=v.tQ.getTree(e);if(t.findNode(e=>{var t;return e.message.author.role===l.uU.User||(null===(t=e.metadata)||void 0===t?void 0:t.isClientCreatedSystemMessage)===!0})||(v.tQ.deleteNodesByFilter(e,e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t.isPlaceholderTemplateAssistantWelcomeMessage)===!0}),null==s||0===s.length))return;let i=v.tQ.getThreadCurrentLeafId(e);if(!t.hasNodeOrMessageId(i))return;let a=(0,eS.Z)();v.tQ.updateTree(e,e=>{e.addNode(a,s,i,l.uU.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),v.tQ.setThreadCurrentLeafId(e,a)},[e,s])}(T,y.current,E);let{data:I}=(0,f.Y7)(),A=null!==(t=null==I?void 0:I.modelsList.find(e=>e.tags.includes(l.S.GPT_4)))&&void 0!==t?t:null==I?void 0:I.modelsList.find(e=>e.id===f.mx),{data:G}=(0,m.b9)(h.current.id),D=(0,m.N_)(),{isPending:R,error:U}=D,F=(0,m.ZJ)(),B=(0,k.useMemo)(()=>{var e,t,i,s,a,r;return null!=G&&(!(w.name===G.gizmo.display.name&&w.description===G.gizmo.display.description&&w.instructions===G.gizmo.instructions&&(a=w.tools,r=G.tools,a.length===r.length&&a.every(e=>r.some(t=>t.type===e.type)))&&(0,_.isEqual)(null!==(e=null===(t=w.files)||void 0===t?void 0:t.map(e=>e.file_id))&&void 0!==e?e:[],null!==(i=null===(s=G.files)||void 0===s?void 0:s.map(e=>e.file_id))&&void 0!==i?i:[]))||w.profilePictureUrl!=G.gizmo.display.profile_picture_url||w.profilePictureId!=G.gizmo.display.profile_pic_id)},[w,G]),W=async()=>{let e=h.current;try{let t=await D.mutateAsync({editorData:e,gizmoId:e.id});if(j.current=t,null==h.current.id){let e=t.gizmo.id;h.current=e0(e0({},h.current),{},{id:e,sharingTargets:t.gizmo.sharing_targets}),z(h.current),null==s||s(e)}for(let e of t.tools.filter(e=>e.type===n.qK.JIT_PLUGIN)){let t=h.current.tools.find(t=>t.type===n.qK.JIT_PLUGIN&&t.metadata.domain===e.metadata.domain);t&&t.metadata.action_id!==e.metadata.action_id&&(t.metadata=e0(e0({},t.metadata),{},{action_id:e.metadata.action_id}),z(h.current))}return t}catch(i){var t;let e=null!==(t=(0,b.Ot)(i))&&void 0!==t?t:o.formatMessage(eP.errorSavingDraft);throw g.m.warning(e,{duration:2}),i}},Q=(0,k.useRef)(),V=async()=>null!=h.current.id?h.current.id:(null==Q.current&&(Q.current=W().then(e=>e.gizmo.id).catch(e=>{throw Q.current=void 0,e})),Q.current),{0:K}=(0,k.useState)(()=>(0,_.debounce)(()=>W(),2e3,{trailing:!0}));function Y(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i="function"==typeof e?e(h.current):(0,J.x$)(h.current,e);!(0,_.isEqual)(i,h.current)&&(h.current=i,z(h.current),t&&K())}let q=(0,k.useRef)(),H=async e=>{if(null==e){ec(!1);return}try{let t=await eK(h.current,e,q.current);null!=t&&(Y(t),y.current=(0,_.cloneDeep)(h.current))}catch(e){Z.U.addError(e),g.m.warning("Something went wrong generating your GPT",{duration:3})}finally{q.current=v.tQ.getThreadCurrentLeafId(e),ec(!1)}},X=function(e,t,i){var s;v.tQ.initThread(e,{kind:l.OL.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:i});let a=(0,f.j8)().id,r=null!==(s=(0,f.Bv)(e))&&void 0!==s?s:a,n=(0,eL.Z)(e,void 0,t,[]);return async(t,s,a)=>{if(0===a.length)return;let o=v.tQ.getThreadCurrentLeafId(e);for(let t of a){let i=(0,eS.Z)();v.tQ.updateTree(e,e=>{e.addNodeToEnd(o,{id:i,children:[],parentId:o,message:eD.Cv.getTextAsMessage(t,l.uU.System),metadata:{isClientCreatedSystemMessage:!0}})}),v.tQ.setThreadCurrentLeafId(e,i),o=i}let d=o;eY(e,d,t,s);let c={conversationMode:{kind:l.OL.GizmoMagicCreate,gizmo_id:t.current.id,behavior_overrides:i}},u=await (0,eF.rS)(),[m,p,g]=await Promise.all([eR.ZP.getEnforcementToken(u),eB.Z.getEnforcementToken(u),eU.Z.getEnforcementToken(u)]);n({model:r,completionType:l.Os.Next,parentNodeId:d,metadata:{},focusOnNewCompletion:!0,chatReq:u,arkoseToken:m,turnstileToken:p,proofToken:g,preflightTime:0,completionMetadata:c})}}(T,H,E),{0:$,1:ee}=(0,k.useState)(void 0);(0,k.useEffect)(()=>{ee((0,c.z$)(i))},[null==i?void 0:i.gizmo.id]);let et=async(e,t)=>{let i=(0,J.bw)(h.current,e.recipient,t);if(i.length>0){g.m.warning("Could not save GPT:\n\n".concat(i.map(e=>"- ".concat((0,J.sw)(e))).join("\n")),{duration:3});return}let s=await W(),r=s.gizmo.id;try{return P.A.logEvent(M.M.promoteGizmo,{gizmo_id:s.gizmo.id,sharing_recipient:e.recipient,editor_tab:es}),await F.mutateAsync({gizmoId:s.gizmo.id,data:{sharingSubjects:e.subjects,sharingRecipient:e.recipient,categories:null==t?void 0:[t]}},{onSuccess(e){a.setQueryData((0,m.Vw)(a,r).queryKey,e),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:r}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:r}]})}})}catch(t){t instanceof p.DC?ee({gizmoId:r,sharingRecipient:e.recipient,moderationType:c.Te.PublishBlocked,sharingTargets:t.response.sharing_targets,showModal:c.UJ.AppealAvailable}):(Z.U.addError(t),g.m.warning("Error saving GPT",{duration:2}))}},ei=D.isPending||F.isPending,{0:es,1:er}=(0,k.useState)(()=>{let e=C.m.getItem(C.F.GizmoEditorTab);return Object.values(e2).includes(e)?e:e2.MAGIC_MAKER}),{width:en}=function(){let{0:e,1:t}=(0,k.useState)({width:null,height:null});return(0,k.useLayoutEffect)(()=>{let e=()=>{t({width:window.innerWidth,height:window.innerHeight})};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e}();(0,k.useEffect)(()=>{null!=en&&en>=768&&es===e2.PREVIEW&&er(e2.MAGIC_MAKER)},[en,es]);let{0:el,1:eo}=(0,k.useState)(!1),{0:ed,1:ec}=(0,k.useState)(!1),{0:eu,1:em}=(0,k.useState)(void 0),{0:ep,1:eg}=(0,k.useState)(!1);return(0,ea.jsxs)("div",{className:"flex h-screen w-full flex-col items-center",children:[(0,ea.jsx)(eb,{gizmoEditorData:w,isLoading:ei,hasUnpublishedChanges:B,isUploadingProfilePic:el,isGeneratingProfilePic:ed,publishedGizmo:G,updateGizmo:Y,promoteGizmo:async(e,t)=>{let i=await et(e,t);return h.current=e0(e0({},h.current),{},{sharingRecipient:e.recipient}),z(h.current),C.m.setItem(C.F.GizmoEditorTab,es),i},appealGizmo:async(e,t)=>{null!=$&&ee(e0(e0({},$),{},{sharingRecipient:e,categories:null==t?void 0:[t],showModal:c.UJ.AppealAvailable}))},setAppealState:ee,revertDraft:null!=G&&B?()=>{let e=a.getQueryData((0,m.Vw)(a,h.current.id).queryKey);if(null!=e){let t=e3(e);h.current=t,z(t),W()}}:void 0,draftMessage:(0,ea.jsx)(eN,{isPublished:null!=G&&("marketplace"===G.gizmo.share_recipient||"workspace"===G.gizmo.share_recipient),hasUnpublishedChanges:B,isSavingDraft:R,upsertDraftError:U,className:"text-sm"}),showActionsModal:e=>{em(e)},className:"flex-shrink-0"}),$&&(0,ea.jsx)(c.MU,{appealState:$,onAppealClose:()=>ee(e0(e0({},$),{},{showModal:c.UJ.None})),onAppealSubmitted:()=>ee(e0(e0({},$),{},{showModal:c.UJ.AppealSent}))}),(0,ea.jsxs)("div",{className:"relative flex w-full grow overflow-hidden",children:[(0,ea.jsx)("div",{className:"flex w-full justify-center md:w-1/2",children:(0,ea.jsx)("div",{className:"h-full grow overflow-hidden",children:void 0!==eu?(0,ea.jsx)(e1,{currentlyEditingActionDomain:eu,gizmoEditorData:w,updateGizmo:Y,onClose:()=>{em(void 0)}}):ep?(0,ea.jsx)(u.a,{gizmoEditorData:w,updateGizmo:Y,onClose:()=>{eg(!1)}}):(0,ea.jsxs)("div",{className:"flex h-full flex-col px-2 pt-2",children:[(0,ea.jsx)("div",{className:"flex w-full flex-row justify-center",children:(0,ea.jsx)(e5,{editorTab:es,setEditorTab:er,className:"mb-2 flex-shrink-0 self-center"})}),(0,ea.jsx)("div",{className:"grow overflow-hidden",children:es===e2.MAGIC_MAKER?(0,ea.jsx)("div",{className:"h-full w-full pb-5",children:(0,ea.jsx)(eH,{gizmoEditorData:w,updateGizmo:Y,completionCallbackResponse:H,clientThreadId:T,gizmoEditorDataRef:h,magicMakerBehaviorOverrides:E,magicMakerConversationGizmoEditorDataRef:y,requireGizmoId:V},T)}):es===e2.ADVANCED?(0,ea.jsx)(ew.cK,{gizmoEditorData:w,updateGizmo:Y,currentModelConfig:A,generateProfilePic:()=>{ec(!0),X(h,y,["Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response."])},setIsUploadingProfilePic:eo,isGeneratingProfilePic:ed,setIsGeneratingProfilePic:ec,requireGizmoId:V,onShowActionsEditor:e=>{em(e)},onShowBlocksEditor:()=>{eg(!0)}}):(0,ea.jsx)(eM.P,{gizmoEditorData:w,currentModelConfig:A,isSavingDraft:R,showTitle:!1})})]})})}),(0,ea.jsx)("div",{className:(0,O.default)("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",es!==e2.PREVIEW&&"md:flex"),children:(0,ea.jsx)("div",{className:"flex-grow pb-5",children:(0,ea.jsx)("div",{className:"h-full",children:(0,ea.jsx)(eM.P,{gizmoEditorData:w,currentModelConfig:A,isSavingDraft:R})})})})]})]})};function e7(e){let{gizmoId:t,version:i}=e,{data:s}=(0,m.DC)({gizmoId:t,draft:!0,version:i}),a=(0,j.ec)(j.F_.accountUserId),r=(0,j.aF)(),n=null==r?void 0:r.id,l=null!=s&&null!=a&&null!=n&&(0,eX.k1)(s);return null!=s&&l?(0,ea.jsx)(e9,{gizmo:s}):null}function te(e){let{onNewGizmoId:t}=e;return(0,ea.jsx)(e9,{gizmo:void 0,onNewGizmoId:t})}function tt(e){let{gizmoId:t,remixSourceId:i,version:s}=e,a=(0,E.useRouter)(),r=(0,h.t)(),n=(0,k.useRef)(void 0),l=t;return null!=t&&n.current===t&&(l=void 0),(0,y.yx)({resetThreadAction:()=>{a.push("/")}}),(0,ea.jsx)("div",{children:null!=r&&r.data?(0,ea.jsx)("div",{children:void 0!=l?(0,ea.jsx)(e7,{gizmoId:l,version:s},l):(0,ea.jsx)(te,{remixSourceId:i,onNewGizmoId:e=>{n.current=e,window.history.replaceState(window.history.state,"",(0,w.AA)(e))}})}):(0,ea.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,ea.jsx)(o.Z,{})})})}let ti=(0,A.vU)({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}})},6175:function(e,t,i){i.d(t,{P:function(){return G},gP:function(){return A},f7:function(){return L}});var s,a=i(85734),r=i(86021),n=i(65513),l=i(61888),o=i(99962),d=i(55059),c=i(651);function u(e){let{clientThreadId:t}=e,i=(0,r.oq)(t),s=(0,d.Bv)(t),a=(0,r.U0)(t,i),u=[...Array(a).keys()].map(e=>(0,c.jsx)(o.Z,{isFinalTurn:e===a-1,turnIndex:e,clientThreadId:t,conversationLeafId:i,onChangeItemInView:l.noop,onChangeRating:l.noop,onRequestMoreCompletions:l.noop,onRequestCompletion:n.C,currentModelId:null!=s?s:""},e));return(0,c.jsx)(c.Fragment,{children:u})}function m(e){let{clientThreadIds:t}=e;return(0,c.jsx)(c.Fragment,{children:t.map(e=>(0,c.jsx)(u,{clientThreadId:e},e))})}var p=i(71611),g=i(3502),f=i(81412),h=i(75438),x=i(8230),v=i(27480),j=i(55371),b=i(84466),y=i(92558),w=i(55179),k=i(23016),z=i(71199),N=i(82660),P=i(19841),M=i(556),Z=i(92379),C=i(72256),O=i(8844),_=i(66246),T=i(69965),S=i(21629),E=i(46868);function I(){return(0,c.jsxs)("div",{className:"flex items-center",children:[(0,c.jsx)("div",{className:"border-token-border-secondary flex-grow border-b"}),(0,c.jsxs)("div",{className:"flex flex-shrink-0 items-center gap-2 px-2 py-6 text-sm text-token-text-tertiary",children:[(0,c.jsx)(_.vHI,{className:"icon-sm"}),(0,c.jsx)(C.Z,{id:"qtaMEG",defaultMessage:"GPT updated"})]}),(0,c.jsx)("div",{className:"border-token-border-secondary flex-grow border-b"})]})}let L=((s={}).TestGizmoAction="test_gizmo_action",s),A=new y.V,G=Z.memo(function(e){var t;let{gizmoEditorData:i,isSavingDraft:s,currentModelConfig:n,showTitle:o=!0}=e,{0:d,1:u}=(0,Z.useState)(()=>(0,r.OX)()),{0:y,1:_}=(0,Z.useState)([]);(0,Z.useEffect)(()=>{_(e=>e[e.length-1]===d?e:[...e,d])},[d]);let L=y.slice(0,-1);(0,v.a)(d,{kind:a.OL.GizmoTest,gizmo_id:i.id}),(0,Z.useEffect)(()=>{r.tQ.updateConversationMode(d,{kind:a.OL.GizmoTest,gizmo_id:i.id})},[d,i.id]);let G=null===(t=i.files)||void 0===t?void 0:t.map(e=>e.file_id).join();(0,Z.useEffect)(()=>{null!=r.tQ.getServerThreadId(d)&&u((0,r.OX)())},[i.id,i.instructions,i.tools,G,d]);let D=(0,j.tN)(e=>e.activeSidebar),R=(0,Z.useMemo)(()=>({gizmoEditorData:i,mode:"test"}),[i]),{0:U,1:F}=(0,Z.useState)(0),B=()=>{F(e=>e-360)},W=i.id,Q=function(e,t){let i=(0,T.Z)(e,void 0,l.noop,[]);return(0,Z.useCallback)(async(s,n,l)=>{if(!t)return;let o=r.tQ.getThreadCurrentLeafId(e),d=(0,O.Z)(),c=(0,h.VN)(n);r.tQ.updateTree(e,e=>{e.addNodeToEnd(o,{id:d,children:[],parentId:o,message:{id:d,author:{role:a.uU.User},content:{content_type:a.PX.Text,parts:["Call the ".concat(n," API with the ").concat(l," operation")]},recipient:"all",metadata:{jit_plugin_data:{from_client:{type:"test",operation:l,tool_name:c}}}}})});let u={conversationMode:{kind:a.OL.GizmoTest,gizmo_id:s}},m=await (0,z.rS)(),[p,g,f]=await Promise.all([w.ZP.getEnforcementToken(m),N.Z.getEnforcementToken(m),k.Z.getEnforcementToken(m)]);i({model:t.id,completionType:a.Os.Next,parentNodeId:d,metadata:{},focusOnNewCompletion:!0,chatReq:m,arkoseToken:p,turnstileToken:g,proofToken:f,preflightTime:0,completionMetadata:u})},[e,i,t])}(d,n);return(0,Z.useEffect)(()=>(0,b.LW)(A,{test_gizmo_action:e=>{let{rootDomain:t,operationName:i}=e;W&&Q(W,t,i)}}),[Q,W]),(0,c.jsx)(S.D.Provider,{value:R,children:(0,c.jsxs)("div",{className:(0,P.default)("flex h-full w-full",s&&"cursor-wait opacity-80 transition"),children:[(0,c.jsxs)("div",{className:"flex grow flex-col",children:[(0,c.jsx)("div",{className:"relative mb-2 flex-shrink-0",children:(0,c.jsx)("div",{className:"flex justify-center py-1",children:o&&(0,c.jsxs)("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[(0,c.jsx)("div",{className:"icon-md"}),(0,c.jsxs)("button",{onClick:()=>{B(),_([]),u((0,r.OX)())},className:"flex items-center gap-2",children:[(0,c.jsx)(C.Z,{id:"2u/6Ja",defaultMessage:"Preview"}),(0,c.jsx)(M.E.div,{className:"text-token-text-primary",animate:{rotate:U},transition:{duration:.3},children:(0,c.jsx)(f.u8,{className:"icon-md invisible group-hover:visible"})})]})]})})}),(0,c.jsx)("div",{className:(0,P.default)("relative grow overflow-auto px-2",s&&"pointer-events-none"),children:(0,c.jsx)(p.Z,{clientThreadId:d,hideHeader:!0,renderEmptyState:(0,c.jsxs)("div",{className:"relative h-full w-full",children:[null!=L&&L.length>0&&(0,c.jsx)("div",{className:"h-full w-full opacity-20",children:(0,c.jsxs)(g.I,{children:[(0,c.jsx)(m,{clientThreadIds:L}),(0,c.jsx)(I,{})]})}),(0,c.jsx)("div",{className:"absolute left-0 top-0 h-full w-full",children:(0,c.jsx)(E.r,{gizmo:i,hideOwner:!0,showStarterPrompts:!0})})]}),prependThreadChildren:L.length>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"opacity-50",children:(0,c.jsx)(m,{clientThreadIds:L})}),(0,c.jsx)(I,{})]})})})]}),"debug"===D&&(0,c.jsx)(x.DebugConversationSidebar,{clientThreadId:d,slideOver:!1,onClose:()=>j.vm.toggleActiveSidebar("debug"),isOpen:!0})]})})})},93696:function(e,t,i){i.d(t,{C6:function(){return ei},O2:function(){return ea},P6:function(){return et},hD:function(){return J},uj:function(){return es},xH:function(){return q}});var s,a=i(41141),r=i(94521),n=i(21904),l=i(93223),o=i(4702),d=i(24040),c=i(26123),u=i(72256),m=i(25940),p=i(5443),g=i(67165),f=i(49217),h=i(20876),x=i(35226),v=i(14816),j=i(19841),b=i(61888),y=i.n(b),w=i(92379),k=i(74091),z=i(97289),N=i(24768),P=i(66246),M=i(27160),Z=i(57849),C=i(98682),O=i(8735),_=i(62484),T=i(65530),S=i(12715),E=i(94982),I=i(29707),L=i(81892),A=i(61885),G=i(83252),D=i(82823),R=i(31310),U=i(56029),F=i(16645),B=i(97821),W=i(651);function Q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function V(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(i),!0).forEach(function(t){(0,r.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let K=[F.EL,F.fV],Y={[F.LA.USER]:F.Zz.User,[F.LA.GROUP]:F.Zz.Group,[F.LA.WORKSPACE]:F.Zz.Workspace,[F.LA.ALL]:F.Zz.Marketplace};function q(e){let t=Y[e.type];if(!t)throw Error("Unknown sharing subject type: "+e.type);return V(V({},e),{},{type:t})}function J(e){var t,i,s,a,r,m,h,v,b,k;let{gizmo:N,publishedGizmo:M,updateGizmo:Z,promoteGizmo:C,appealGizmo:T,setAppealState:S,showActionsModal:A,shareOnly:G,onClose:Q,workspaceOwner:Y=!1}=e,J=(0,c.Z)(),H=(0,o.t)(),X=null!==(t=null==H||null===(i=H.data)||void 0===i?void 0:i.name)&&void 0!==t?t:"your workspace",et=(0,d.aF)(),er=(0,D.Z1)(),{0:el,1:eo}=(0,w.useState)(void 0);(0,w.useEffect)(()=>{if(void 0==el){if(null!=M&&M.gizmo.display.categories&&(null==M?void 0:M.gizmo.display.categories.length)>0){var e;let t=null===(e=er.data)||void 0===e?void 0:e.categories.find(e=>e.id===(null==M?void 0:M.gizmo.display.categories[0]));t&&eo(t)}else void 0!=er.data&&eo(er.data.categories[er.data.categories.length-1])}},[er.data,el,M]);let{0:ed,1:ec}=(0,w.useState)(null!==(s=N.sharingRecipient)&&void 0!==s?s:F.Zz.Private),{0:eu,1:em}=(0,w.useState)(null!==(a=null===(r=N.sharing)||void 0===r?void 0:r.subjects)&&void 0!==a?a:[]),{0:ep,1:eg}=(0,w.useState)(null),{0:ef,1:eh}=(0,w.useState)(!1),ex=(0,w.useCallback)(()=>{var e;return!y().isEqual(null===(e=N.sharing)||void 0===e?void 0:e.subjects,eu)||N.sharingRecipient!==ed},[N.sharing,N.sharingRecipient,ed,eu]),ev=(0,x.NL)(),ej=(0,R.bw)(N,ed,null!==(m=null==el?void 0:el.id)&&void 0!==m?m:void 0),eb=ej.includes(R.hs.MissingPublicActionPrivacyPolicyURL),ey=N.tools.find(e=>e.type===n.qK.JIT_PLUGIN&&!e.metadata.privacy_policy_url);if(ep)return(0,W.jsx)(es,{publishedGizmo:ep,sharing:{recipient:ed,subjects:eu},workspaceName:X,onClose:Q});let ew=(0,F.H$)(eu);function ek(e){let t=eu.filter(e=>-1===[F.LA.WORKSPACE,F.LA.ALL].indexOf(e.type));null!=e&&t.push(e),em(t)}function ez(e){null!=ew&&em(eu.map(t=>t===ew?V(V({},t),{},{capabilities:e}):t))}function eN(e,t,i){return e.type===F.LA.USER&&-1===e.user_id.indexOf("__")?V(V({},e),{},{user_id:e.user_id+"__"+(null==H?void 0:H.getWorkspaceId())}):e}async function eP(e,t){var i,s;if(ef)return;if(e&&!t)throw Error("Cannot share a gizmo that hasn't been promoted before");if(!el)return;eh(!0);let a=eu.map(eN).map(q);if(a=(0,F.Mj)(ed,a,null!==(i=null==ew?void 0:ew.capabilities)&&void 0!==i?i:F.EL),Y)return H&&t?(await l.Z.updateWorkspaceGPTSharing(H.id,t,a),E.m.success(J.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),ev.invalidateQueries({queryKey:["workspace"]})):E.m.warning("Unable to change sharing settings"),Q();if(e){if(!t||!M)throw Error("No gizmo ID to share");try{let e={sharing:a};el&&(e.categories=[el.id]);let i=await U.U.shareGizmo(t,e);i.error?(0,I.nJ)(ed,i.sharing_targets)?(S({gizmoId:M.gizmo.id,sharingRecipient:ed,categories:M.gizmo.display.categories,moderationType:L.Te.PublishBlocked,sharingTargets:i.sharing_targets,showModal:L.UJ.AppealAvailable}),Q()):E.m.warning(J.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})):(ev.setQueryData(["gizmo",{gizmoId:M.gizmo.id},{draft:!1}],e=>i.resource),Z(e=>V(V({},e),{},{sharingRecipient:ed})),E.m.success(J.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),Q())}catch(e){return E.m.warning(J.formatMessage({id:"dKC65l",defaultMessage:"Failed to update sharing settings"})),Q()}}else{let e=await C({subjects:a,recipient:ed},el.id);t||(t=null==e?void 0:e.gizmo.id),eg(null!=e?e:null),Z({liveVersion:null!==(s=null==e?void 0:e.gizmo.live_version)&&void 0!==s?s:void 0}),ev.invalidateQueries({queryKey:["gizmo",{gizmoId:t}]})}eh(!1),ev.invalidateQueries({queryKey:["gizmos"]}),ev.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:t}]}),ev.invalidateQueries({queryKey:["workspace"]}),Z({sharing:{recipient:ed,subjects:eu},sharingRecipient:ed},!1)}return(0,W.jsx)(f.Z,{type:"success",className:"max-w-[555px]",size:"custom",isOpen:!0,onClose:Q,primaryButton:(0,I.nJ)(ed,N.sharingTargets)?(0,W.jsx)(p.z,{onClick:()=>T(ed,null==el?void 0:el.id),children:(0,W.jsx)(u.Z,{id:"HRzqKK",defaultMessage:"Appeal"})}):(0,W.jsx)(p.z,{onClick:()=>eP(G,null==M?void 0:M.gizmo.id),loading:ef,disabled:ej.length>0||!(0,I.YK)(ed,N.sharingTargets),children:G?(0,W.jsx)(u.Z,{id:"BEKjVh",defaultMessage:"Save"}):(0,W.jsx)(u.Z,{id:"24j5ts",defaultMessage:"Update"})}),secondaryButton:(0,W.jsxs)(W.Fragment,{children:[ex()&&(0,W.jsx)("div",{className:"absolute bottom-8 left-6 text-sm text-token-text-secondary",children:(0,W.jsx)(u.Z,{id:"9CkgC4",defaultMessage:"Unsaved changes"})}),M&&(0,W.jsx)(p.z,{color:"secondary",onClick:()=>(0,B.A4)(M,J.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:(0,W.jsx)(u.Z,{id:"wvL15a",defaultMessage:"Copy link"})})]}),title:J.formatMessage({id:"7JggXH",defaultMessage:"Share GPT"}),showCloseButton:!0,children:(0,W.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,W.jsx)(en,{onAdd:e=>{eu.find(t=>t.type===F.LA.USER?t.user_id===e.user_id:t.type===F.LA.GROUP?t.group_id===e.group_id:t.type===e.type)||em([...eu,e])},publishedGizmo:M}),(0,W.jsx)("h3",{className:"text-base font-semibold",children:(0,W.jsx)(u.Z,{id:"bNQXcV",defaultMessage:"Share with..."})}),(0,W.jsxs)("div",{className:"max-h-[200px] space-y-2 overflow-y-auto",children:[(0,W.jsxs)("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[(0,W.jsx)("div",{className:"shrink-0 grow-0 self-start",children:(0,W.jsx)(z.Yt,{user:et,size:"gizmoConversation",roundedStyle:"rounded-full"})}),(0,W.jsx)("div",{className:"grow",children:M&&(b=null==M?void 0:M.gizmo.author.user_id.split("__")[0],k=null==et?void 0:et.id,void 0===b||void 0===k||b.split("__")[0]!==k.split("__")[0])?(0,W.jsx)("span",{className:"text-base font-semibold",children:(0,W.jsx)(u.Z,{id:"scRZqV",defaultMessage:"{userName} (builder)",values:{userName:null==M?void 0:M.gizmo.author.display_name}})}):(0,W.jsxs)("div",{className:"flex flex-col",children:[(0,W.jsx)("span",{className:"text-base font-semibold",children:(0,W.jsx)(u.Z,{id:"U7tzof",defaultMessage:"{userName} (you)",values:{userName:null==et?void 0:et.name}})}),(0,W.jsx)("span",{className:"-mt-1 text-sm text-token-text-secondary",children:null==et?void 0:et.email})]})})]}),eu.map((e,t)=>(0,F.h)(e)&&(0,W.jsxs)("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[(0,W.jsx)(z.m0,{name:e.type===F.LA.GROUP?e.group_name:"".concat(e.user_name," ").concat(e.user_email),initialsCount:e.type===F.LA.USER?2:1,size:"gizmoConversation",className:(0,j.default)("shrink-0 grow-0",e.type===F.LA.USER&&"self-start")}),(0,W.jsxs)("div",{className:"flex grow flex-col",children:[(0,W.jsx)("span",{className:"text-base font-semibold",children:e.type===F.LA.GROUP?e.group_name:e.user_name}),e.type===F.LA.USER&&(0,W.jsx)("span",{className:"-mt-1 text-sm text-token-text-secondary",children:e.user_email})]}),(0,W.jsxs)(g.Z.Root,{children:[(0,W.jsxs)(g.Z.Trigger,{className:"whitespace-nowrap text-token-text-secondary",children:[(0,W.jsx)(u.Z,V({},$(e.capabilities))),(0,W.jsx)(P.T2M,{className:"icon-md"})]}),(0,W.jsx)(g.Z.Portal,{children:(0,W.jsxs)(g.Z.Content,{className:"max-w-[280px]",children:[K.map((t,i)=>(0,W.jsx)(ee,{caps:t,selected:y().isEqual(t,e.capabilities),onClick:()=>{em(eu.map(i=>i===e?V(V({},i),{},{capabilities:t}):i))}},i)),(0,W.jsx)(g.Z.Separator,{}),(0,W.jsx)(g.Z.Item,{onClick:()=>em(eu.filter(t=>t!==e)),color:"danger",icon:P.XHJ,children:(0,W.jsx)(u.Z,{id:"NU0BOB",defaultMessage:"Remove"})})]})})]})]},t))]}),(0,W.jsx)("hr",{className:"border-token-border-medium"}),(0,W.jsx)("h3",{className:"text-base font-semibold",children:(0,W.jsx)(u.Z,{id:"uqD7Y8",defaultMessage:"Access"})}),(0,W.jsxs)("div",{className:"flex flex-row items-center justify-between space-x-3",children:[(0,W.jsxs)(O.Z.Root,{value:ed,onValueChange:e=>(function(e){switch(ec(e),e){case F.Zz.Marketplace:case F.Zz.Link:ek({type:F.LA.ALL,capabilities:F.EL});break;case F.Zz.Workspace:case F.Zz.WorkspaceLink:ek({type:F.LA.WORKSPACE,capabilities:F.EL});break;default:ek(null)}})(e),children:[(0,W.jsxs)(O.Z.Trigger,{children:[(0,W.jsx)(O.Z.Value,{}),(0,W.jsx)(O.Z.Icon,{})]}),(0,W.jsx)(O.Z.Portal,{children:(0,W.jsxs)(O.Z.Content,{children:[(0,W.jsxs)(O.Z.Group,{children:[(0,W.jsx)(O.Z.Label,{children:(0,W.jsx)(u.Z,{id:"YIQwaP",defaultMessage:"Private"})}),(0,W.jsx)(O.Z.Item,{value:F.Zz.Private,children:(0,W.jsx)(ei,{shareLevel:F.Zz.Private,workspaceName:X})})]}),(0,W.jsx)(O.Z.Separator,{}),(0,W.jsx)(_.E,{label:J.formatMessage({id:"n0m61x",defaultMessage:"Your workspace has disabled sharing with the workspace."}),side:"bottom",disabled:(0,I.YK)("workspace",N.sharingTargets),children:(0,W.jsxs)(O.Z.Group,{children:[(0,W.jsx)(O.Z.Label,{children:X}),(0,W.jsx)(O.Z.Item,{value:F.Zz.WorkspaceLink,disabled:!(0,I.YK)(F.Zz.WorkspaceLink,N.sharingTargets)&&!(0,I.YK)(F.Zz.Workspace,N.sharingTargets),children:(0,W.jsx)(ei,{shareLevel:F.Zz.WorkspaceLink,workspaceName:X})}),(0,W.jsx)(O.Z.Item,{value:F.Zz.Workspace,disabled:!(0,I.YK)("workspace",N.sharingTargets),children:(0,W.jsx)(ei,{shareLevel:F.Zz.Workspace,workspaceName:X})})]})}),(0,W.jsx)(O.Z.Separator,{}),(0,W.jsx)(_.E,{label:J.formatMessage({id:"IHnort",defaultMessage:"Your workspace has disabled public sharing."}),side:"bottom",disabled:(0,I.YK)("marketplace",N.sharingTargets),children:(0,W.jsxs)(O.Z.Group,{children:[(0,W.jsx)(O.Z.Label,{children:(0,W.jsx)(u.Z,{id:"PjY9bi",defaultMessage:"Public"})}),(0,W.jsx)(O.Z.Item,{value:F.Zz.Link,disabled:!(0,I.YK)("link",N.sharingTargets),children:(0,W.jsx)(ei,{shareLevel:F.Zz.Link,workspaceName:X})}),(0,W.jsx)(O.Z.Item,{disabled:!(0,I.YK)("marketplace",N.sharingTargets),value:F.Zz.Marketplace,children:(0,W.jsx)(ei,{shareLevel:F.Zz.Marketplace,workspaceName:X})})]})})]})})]}),ed!==F.Zz.Private&&ed!==F.Zz.User&&(0,W.jsxs)(g.Z.Root,{children:[(0,W.jsxs)(g.Z.Trigger,{className:"whitespace-nowrap",children:[null==ew?(0,W.jsx)(u.Z,V({},$(F.EL))):(0,W.jsx)(u.Z,V({},$(ew.capabilities))),(0,W.jsx)(P.T2M,{className:"icon-md"})]}),(0,W.jsx)(g.Z.Portal,{children:(0,W.jsxs)(g.Z.Content,{className:"max-w-[280px]",children:[(0,W.jsx)(ee,{onClick:()=>ez(F.EL),caps:F.EL,selected:y().isEqual(null==ew?void 0:ew.capabilities,F.EL)}),ed!==F.Zz.Marketplace&&ed!==F.Zz.Link&&(0,W.jsx)(ee,{onClick:()=>ez(F.fV),caps:F.fV,selected:y().isEqual(null==ew?void 0:ew.capabilities,F.fV)})]})})]})]}),eb&&(0,W.jsx)("div",{className:"text-xs text-red-500",children:(0,W.jsx)(u.Z,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:e=>(0,W.jsx)("button",{onClick:()=>{A(null==ey?void 0:ey.metadata.action_id),Q()},className:"underline",children:e})}})}),(ed===F.Zz.Marketplace||ed===F.Zz.Workspace)&&((0,I.YK)(ed,N.sharingTargets)?(0,W.jsx)(ea,{gizmo:N,category:null==el?void 0:el.id,categories:null===(h=er.data)||void 0===h?void 0:h.categories,onCategoryChange:e=>eo(e)}):(0,I.nJ)(ed,N.sharingTargets)?(0,W.jsx)("div",{className:"pb-2 text-xs text-red-500",children:(0,W.jsx)(L.JE,{sharingRecipient:ed,moderatedFields:null!==(v=(0,I.ai)(ed,N.sharingTargets))&&void 0!==v?v:[],appealAvailable:!0})}):(0,W.jsx)("div",{className:"pb-2 text-xs text-red-500",children:(0,W.jsx)(u.Z,{id:"BzqqKH",defaultMessage:"Your workspace's settings don't allow this level of access. An owner of the workspace can change this setting in the workspace's GPTs settings."})}))]})})}let H=(0,m.vU)({private:{id:"pSXBWQ",defaultMessage:"Invite-only"},user:{id:"pSXBWQ",defaultMessage:"Invite-only"},group:{id:"pSXBWQ",defaultMessage:"Invite-only"},workspace_link:{id:"Giaxt1",defaultMessage:"Anyone at {workspaceName} with the link"},workspace:{id:"XLHaTU",defaultMessage:"{workspaceName}"},link:{id:"uP1+Ri",defaultMessage:"Anyone with the link"},marketplace:{id:"82Ilac",defaultMessage:"GPT Store"}}),X=(0,m.vU)({workspace:{id:"1kpopF",defaultMessage:"Published to {workspaceName}"},marketplace:{id:"hdTRpJ",defaultMessage:"Published to GPT Store"}});function $(e){return e.can_write?(0,m.Em)({id:"SubCqD",defaultMessage:"Can edit"}):e.can_view_config?(0,m.Em)({id:"ud3lp4",defaultMessage:"Can view configuration"}):e.can_read?(0,m.Em)({id:"/0j34W",defaultMessage:"Can chat"}):(0,m.Em)({id:"x2E8ET",defaultMessage:"Unknown"})}function ee(e){let{caps:t,selected:i,onClick:s}=e,a=P.vdY;return t.can_view_config?a=P.KAl:t.can_read&&(a=P.kBi),(0,W.jsx)(g.Z.Item,{className:"flex h-auto flex-row items-start space-x-3 px-3 py-3",onClick:s,icon:a,children:t.can_write?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("div",{className:"flex grow flex-col",children:(0,W.jsx)("span",{className:"text-sm font-semibold",children:(0,W.jsx)(u.Z,V({},$(t)))})}),(0,W.jsx)(P.kvR,{className:(0,j.default)("icon-md shrink-0",!i&&"invisible")})]}):t.can_view_config?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{className:"flex grow flex-col",children:[(0,W.jsx)("span",{className:"align-baseline text-sm font-semibold",children:(0,W.jsx)(u.Z,V({},$(t)))}),(0,W.jsx)("span",{className:"text-xs text-token-text-secondary",children:(0,W.jsx)(u.Z,{id:"fL1rWw",defaultMessage:"View configuration settings, duplicate, and chat"})})]}),(0,W.jsx)(P.kvR,{className:(0,j.default)("icon-md shrink-0",!i&&"invisible")})]}):t.can_read?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{className:"flex grow flex-col",children:[(0,W.jsx)("span",{className:"text-sm font-semibold",children:(0,W.jsx)(u.Z,V({},$(t)))}),(0,W.jsx)("span",{className:"text-xs text-token-text-secondary",children:(0,W.jsx)(u.Z,{id:"tx5q1o",defaultMessage:"Users can only chat with this GPT"})})]}),(0,W.jsx)(P.kvR,{className:(0,j.default)("icon-md shrink-0",!i&&"invisible")})]}):null})}let et={private:C.Z,user:C.Z,group:C.Z,workspace_link:Z.Z,workspace:M.Z,link:Z.Z,marketplace:P.frp};function ei(e){let{shareLevel:t,workspaceName:i,hasInviteSharing:s=!0}=e;(t===F.Zz.User||t===F.Zz.Group)&&(t=F.Zz.Private);let a=et[t];return(0,W.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,W.jsx)(a,{className:"icon-md"}),(0,W.jsx)("div",{className:"line-clamp-1 pt-px",children:s||t!==F.Zz.Private?(0,W.jsx)(u.Z,V(V({},H[t]),{},{values:{workspaceName:i}})):(0,W.jsx)(u.Z,{id:"vVJhYB",defaultMessage:"Only me"})})]})}function es(e){var t,i;let{publishedGizmo:s,sharing:a,workspaceName:r,onClose:n}=e,l=a.recipient,o=et[l],d=(0,c.Z)();return(0,W.jsxs)(f.Z,{isOpen:!0,onClose:n,showCloseButton:!0,className:"w-[304px]",title:(0,W.jsx)(u.Z,{id:"5CEceY",defaultMessage:"GPT Updated"}),primaryButton:(0,W.jsx)(p.z,{onClick:()=>{window.location.href="/g/".concat(s.gizmo.id)},children:(0,W.jsx)(u.Z,{id:"RF75o5",defaultMessage:"View GPT"})}),secondaryButton:(0,W.jsx)(p.z,{color:"secondary",onClick:()=>(0,B.A4)(s,d.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:(0,W.jsx)(u.Z,{id:"9hLOl9",defaultMessage:"Copy link"})}),type:"success",children:[(0,W.jsx)(ea,{gizmo:{profilePictureUrl:null!==(t=s.gizmo.display.profile_picture_url)&&void 0!==t?t:void 0,name:s.gizmo.display.name}}),a.subjects.filter(e=>(0,F.h)(e)).length>0&&(0,W.jsxs)("div",{className:"my-4",children:[(0,W.jsx)("h4",{className:"text-xs font-semibold text-token-text-secondary",children:(0,W.jsx)(u.Z,{id:"/paYH9",defaultMessage:"Shared with"})}),a.subjects&&a.subjects.map((e,t)=>(0,F.h)(e)&&(0,W.jsxs)("div",{className:"flex flex-row items-center justify-between space-x-3 py-2 ",children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("span",{className:"text-base font-semibold",children:e.type===F.LA.GROUP?e.group_name:e.user_name}),e.type===F.LA.USER&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("br",{}),(0,W.jsx)("span",{className:"text-sm text-token-text-secondary",children:e.user_email})]})]}),(0,W.jsx)("span",{className:"text-token-text-secondary",children:(0,W.jsx)(u.Z,V({},$(e.capabilities)))})]},t))]}),(0,W.jsxs)("div",{className:"my-4",children:[(0,W.jsx)("h4",{className:"text-xs font-semibold text-token-text-secondary",children:(0,W.jsx)(u.Z,{id:"q9XNZ7",defaultMessage:"Access"})}),(0,W.jsxs)("div",{className:"ml-[3px] flex flex-row items-center py-3 text-left text-base font-semibold",children:[(0,W.jsx)(o,{className:"md:icon-lg mr-3 h-6 w-6 shrink-0"}),(0,W.jsxs)("div",{className:"flex flex-col",children:[(0,W.jsx)("span",{children:(0,W.jsx)(u.Z,V(V({},null!==(i=X[l])&&void 0!==i?i:H[l]),{},{values:{workspaceName:r}}))}),(l===F.Zz.Workspace||l===F.Zz.Marketplace)&&(0,W.jsx)("span",{className:"text-xs text-token-text-secondary"})]})]})]})]})}function ea(e){let{gizmo:t,category:i,categories:s,onCategoryChange:a}=e,{data:r,isLoading:n}=(0,D.WL)(),l=null==s?void 0:s.find(e=>e.id===i);return(0,W.jsxs)("div",{children:[(0,W.jsxs)("div",{className:(0,j.default)("mb-[1px] flex flex-row items-center space-x-2 bg-token-main-surface-secondary p-4",n&&"invisible",s?"rounded-t-lg":"rounded-lg"),children:[(0,W.jsx)(G.Z,{isFirstParty:!1,className:"h-11 w-11",src:t.profilePictureUrl}),(0,W.jsxs)("div",{className:"flex grow flex-col space-y-0",children:[(0,W.jsx)("span",{className:"font-semibold",children:t.name}),(0,W.jsx)(A.Z,{builderName:null==r?void 0:r.display_name,builderUrl:null==r?void 0:r.website_url,socials:[null==r?void 0:r.socials.linkedin,null==r?void 0:r.socials.github,null==r?void 0:r.socials.twitter].filter(e=>null!=e),className:"text-xs text-token-text-secondary"})]})]}),s&&(0,W.jsxs)("div",{className:"flex min-h-[56px] flex-row items-center justify-between space-x-2 rounded-b-lg bg-token-main-surface-secondary px-4 text-sm",children:[(0,W.jsx)("span",{className:"font-semibold",children:(0,W.jsx)(u.Z,{id:"JcA4/t",defaultMessage:"Category"})}),a?(0,W.jsx)(g.d,{size:"small",triggerButton:(0,W.jsxs)("button",{className:"flex items-center gap-1",children:[null==l?void 0:l.title,(0,W.jsx)(P.T2M,{className:"icon-md"})]}),children:s.map((e,t)=>(0,W.jsx)(g.Z.Item,{onClick:()=>a(e),children:e.title},t))}):(0,W.jsx)("span",{className:"text-token-text-secondary",children:null==l?void 0:l.title})]})]})}let er=k.Z.li(s||(s=(0,a.Z)(["flex flex-col rounded-sm p-1 hover:bg-token-main-surface-secondary"])));function en(e){var t,i,s;let{onAdd:a,publishedGizmo:r}=e,n=(0,c.Z)(),d=(0,o.t)(),{0:m,1:p}=(0,w.useState)(""),g=null===(t=(0,N.Z)(null==d?void 0:d.id,0,m,5).data)||void 0===t?void 0:t.items.filter(e=>e.id!==(null==r?void 0:r.gizmo.author.user_id.split("__")[0])),{data:f}=(0,v.a)({queryKey:[null==d?void 0:d.id,"groups","filtered",m],queryFn:()=>l.Z.getWorkspaceGroups(d.id,{query:m}),enabled:""!==m.trim()&&null!=d&&!!d.getWorkspaceId()}),x=(null!==(i=null==g?void 0:g.length)&&void 0!==i?i:0)>0||(null!==(s=null==f?void 0:f.items.length)&&void 0!==s?s:0)>0,{0:j,1:b}=(0,w.useState)(!1);return(0,W.jsx)(W.Fragment,{children:(0,W.jsx)("div",{className:"flex w-full flex-row space-x-3",children:(0,W.jsxs)(h.J,{as:"div",className:"group relative z-10 grow",children:[(0,W.jsx)(T.Z,{list:"suggested-choices",name:"share-with-input",placeholder:null!=d&&d.isEnterprise()?n.formatMessage({id:"xy/AMO",defaultMessage:"Add people and groups from your workspace"}):n.formatMessage({id:"Lh9njB",defaultMessage:"Add people from your workspace"}),value:m,onChange:e=>p(e.target.value),onFocus:()=>b(!0),onBlur:()=>b(!1)}),(0,W.jsx)(S.m,{show:""!==m.trim()&&x&&j,children:(0,W.jsx)(h.J.Panel,{static:!0,className:"absolute top-8 ml-0 w-full cursor-pointer overflow-y-auto rounded-lg rounded-t-none border border-t-0 border-token-border-light bg-token-main-surface-primary px-1 py-1 group-has-[:focus]:border-token-border-xheavy",children:""!==m.trim()&&(0,W.jsxs)("ul",{id:"suggested-choices",children:[g&&g.map(e=>(0,W.jsxs)(er,{tabIndex:0,className:"rounded-sm p-1 text-sm hover:bg-token-main-surface-secondary",onClick:()=>{var t,i,s;return t=e.id,i=e.name,s=e.email,void(d&&(a({type:F.LA.USER,user_id:t+"__"+d.getWorkspaceId(),user_name:i,user_email:s,capabilities:V({},F.EL)}),p("")))},children:[(0,W.jsx)("span",{className:"w-full font-semibold",children:e.name}),(0,W.jsx)("span",{className:"text-sm text-token-text-secondary",children:e.email})]},e.id)),(null==f?void 0:f.items)&&f.items.slice(0,5).map(e=>(0,W.jsxs)(er,{tabIndex:0,onClick:()=>{var t,i;return t=e.id,i=e.name,void(a({type:F.LA.GROUP,group_id:t,group_name:i,capabilities:V({},F.EL)}),p(""))},children:[(0,W.jsx)("span",{className:"font-semibold",children:e.name}),(0,W.jsx)("span",{className:"text-sm text-token-text-secondary",children:(0,W.jsx)(u.Z,{id:"r3Rx6X",defaultMessage:"{numMembers, plural, one {1 member} other {# members}}",values:{numMembers:e.num_members}})})]},e.id))]})})})]})})})}F.H$,F.EL,F.fV},8230:function(e,t,i){i.r(t),i.d(t,{DebugConversation:function(){return er},DebugConversationSidebar:function(){return ea},default:function(){return $},downloadMessages:function(){return en}});var s,a,r,n,l,o=i(41141),d=i(94521),c=i(85734),u=(i(64831),i(71840)),m=(i(93223),i(4702)),p=i(86021),g=i(92524),f=i(22770),h=i(20408),x=i(16054),v=(i(96053),i(35226)),j=i(48538),b=i(61888),y=i(86078),w=i.n(y),k=i(92379),z=i(26123),N=i(72256),P=i(25940),M=i(34189),Z=i(54368),C=i(74091),O=i(5443),_=i(10727),T=i(82783),S=i(20736),E=i(651);function I(e){let{children:t,sidebarOpen:i,onClose:s}=e;return(0,E.jsx)(T.u.Root,{show:i,as:k.Fragment,children:(0,E.jsxs)(S.V,{as:"div",className:"relative z-10",onClose:s,children:[(0,E.jsx)("div",{className:"fixed inset-0"}),(0,E.jsx)("div",{className:"fixed inset-0 overflow-hidden",children:(0,E.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,E.jsx)("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:(0,E.jsx)(T.u.Child,{as:k.Fragment,enter:"transform transition ease-in-out duration-100 sm:duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-300 sm:duration-500",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,E.jsx)(S.V.Panel,{className:"pointer-events-auto w-screen max-w-md border-l border-gray-100 dark:border-gray-700",children:(0,E.jsx)("div",{className:"h-full overflow-y-auto bg-token-main-surface-primary shadow-xl",children:t})})})})})})]})})}var L=i(62484),A=i(14975),G=i(66246),D=i(49217),R=i(73487),U=i(94982),F=i(34565);function B(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function W(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?B(Object(i),!0).forEach(function(t){(0,d.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):B(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function Q(e){var t;let{clientThreadId:i}=e,{rebaseSystemMessageContent:s,showDebugConversationTurns:a}=(0,F.N)(),{0:r,1:n}=(0,k.useState)(()=>s?JSON.stringify(s,null,2):void 0),{0:l,1:o}=(0,k.useState)(!!s),d=(0,p.u9)(i,p.tQ.getThreadCurrentLeafId(i)),m=(0,b.findLast)(d,e=>e.content.content_type===c.PX.SystemContent),g=null!==(t=null==m?void 0:m.content)&&void 0!==t?t:null,f=(0,k.useMemo)(()=>(0,b.debounce)(e=>{try{e?F.N.setState({rebaseSystemMessageContent:W(W({},JSON.parse(e)),{},{content_type:c.PX.SystemContent})}):F.N.setState({rebaseSystemMessageContent:null}),U.m.closeAll()}catch(e){U.m.danger("The System Message is not valid JSON")}},500),[]);return(0,k.useEffect)(()=>{l?f(r):(f.cancel(),F.N.setState({rebaseSystemMessageContent:null}))},[f,l,r]),(0,E.jsxs)("div",{className:"flex flex-col gap-3 px-4",children:[(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{className:"flex justify-between",children:[(0,E.jsx)(L.u,{label:"Enable to apply this system message to the current conversation.",children:(0,E.jsx)(u.Z,{id:"enabled",label:"Enabled",checked:l,onChange:e=>o(e.currentTarget.checked)})}),(0,E.jsx)(u.Z,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:a,onChange:()=>{F.N.setState({showDebugConversationTurns:!a})}})]}),(0,E.jsx)(O.z,{disabled:!g,className:"mt-2",onClick:()=>{n(g?JSON.stringify(g,null,2):"")},size:"small",children:"Load active system message"})]}),(0,E.jsxs)("div",{children:[(0,E.jsx)("label",{className:"text-sm",children:"System Message"}),(0,E.jsx)(V,{disabled:!l,placeholder:g?"Press `Load active system message` to pre-populate this":"Start a conversation and then press `Load active system message` to pre-populate this",className:"min-h-[75vh] rounded-md border border-gray-400 p-1 font-mono",value:r,onChange:e=>n(e.target.value)})]})]})}let V=C.Z.textarea(s||(s=(0,o.Z)(["w-full rounded-lg border border-token-border-light bg-token-main-surface-primary text-sm text-token-text-primary focus:border-token-text-primary focus:shadow-none focus:outline-none focus:ring-token-text-primary disabled:bg-token-main-surface-tertiary"])));var K=i(19841);function Y(e){let{clientThreadId:t}=e,{0:i,1:s}=(0,k.useState)([]),a=p.tQ.getThreadCurrentLeafId(t),r=p.tQ.getThreadConversationTurns(t,a),n=e=>{let i=p.tQ.getTree(t).getLeafFromNode(e);p.tQ.setThreadCurrentLeafId(t,i.id)},l=e=>{s(e=>[...e,a]),n(e)};return(0,E.jsxs)(E.Fragment,{children:[i.length>0&&(0,E.jsxs)(O.z,{className:"absolute left-2 top-2",color:"secondary",onClick:()=>{n(i[i.length-1]),s(e=>e.slice(0,-1))},children:[(0,E.jsx)(G.eF8,{className:"icon-sm"}),"Go back to ",i[i.length-1]]}),(0,E.jsx)("div",{className:"flex flex-col items-center gap-4 overflow-auto p-4 text-xs",children:r.map((e,i)=>{let s;let a=e.messages[0].nodeId,r=p.tQ.getTree(t),n=0!==i?r.getParent(a):null,o=null!=n?n.children.findIndex(e=>a===e):0,d=null!=n?n.children:[],u=d.slice(0,o),m=d.slice(o+1);switch(e.role){case c.uU.User:s="bg-blue-500";break;case c.uU.Assistant:s="bg-gray-600";break;default:s="bg-gray-400"}return(0,E.jsxs)("div",{className:(0,K.default)("relative p-2",s),children:[(0,E.jsx)("div",{className:"absolute bottom-0 left-0 -ml-2 flex -translate-x-full gap-2 pl-2",children:u.map(e=>(0,E.jsx)(q,{variantId:e,onChangeItemInView:l},e))}),(0,E.jsx)("div",{className:"absolute left-full top-0 ml-2 flex gap-2 pr-2",children:m.map(e=>(0,E.jsx)(q,{variantId:e,onChangeItemInView:l},e))}),(0,E.jsx)("div",{className:"flex flex-col gap-2",children:e.messages.map(e=>(0,E.jsxs)("div",{className:"h-14 w-32 truncate bg-gray-200 p-1 text-black",children:[(0,E.jsx)("div",{className:"font-semibold",children:e.nodeId}),(0,E.jsx)("div",{className:"italic text-token-text-tertiary",children:e.message.author.role}),(0,E.jsx)("div",{children:(0,g.RR)(e.message)})]},e.nodeId))})]},i)})})]})}function q(e){let{variantId:t,onChangeItemInView:i}=e;return(0,E.jsx)("button",{className:"w-32 truncate bg-gray-400 p-2 text-black opacity-50 hover:opacity-100",onClick:()=>{i(t)},children:(0,E.jsx)("span",{className:"bg-gray-200 p-2",children:t})},t)}function J(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function H(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?J(Object(i),!0).forEach(function(t){(0,d.Z)(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):J(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let X=w()(()=>Promise.all([i.e(5893),i.e(6113)]).then(i.bind(i,26113)).then(e=>e.default),{ssr:!1,loadableGenerated:{webpack:()=>[26113]}});function $(e){let{children:t,title:i,icon:s,isOpen:a,slideOver:r,onClose:n}=e,l=(0,E.jsxs)(ed,{children:[(0,E.jsxs)("div",{className:"flex items-start justify-between",children:[(0,E.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 text-lg font-semibold text-gray-900 dark:text-white",children:[(0,E.jsx)(s,{className:"icon-sm"}),i]}),(0,E.jsx)("div",{className:"mr-2 mt-2 flex h-7 items-center",children:(0,E.jsx)(A.P,{onClick:n})})]}),t]});return r?(0,E.jsx)(I,{sidebarOpen:a,onClose:n,children:l}):a?l:null}function ee(e){let{nodes:t,setDebugNodeIndex:i}=e,s=t.map((e,t)=>{var s;let a=e.message,{role:r,name:n}=a.author,l=(0,b.get)(a,"metadata.__internal.model_id"),o=(0,b.get)(a,"metadata.__internal.agent.settings.completion_api.engine"),d=(0,b.get)(a,"metadata.__internal.model_experiment_name"),u=(0,b.get)(a,"metadata.__internal.model_experiment_treatment"),m=(0,b.get)(a,"metadata.__internal.normalized_model_side"),p=(0,b.get)(a,"metadata.__internal.model_experiment_group_name"),f=(0,b.get)(a,"metadata.__internal.model_experiment_group_params"),x=(0,b.get)(a,"metadata.__internal.model_experiment_override"),v=(0,b.get)(a,"metadata.__internal.model_experiment_eval_seq"),j=null===(s=(0,b.get)(a,"metadata.__internal.raw_tokens"))||void 0===s?void 0:s.length,y=(0,b.get)(a,"metadata.request_id"),w=h.U.getAudio(a),k=h.U.getAudioAssetPointers(a);return(0,E.jsxs)(eu,{role:"button",onClick:()=>i(t),children:[(0,E.jsxs)("div",{className:"text-xs font-semibold uppercase text-token-text-tertiary",children:[r,n&&n!==r&&" (".concat(n,")"),a.recipient&&" -> ",(0,g.Ej)(a)]}),(a.author.role!==c.uU.System||y)&&(0,E.jsxs)("div",{className:"text-xs text-token-text-tertiary",children:[(0,E.jsxs)("div",{children:["ID: ",a.id]}),e.id!==a.id&&(0,E.jsxs)("div",{children:["UI Node ID: ",e.id]}),(0,E.jsxs)("div",{children:["Req ID: ",y||"Reload page to see ID"]})]}),(0,E.jsx)("div",{className:"line-clamp-6",children:(0,g.RR)(a)}),(j||l||o||d||u||m||p||f||x||v)&&(0,E.jsxs)("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[void 0!==j&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Tokens Count:"})," ",j]}),l&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Model ID:"})," ",l]}),o&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Engine:"})," ",o]}),d&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Experiment:"})," ",d]}),u&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Treatment:"})," ",u]}),m&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Normalized Side:"})," ",m]}),p&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Group Name:"})," ",p]}),f&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Group Params:"}),(0,E.jsx)("div",{children:JSON.stringify(f,null,2)})]}),x&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Above Params are Overridden By:"})," ",x]}),v&&(0,E.jsxs)("div",{children:[(0,E.jsx)("b",{children:"Experiment Eval Seq:"})," click to see"]})]}),w.length||k.length?(0,E.jsxs)("div",{className:"mt-4 flex flex-col flex-nowrap gap-2",children:[w.map((e,t)=>(0,E.jsx)(eo,{audio:e},t)),k.map((e,t)=>(0,E.jsx)(eo,{assetPointer:e},t))]}):null]},a.id)});return(0,E.jsx)(ec,{children:s})}let et=e=>(0,E.jsx)(M.c.Input,H(H({},e),{},{inputClassName:"focus:ring-0"}));function ei(){let e=(0,F.N)(),t=(0,R.ZP)().map(e=>({label:e.name,options:e.options.map(e=>({label:"".concat(e.value," (").concat(e.name,")"),value:e.value}))}));return(0,E.jsxs)("div",{className:"mt-2 flex flex-col justify-around gap-3 px-4 py-1 text-xs font-semibold ",children:[(0,E.jsx)(u.Z,{id:"force-paragen",label:"Force Parallel Gen",checked:e.forceParagen,onChange:()=>{F.N.setState({forceParagen:!e.forceParagen})}}),(0,E.jsx)(Z.ZP,{options:t,name:"force-paragen-model",className:"shadow-none dark:text-gray-800",isDisabled:!e.forceParagen,isLoading:0===t.length,value:e.forceParagenModel,isClearable:!0,isMulti:!1,components:{Input:et},onChange:e=>{F.N.setState({forceParagenModel:null!=e?e:F.J})}}),(0,E.jsx)(u.Z,{id:"force-paragen",label:"Force Nulligen",checked:e.forceNulligen,onChange:()=>{F.N.setState({forceNulligen:!e.forceNulligen})}}),(0,E.jsx)(u.Z,{id:"force-rate-limit",label:"Force Rate Limit",checked:e.forceRateLimit,onChange:()=>{F.N.setState({forceRateLimit:!e.forceRateLimit})}}),(0,E.jsx)(u.Z,{id:"reset-rate-limit",label:"Reset Rate Limits",checked:e.resetRateLimits,onChange:()=>{F.N.setState({resetRateLimits:!e.resetRateLimits})}}),(0,E.jsx)(L.u,{label:"Enabling this will show debug conversation messages in the chat",children:(0,E.jsx)(u.Z,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:e.showDebugConversationTurns,onChange:()=>{F.N.setState({showDebugConversationTurns:!e.showDebugConversationTurns})}})})]})}let es=C.Z.div(a||(a=(0,o.Z)(["px-3 pb-2 text-xs font-semibold uppercase border-b-2 ",""])),e=>{let{$isSelected:t}=e;return t?"border-black dark:border-white":"border-transparent"});function ea(e){let{clientThreadId:t,isOpen:i,slideOver:s,onClose:a}=e,r=(0,z.Z)(),n=(0,m.hz)(),{0:l,1:o}=(0,k.useState)("conversation");return null!=n&&n.includes("debug")?(0,E.jsx)($,{icon:G.reV,title:r.formatMessage(em.debugTitle),isOpen:i,slideOver:s,onClose:a,children:(0,E.jsxs)(x.fC,{orientation:"vertical",defaultValue:l,onValueChange:e=>o(e),children:[(0,E.jsxs)(x.aV,{className:"flex items-center justify-center gap-2 px-4 py-1 text-xs font-semibold",children:[(0,E.jsx)(x.xz,{value:"conversation",children:(0,E.jsx)(es,{$isSelected:"conversation"===l,children:"Conversation"})}),(0,E.jsx)(x.xz,{value:"system-message-editor",className:"p-4",children:(0,E.jsx)(es,{$isSelected:"system-message-editor"===l,children:"System Message Editor"})})]}),(0,E.jsx)(x.VY,{value:"conversation",children:(0,E.jsx)(er,{clientThreadId:t})}),(0,E.jsx)(x.VY,{value:"system-message-editor",children:(0,E.jsx)(Q,{clientThreadId:t})})]})}):null}function er(e){let{clientThreadId:t}=e,i=(0,z.Z)(),s=p.tQ.getThreadCurrentLeafId(t),a=(0,p.Fe)(t,s),{0:r,1:n}=(0,k.useState)(),l=(0,m.hz)(),o=(0,k.useCallback)(()=>{n(void 0)},[]),d=(0,k.useCallback)(()=>{let e=p.tQ.getTree(t);(0,j.v)(e.getTextFromThread(s))},[s,t]),{0:c,1:u}=(0,k.useState)(!1);return null!=l&&l.includes("debug")?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{className:"mb-2 flex items-center justify-around px-4 py-1 text-xs font-semibold uppercase",children:(0,E.jsx)(el,{clientThreadId:t,messages:a.map(e=>e.message)})}),!1,(0,E.jsxs)("div",{className:"flex items-center justify-around gap-2 px-4 py-1 text-xs font-semibold uppercase",children:[(0,E.jsx)("div",{children:(0,E.jsx)(_.Z,{onCopy:d,buttonText:i.formatMessage(em.copyText)})}),(0,E.jsxs)("button",{className:"flex items-center justify-center gap-2",onClick:()=>u(!0),children:[(0,E.jsx)(G.aAc,{className:"icon-sm rotate-90"}),"View tree"]})]}),(0,E.jsx)(ei,{}),(0,E.jsx)(ee,{nodes:a,setDebugNodeIndex:n}),void 0!==r&&(0,E.jsx)(D.Z,{className:"min-w-[80vw]",isOpen:!0,onClose:o,type:"success",children:(0,E.jsx)("div",{className:"max-h-[80vh] overflow-auto",children:(0,E.jsx)(X,{json:a[r].message})})},"DebugMessageModal-".concat(r)),c&&(0,E.jsx)(D.Z,{isOpen:!0,onClose:()=>u(!1),type:"success",size:"custom",noPadding:!0,children:(0,E.jsx)(Y,{clientThreadId:t})},"DebugTreeViewer")]}):null}function en(e,t){let i=new Blob([JSON.stringify({conversation_id:p.tQ.getServerThreadId(e),messages:t},null,2)],{type:"application/json"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download="messages-".concat(p.tQ.getServerThreadId(e),".json"),a.click(),URL.revokeObjectURL(s)}function el(e){let{clientThreadId:t,messages:i}=e,s=(0,k.useCallback)(()=>{en(t,i)},[t,i]);return(0,E.jsx)(O.z,{onClick:s,color:"primary",size:"small",icon:G._8t,children:(0,E.jsx)(N.Z,H({},em.downloadRawConversation))})}function eo(e){let t=eo.useAssetPointerSource(e.assetPointer),i=eo.useAudioSource(e.audio),s=null!=t?t:i;return s?(0,E.jsx)("audio",{controls:!0,src:s,className:"w-full"}):null}eo.useAssetPointerSource=e=>{let{0:t,1:i}=(0,k.useState)(null),s=(0,v.NL)();return(0,k.useEffect)(()=>{e&&f.j.fetch(s,{asset:e}).then(e=>{i(e.url)})},[s,e]),t},eo.useAudioSource=e=>{let{0:t,1:i}=(0,k.useState)(null);return(0,k.useEffect)(()=>{if(e){let t=atob(e.payload),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);let a=new Blob([s],{type:"audio/".concat(e.format)}),r=URL.createObjectURL(a);return i(r),()=>{URL.revokeObjectURL(r)}}},[e]),t};let ed=C.Z.div(r||(r=(0,o.Z)(["overflow-y-auto h-full md:w-[250px] lg:w-[300px] xl:w-[350px] 2xl:w-[400px] md:border-l md:border-gray-100 md:dark:border-gray-700 popover bg-token-main-surface-primary"]))),ec=C.Z.pre(n||(n=(0,o.Z)(["whitespace-pre-wrap text-sm"]))),eu=C.Z.div(l||(l=(0,o.Z)(["px-6 py-4 flex flex-col gap-1 hover:bg-gray-50 dark:hover:bg-gray-500/10 cursor-pointer border-b dark:border-white/10 border-gray-200"]))),em=(0,P.vU)({debugTitle:{id:"DebugSidebar.debugTitle",defaultMessage:"Debug"},copyText:{id:"DebugSidebar.copyText",defaultMessage:"Copy text"},downloadRawConversation:{id:"DebugSidebar.downloadRawConversation",defaultMessage:"Download raw conversation"},uploadRawConversation:{id:"DebugSidebar.uploadRawConversation",defaultMessage:"Upload conversation dump"},closeSidebar:{id:"DebugSidebar.closeSidebar",defaultMessage:"Close sidebar"}})},65513:function(e,t,i){i.d(t,{C:function(){return s}});async function s(){}}}]);
//# sourceMappingURL=5720-4743996cc30cb884.js.map