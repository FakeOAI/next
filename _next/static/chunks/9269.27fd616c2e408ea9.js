"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9269],{49269:function(e,t,a){a.r(t),a.d(t,{BrowsingMessage:function(){return M},getVisitedUrl:function(){return $}});var r=a(16757),s=a(7937),n=a(57098),l=a(82164),i=a(2721),o=a(3551),u=a(87230),c=a(19841),d=a(21389),g=a(88600),m=a(49764),h=a(15478),f=a(99529),x=a(42117),p=a(54028),b=a(651);function M(e){let{messages:t,isRequestActive:a,isLastMessageInTurn:n,isRetrieval:l,isUsingGizmo:i}=e,u=t.map(e=>e.message),c=u.map((e,t)=>{if(e.author.role!==r.uU.Tool||t>0&&w(e)&&w(u[t-1]))return null;let a=e.metadata;if(!a)return null;let{command:s,status:n}=a;return s?{type:s,status:n,didError:e.content.content_type===r.PX.SystemError,message:e}:null}).filter(s.lm),d=c.filter(e=>(function(e,t){switch(e.type){case r.$x.Search:return!0;case r.$x.Click:case r.$x.Lookup:case r.$x.MultiClick:case r.$x.OpenUrl:case r.$x.Quote:case r.$x.QuoteFull:case r.$x.QuoteLines:return t?null!=function(e){let t=e.message.metadata?._cite_metadata?.metadata_list[0];return null!=t&&"file"===t.type?t.name:null}(e):null!=$(e);case r.$x.Back:case r.$x.Scroll:return!1}})(e,!1)),g=d[d.length-1]??void 0,h=(0,m.Z)();if(u.filter(e=>e.author.role===r.uU.Tool).some(e=>{let{content:t}=e;return t.content_type===r.PX.SystemError}))return null;let M=f.X.Running,v={count:d.length,domain:g?(0,o.SX)($(g)??""):void 0,query:g?k(g):void 0},q=l?i?h.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):h.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):h.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return(u.some(p.We)?(M=f.X.Stopped,q=l?i?h.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):h.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):h.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):n&&a?d.length>0&&(q=function(e,t,a,s,n){switch(n?.type){case r.$x.Click:case r.$x.MultiClick:case r.$x.Lookup:case r.$x.OpenUrl:case r.$x.Quote:case r.$x.QuoteFull:case r.$x.QuoteLines:case r.$x.Scroll:case r.$x.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case r.$x.Search:case void 0:if(a)return s?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"});return e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t)}}(h,v,l,i,d[d.length-1])):c.length>0&&c.every(e=>e.didError)?(M=f.X.Error,q=l?i?h.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):h.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):h.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(M=f.X.Finished,q=l?null:0===v.count?h.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):h.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},v)),d.length>0&&M!==f.X.Error)?(0,b.jsx)(x.D,{highlightedCommand:q,showWorkUserSetting:!1,status:M,children:0===d.length?null:(0,b.jsx)(y,{commands:d})}):(0,b.jsx)(S,{$isError:M===f.X.Error,children:q})}function w(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function y(e){let{commands:t}=e,a=(0,m.Z)(),s=t.map($).filter(e=>null!=e),h=(0,u.u)(s);return(0,b.jsx)("div",{className:"mb-4 divide-y divide-token-border-light rounded-xl border border-token-border-light text-sm",children:(0,b.jsx)(d.M,{initial:!1,children:t.map((e,s)=>{let{icon:u,url:d,title:m,externalLink:f}=function(e){switch(e.type){case r.$x.Search:{let t=k(e);return{icon:l.W1M,url:"bing.com",externalLink:function(e){let t=e.message.metadata?.args?.[0];return void 0===t?null:i.Z.getBingLink({query:t})}(e),title:t?`“${t}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case r.$x.Click:case r.$x.MultiClick:case r.$x.Lookup:case r.$x.OpenUrl:case r.$x.Quote:case r.$x.QuoteFull:case r.$x.QuoteLines:case r.$x.Scroll:return{url:$(e),title:function(e){let t=e.message.metadata?._cite_metadata?.metadata_list[0];return null!=t&&"file"!==t.type?t.title:null}(e)??void 0};case r.$x.Back:return{}}}(e),x=d?(0,o.SX)(d):void 0,p=m?"string"==typeof m?m:a.formatMessage(m):null,M=d?h.get(d):null;return(0,b.jsx)(g.E.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:(0,b.jsxs)(v,{url:f??d,className:(0,c.default)("flex items-start gap-3 px-4 py-3",m?"text-token-text-secondary":"text-token-text-primary",0===s&&"rounded-t-xl",s===t.length-1&&"rounded-b-xl"),children:[u?(0,b.jsx)(u,{className:"icon-sm mt-0.5 flex-shrink-0 text-token-text-secondary"}):d?(0,b.jsx)(n.Z,{url:d,className:"mt-1"}):null,(0,b.jsxs)("div",{children:[p&&(0,b.jsxs)("div",{className:"line-clamp-1 text-token-text-primary",children:[M&&`${M} — `,p]}),(0,b.jsx)("div",{children:x})]})]})},s)})})})}function v(e){let{url:t,children:a,className:r}=e;return t?(0,b.jsxs)("a",{href:t,target:"_blank",className:(0,c.default)(r,"group relative hover:bg-token-main-surface-secondary"),children:[a,(0,b.jsx)("div",{className:"invisible absolute right-3 bg-gradient-to-l from-token-main-surface-secondary to-transparent pl-4 group-hover:visible",children:(0,b.jsx)(l.Pfi,{className:"icon-md text-token-text-secondary"})})]}):(0,b.jsx)("div",{className:r,children:a})}function k(e){return e.message.metadata?.args?.[0]}function $(e){let t=e.message.metadata?._cite_metadata?.metadata_list[0];return null!=t&&"file"!==t.type?t.url:null}let S=h.Z.p`first:mt-0 my-1.5 h-8 flex items-center ltr:mr-auto rtl:ml-auto empty:hidden
${e=>{let{$isError:t}=e;return t?"text-token-text-error":"text-token-text-secondary"}}`},87230:function(e,t,a){a.d(t,{d:function(){return f},u:function(){return x}});var r=a(72409),s=a(3551),n=a(42420),l=a(84760),i=a(19464),o=a(79208),u=a(18939),c=a.n(u),d=a(74153),g=a.n(d),m=a(28438);let h=g()(e=>o.Ue({fetcher:async t=>{let a=new Map;for await(let s of r.c.streamedJsonPost(`${m.B}/attributions`,{urls:t}))s.attribution&&a.set(s.url,s.attribution),e.setQueryData(["attribution",{url:s.url}],s.attribution);return c()(t.map(e=>{let t=a.get(e);return t&&{url:e,attribution:t}}))},resolver:o.rp("url"),scheduler:o.ck(100)}));function f(e){let{useBaseUrl:t=!0,enabled:a=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?(0,s.FH)(e):e,i=h((0,n.NL)());return(0,l.a)({queryKey:["attribution",{url:r}],queryFn:async()=>(await i.fetch(r)).attribution,enabled:a&&!!e})}function x(e){let{useBaseUrl:t=!0,enabled:a=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?e.map(s.FH):e,l=h((0,n.NL)());return(0,i.h)({queries:r.map(e=>({queryKey:["attribution",{url:e}],queryFn:async()=>(await l.fetch(e)).attribution,enabled:r.length>0&&a})),combine:t=>{let a=new Map;for(let r=0;r<t.length;r++){let s=t[r].data;s&&a.set(e[r],s)}return a}})}},79208:function(e,t,a){a.d(t,{Ue:function(){return s},rp:function(){return n},ck:function(){return l}});let r=()=>{let e,t;let a=new Promise((a,r)=>{e=a,t=r});return{resolve:e,reject:t,value:a}},s=(e,t)=>{let a=e.name??`batcher:${Math.random().toString(16).slice(2)})`,s=e.scheduler??l(10),n=globalThis.__BATSHIT_DEVTOOLS__?.for(a),i=t??{seq:0,batch:new Set,currentRequest:r(),timer:void 0,start:null,latest:null};n?.create({seq:i.seq});let o=()=>{i.batch=new Set,i.currentRequest=r(),i.timer=void 0,i.start=null,i.latest=null};return{fetch:t=>{i.start||(i.start=Date.now()),i.latest=Date.now(),i.batch.add(t),clearTimeout(i.timer);let a=s(i.start,i.latest,i.batch.size);n?.queue({seq:i.seq,query:t,batch:[...i.batch],scheduled:a,latest:i.latest,start:i.start});let r=()=>{let t=i.seq,a=e.fetcher([...i.batch]),r=i.currentRequest;return n?.fetch({seq:t,batch:[...i.batch]}),o(),a.then(e=>{n?.data({seq:t,data:e}),r.resolve(e)}).catch(e=>{n?.error({seq:t,error:e}),r.reject(e)}),i.seq++,a};if("immediate"===a){let a=i.currentRequest;return r(),a.value.then(a=>e.resolver(a,t))}return"never"===a?i.currentRequest.value.then(a=>e.resolver(a,t)):(i.timer=setTimeout(r,a),i.currentRequest.value.then(a=>e.resolver(a,t)))}}},n=e=>(t,a)=>t.find(t=>t[e]==a),l=e=>(t,a)=>e-(a-t)}}]);
//# sourceMappingURL=9269.27fd616c2e408ea9.js.map