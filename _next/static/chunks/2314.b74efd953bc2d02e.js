"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2314],{42314:function(e,t,n){n.r(t),n.d(t,{ImageEditor:function(){return ei}});var a,s,i,r=n(16757),l=n(3430),o=n(75290),d=n(81652),c=n(83747),u=n(182),g=n(54028),m=n(39217),f=n(92745),h=n(22433),x=n(46900),p=n(42420),j=n(82363),b=n(38482),v=n.n(b),w=n(92379),y=n(75172),k=n(68306),I=n(2346),E=n(98601),O=n(11550),C=n(62511),N=n(30853),D=n(28146),M=n(66114),S=n(44442),P=n(92355),T=n(40833),_=n(60682),L=n(88690),Z=n(99976),A=n(61619),R=n(79746),z=n(88667),B=n(19841),F=n(88600),H=n(62984),U=n(15478);let G=((a={})[a.Default=0]="Default",a[a.Inpaint=1]="Inpaint",a);var W=n(651);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach(function(t){(0,E.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Q(e){let{imageAsset:t,mode:n,setMode:a,clientThreadId:s,messageId:i,cursorWidth:r,setCursorWidth:l,inpaintingDrawingState:d,isLoadingNewImage:c}=e,g=f.tQ.getServerThreadId(s),{canUndoDrawing:m,undoDrawing:h,canRedoDrawing:x,redoDrawing:p,clearAllDrawings:j}=d,b=(0,y.Z)();return(0,W.jsxs)(F.E.div,V(V({className:"flex h-16 w-full justify-between px-4"},S.e),{},{children:[(0,W.jsx)("div",{className:"flex items-center",children:n===G.Inpaint&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{className:(0,B.default)("flex items-center gap-3",c&&"opacity-50"),children:[(0,W.jsx)(Y,{className:"h-[11px] w-[11px]"}),(0,W.jsxs)(L.fC,{className:"relative flex w-[90px] items-center",min:32,max:240,step:.01,value:[r],onValueChange:e=>l(e[0]),disabled:c,children:[(0,W.jsx)(L.fQ,{className:"relative h-[2px] grow bg-token-text-quaternary",children:(0,W.jsx)(L.e6,{className:"absolute h-full bg-token-text-secondary"})}),(0,W.jsx)(L.bU,{className:"block h-[11px] w-[11px] rounded-full bg-token-text-secondary"})]}),(0,W.jsx)(Y,{className:"h-6 w-6"})]}),(0,W.jsx)($,{}),(0,W.jsx)(J,{disabled:!m||c,onClick:h,children:(0,W.jsx)(P.UE,{})}),(0,W.jsx)(J,{disabled:!x||c,onClick:p,children:(0,W.jsx)(P.zG,{})}),(0,W.jsx)($,{}),(0,W.jsx)(J,{disabled:!m||c,onClick:j,children:(0,W.jsx)(H.Z,{id:"imageEditorControls.clearSelectionButtonLabel",defaultMessage:"Clear selection"})})]})}),(0,W.jsx)("div",{className:"flex items-center",children:n===G.Inpaint?(0,W.jsx)(J,{onClick:()=>a(G.Default),disabled:c,children:(0,W.jsx)(H.Z,{id:"imageEditorControls.cancelButtonLabel",defaultMessage:"Cancel"})}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(K,{imageAsset:t,setMode:a,messageId:i,serverThreadId:g}),(0,W.jsx)(J,{tooltip:b.formatMessage({id:"imageEditorControls.downloadButtonTooltip",defaultMessage:"Save"}),onClick:()=>(0,u.HR)(t,g,i),children:(0,W.jsx)(D._8t,{})}),(0,W.jsx)(X,{prompt:(0,u.hG)(t),children:(0,W.jsx)(J,{tooltip:b.formatMessage({id:"imageEditorControls.promptButtonTooltip",defaultMessage:"Prompt"}),children:(0,W.jsx)(D.szr,{})})}),(0,W.jsx)(J,{tooltip:b.formatMessage({id:"imageEditorControls.closeButtonTooltip",defaultMessage:"Close"}),onClick:o.RT.close,children:(0,W.jsx)(D.tPq,{className:"icon-lg"})})]})})]}))}function X(e){let{prompt:t,children:n}=e,{0:a,1:s}=(0,w.useState)(!1),i=(0,y.Z)();return(0,W.jsx)(C.J,{sideOffset:4,alignAgainstAnchor:"end",triggerButton:(0,W.jsx)("div",{className:"group",children:n}),className:"z-10",size:"none",children:(0,W.jsxs)("div",{className:"flex max-w-sm flex-col gap-3 p-4",children:[(0,W.jsx)("div",{className:"text-token-text-secondary",children:(0,W.jsx)(H.Z,{id:"imageEditorControls.promptPopoverLabel",defaultMessage:"Prompt"})}),(0,W.jsx)("div",{children:t}),(0,W.jsx)("div",{children:(0,W.jsx)(O.z,{color:"secondary",disabled:a,onClick:()=>{s(!0),(0,R.v)(t),setTimeout(()=>s(!1),2e3)},icon:D.TIy,children:a?i.formatMessage({id:"imageEditorControls.copiedButtonLabel",defaultMessage:"Copied!"}):i.formatMessage({id:"imageEditorControls.copyButtonLabel",defaultMessage:"Copy"})})})]})})}function J(e){let{children:t,tooltip:n,disabled:a,onClick:s}=e,i=(0,W.jsx)("button",{className:(0,B.default)("rounded p-2 font-semibold hover:bg-token-main-surface-tertiary group-radix-state-open:bg-token-main-surface-tertiary",a?"text-token-text-quaternary":"text-token-text-secondary"),disabled:a,onClick:s,children:t});return null!=n?(0,W.jsx)(N.u,{label:n,sideOffset:4,children:i}):i}function K(e){let{imageAsset:t,setMode:n,messageId:a,serverThreadId:s,disabled:i}=e,r=(0,y.Z)(),l=(0,_.qg)(_.pm.DalleEditingOnboarding),o=l.eligible&&!l.isLoading,d=(0,W.jsx)(J,{tooltip:o?void 0:r.formatMessage({id:"imageEditorControls.inpaintButtonTooltip",defaultMessage:"Select"}),onClick:()=>{var e,i,r,l,o,d;n(G.Inpaint),z.m9.logEvent("chatgpt_dalle_inpaint_click",null,{sourceOperation:null!==(e=null===(i=t.metadata)||void 0===i||null===(i=i.dalle)||void 0===i?void 0:i.edit_op)&&void 0!==e?e:"none",hasParent:(null===(r=t.metadata)||void 0===r||null===(r=r.dalle)||void 0===r?void 0:r.parent_gen_id)!=null?"true":"false"}),Z.A.logEvent(A.M.dalleImageClickInpaint,{conversationId:s,messageId:a,generationId:null===(l=t.metadata)||void 0===l||null===(l=l.dalle)||void 0===l?void 0:l.gen_id,fileId:(0,M.Iy)(t.asset_pointer),parentGenerationId:null===(o=t.metadata)||void 0===o||null===(o=o.dalle)||void 0===o?void 0:o.parent_gen_id,sourceOperation:null===(d=t.metadata)||void 0===d||null===(d=d.dalle)||void 0===d?void 0:d.edit_op})},disabled:i,children:(0,W.jsx)(P.GN,{})});return o?(0,W.jsx)(T.v,{show:!0,side:"bottom",sideOffset:0,title:r.formatMessage({id:"imageEditorNUX.title",defaultMessage:"Select area of the image to edit"}),description:r.formatMessage({id:"imageEditorNUX.description",defaultMessage:"Highlight the area and describe changes in chat."}),onDismiss:l.markAsViewed,children:(0,W.jsx)("div",{children:d})}):d}let $=U.Z.div(s||(s=(0,I.Z)(["mx-3 w-[1px] h-6 bg-token-border-light"]))),Y=U.Z.div(i||(i=(0,I.Z)(["rounded-full border-2 border-token-text-secondary"])));function ee(e){let{mode:t,imageIndex:n,allImages:a,onSwitchImage:s,isLoadingNewImage:i}=e,r=n>0,l=(0,w.useCallback)(()=>{r&&s(a[n-1])},[r,a,n,s]),o=n<a.length-1,d=(0,w.useCallback)(()=>{o&&s(a[n+1])},[o,a,n,s]);return(0,w.useEffect)(()=>{function e(e){e.target instanceof HTMLTextAreaElement||t!==G.Default||("ArrowLeft"===e.key?l():"ArrowRight"===e.key&&d())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,l,d]),(0,W.jsx)("div",{className:"flex h-16 w-full items-center justify-center gap-3 font-semibold text-token-text-secondary",children:t===G.Inpaint?!i&&(0,W.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,W.jsx)(H.Z,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),(0,W.jsx)("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:(0,W.jsx)(D.szr,{className:"icon-md"})})]}):a.length>1?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("button",{disabled:!r,className:"disabled:text-token-text-tertiary",onClick:l,children:(0,W.jsx)(D.DUf,{className:"icon-lg"})}),(0,W.jsx)("div",{children:(0,W.jsx)(H.Z,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:n+1,numImages:a.length}})}),(0,W.jsx)("button",{disabled:!o,className:"disabled:text-token-text-tertiary",onClick:d,children:(0,W.jsx)(D.ob9,{className:"icon-lg"})})]}):null})}function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach(function(t){(0,E.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ea(e){let{imageAsset:t,children:n,containerDimensions:a,isLoadingNewImage:s}=e;return(0,W.jsxs)(F.E.div,en(en({className:"absolute",style:function(e,t){let{width:n,height:a}=e,{width:s,height:i}=t,r=s-0,l=i-128,o=n/a,d=o>r/l,c=d?r:l*o,u=d?r/o:l;return{top:(i-u)/2,left:(s-c)/2,width:c,height:u}}(t,a)},S.e),{},{children:[n,(0,W.jsx)("div",{className:(0,B.default)("absolute inset-0 flex items-center justify-center bg-token-main-surface-primary transition-opacity duration-1000",s?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]}))}let es=v()(()=>Promise.all([n.e(7806),n.e(345),n.e(1100)]).then(n.bind(n,73216)).then(e=>e.DynamicDrawingCanvas),{loadableGenerated:{webpack:()=>[73216]}});function ei(e){let{clientThreadId:t,messageId:n,image:a,allImages:s}=e,i=(0,f.oq)(t),l=(0,f.uj)(t,i),u=null==l?void 0:l.messages[l.messages.length-1],m=null!=u&&(0,h.rH)(u.message)===h.Cs.Dalle&&!(0,g.We)(u.message),b=(0,p.NL)();return(0,w.useEffect)(()=>{async function e(e,t){try{let n=await (0,c.Mn)(b,e);o.RT.setFocusedObject({type:d.z.Image,image:n[0],allImages:n,messageId:t})}catch(e){j.U.addError(Error("Failed to load newly created images:",{cause:e}))}}null!=u&&(0,h.rH)(u.message)===h.Cs.DalleTool&&u.message.content.content_type===r.PX.MultimodalText&&e(x.U.getImageAssetPointers(u.message),u.message.id)},[b,u]),(0,W.jsx)(er,{image:a,allImages:s,isLoadingNewImage:m,clientThreadId:t,messageId:n})}function er(e){let{image:t,allImages:n,isLoadingNewImage:a,clientThreadId:s,messageId:i}=e,{0:r,1:g}=(0,w.useState)(G.Default),{0:f,1:h}=(0,w.useState)({width:window.innerWidth-l.J,height:window.innerHeight}),x=(0,w.useRef)(null),{0:p,1:j}=(0,w.useState)(136),b=function(){let{0:e,1:t}=(0,w.useState)({undoStack:[],currentIndex:-1});return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:function(e){t(t=>({undoStack:[...t.undoStack.slice(0,t.currentIndex+1),e],currentIndex:t.currentIndex+1}))},canUndoDrawing:e.currentIndex>=0,undoDrawing:function(){t(e=>({undoStack:e.undoStack,currentIndex:Math.max(e.currentIndex-1,-1)}))},canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:function(){t(e=>({undoStack:e.undoStack,currentIndex:Math.min(e.currentIndex+1,e.undoStack.length-1)}))},clearAllDrawings:function(){t({undoStack:[],currentIndex:-1})}}}(),{currentDrawnShape:v,onNewDrawnShape:I,clearAllDrawings:E}=b,O=(0,w.useRef)(null),C=(0,y.Z)(),{setTargetedContent:N}=(0,m.Q)();(0,w.useEffect)(()=>{let e=new ResizeObserver(e=>{let{width:t,height:n}=e[0].contentRect;h({width:t,height:n})});return x.current&&e.observe(x.current),()=>{e.disconnect()}},[]),(0,w.useEffect)(()=>{function e(e){"Escape"===e.key&&(r===G.Inpaint?g(G.Default):o.RT.close())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[r]),(0,w.useEffect)(()=>(null==v?N({type:"object",placeholderTextOverride:(0,k.Em)({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit image…"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:e=>(0,u.$K)(e,t)}):N({type:"object",label:C.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async e=>{var n;return await (0,u.hx)(e,t,null===(n=O.current)||void 0===n?void 0:n.getImageData(),C)},onCleared:()=>g(G.Default)}),()=>{N(void 0)}),[t,C,N,v]),(0,w.useEffect)(()=>{r!==G.Inpaint&&E()},[r]),(0,w.useEffect)(()=>{g(G.Default)},[t]);let D=n.findIndex(e=>e.asset_pointer===t.asset_pointer);return(0,W.jsxs)("div",{ref:x,className:"flex h-full w-full flex-col justify-between",children:[(0,W.jsx)(Q,{imageAsset:t,mode:r,setMode:g,clientThreadId:s,messageId:i,cursorWidth:p,setCursorWidth:j,inpaintingDrawingState:b,isLoadingNewImage:a}),(0,W.jsx)(ee,{mode:r,imageIndex:D,allImages:n,onSwitchImage:e=>{o.RT.setFocusedObject({type:d.z.Image,image:e,allImages:n,messageId:i})},isLoadingNewImage:a}),(0,W.jsxs)(ea,{imageAsset:t,containerDimensions:f,isLoadingNewImage:a,children:[(0,W.jsx)(c.sH,{className:"h-full w-full",alt:(0,u.hG)(t),src:t.url,width:t.width,height:t.height,fadeIn:!1}),r===G.Inpaint&&(0,W.jsx)("div",{className:"absolute inset-0",children:(0,W.jsx)(es,{drawingCanvasRef:O,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:p,canvasWidth:t.width,canvasHeight:t.height,currentDrawnShape:v,onNewDrawnShape:I})})]})]})}}}]);
//# sourceMappingURL=2314.b74efd953bc2d02e.js.map