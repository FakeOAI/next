"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5791],{75791:function(e,t,n){n.r(t),n.d(t,{TextMessageEditor:function(){return M}});var r,c=n(94521),a=n(17379),s=n(92524),o=n(41141),i=n(61457),l=n(98506),u=n(93747),d=n(15236),f=n(92379),p=n(45211),b=n(25940),g=n(72256),j=n(74091),v=n(85734),m=n(86021),y=n(5443),O=n(52868),h=n(73746),x=n(651);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let E=(0,b.vU)({saveAndSubmit:{id:"NodeEditor.saveAndSubmit",defaultMessage:"Save & Submit"},cancel:{id:"NodeEditor.cancel",defaultMessage:"Cancel"}});function k(e){let{initialText:t,clientThreadId:n,currentLeaf:r,onChangeItemInView:c,onExitEdit:a,onRequestCompletion:s,disabled:o,attachments:b}=e,j=(0,f.useId)(),w="".concat(r,"-").concat(j),{0:k,1:N}=(0,f.useState)(null!=t?t:""),S=(0,f.useRef)(null),M=(0,l.BL)(),Z=(0,f.useCallback)(e=>{N(e.currentTarget.value)},[]),D=(0,f.useCallback)(()=>{s({type:v.Os.Next,promptId:w,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!0,completionMetadata:{conversationMode:m.iN.getConversationMode(n)},updateTree:()=>{m.tQ.updateTree(n,e=>{let t=e.getParentId(r);e.addNode(w,k,t,v.uU.User,void 0,b?{attachments:b}:void 0)}),c(w)}}),a(),u.A.logEvent(d.M.changeNode,{intent:"edit_save"})},[b,n,r,w,k,c,s,a]),A=(0,f.useCallback)(()=>{c(r),u.A.logEvent(d.M.changeNode,{intent:"edit_cancel"}),a(),u.A.logEvent(d.M.cancelEditPrompt,{threadId:m.tQ.getServerThreadId(n)})},[r,c,a,n]);(0,f.useEffect)(()=>{let e=S.current;if(e){e.focus();let t=e.value.length;e.setSelectionRange(t,t)}},[]),(0,f.useEffect)(()=>{let e=S.current,t=e=>{"Enter"===e.key&&e.metaKey?D():"Escape"===e.key&&A()};return e&&e.addEventListener("keydown",t),()=>{e&&e.removeEventListener("keydown",t)}},[A,D]);let I=b&&b.length>0,_=(0,h.Q)(),T=I&&(0,x.jsx)(C,{children:b.map(e=>(0,x.jsx)(O.Z,{width:M?"normal":"wide",file:e.name,contextConnectorInfo:(0,i.xA)(e.context_connector_info)},e.id))}),z=(0,x.jsx)(p.ZP,{ref:S,value:k,onChange:Z,className:"m-0 resize-none border-0 bg-transparent p-0 focus:ring-0 focus-visible:ring-0 juice:w-full juice:p-2"});return _?(0,x.jsxs)("div",{className:"rounded-3xl bg-token-main-surface-tertiary px-3 py-2 juice:py-3",children:[T,z,(0,x.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,x.jsx)(y.z,{as:"button",color:"secondary",onClick:A,children:(0,x.jsx)(g.Z,{id:"D9gbPp",defaultMessage:"Cancel"})}),(0,x.jsx)(y.z,{as:"button",onClick:D,disabled:o,children:(0,x.jsx)(g.Z,{id:"KGxIJG",defaultMessage:"Send"})})]})]}):(0,x.jsxs)(x.Fragment,{children:[T,z,(0,x.jsxs)("div",{className:"mt-2 flex justify-center text-center",children:[(0,x.jsx)(y.z,{as:"button",onClick:D,className:"mr-2",disabled:o,children:(0,x.jsx)(g.Z,P({},E.saveAndSubmit))}),(0,x.jsx)(y.z,{as:"button",color:"secondary",onClick:A,children:(0,x.jsx)(g.Z,P({},E.cancel))})]})]})}let C=j.Z.div(r||(r=(0,o.Z)(["flex gap-2 flex-wrap"]))),N=["message"];function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){var t;let{message:n}=e,r=(0,a.Z)(e,N);return(0,x.jsx)(k,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({currentLeaf:n.nodeId,initialText:(0,s.RR)(n.message),attachments:null===(t=n.message.metadata)||void 0===t?void 0:t.attachments},r))}}}]);
//# sourceMappingURL=5791.f0601be5eda2617c.js.map