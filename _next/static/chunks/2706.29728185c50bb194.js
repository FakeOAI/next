"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2706],{80136:function(e,t,i){i.d(t,{q:function(){return s}});var o=i(60314),r=i(70348);function s(e={}){return new o.Sy({view:t=>new n(t,e)})}class n{constructor(e,t){var i;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(i=t.width)&&void 0!==i?i:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let i=e=>{this[t](e)};return e.dom.addEventListener(t,i),{name:t,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t,i=this.editorView.state.doc.resolve(this.cursorPos),o=!i.parent.inlineContent,r;if(o){let e=i.nodeBefore,t=i.nodeAfter;if(e||t){let i=this.editorView.nodeDOM(this.cursorPos-(e?e.nodeSize:0));if(i){let o=i.getBoundingClientRect(),s=e?o.bottom:o.top;e&&t&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:o.left,right:o.right,top:s-this.width/2,bottom:s+this.width/2}}}}if(!r){let e=this.editorView.coordsAtPos(this.cursorPos);r={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let s=this.editorView.dom.offsetParent;if(!this.element&&(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",o),this.element.classList.toggle("prosemirror-dropcursor-inline",!o),s&&(s!=document.body||"static"!=getComputedStyle(s).position)){let i=s.getBoundingClientRect();e=i.left-s.scrollLeft,t=i.top-s.scrollTop}else e=-pageXOffset,t=-pageYOffset;this.element.style.left=r.left-e+"px",this.element.style.top=r.top-t+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),i=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),o=i&&i.type.spec.disableDropCursor,s="function"==typeof o?o(this.editorView,t,e):o;if(t&&!s){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=(0,r.nj)(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}},4684:function(e,t,i){i.d(t,{d:function(){return c}});var o=i(80326),r=i(60314),s=i(81171),n=i(59231);class l extends r.Y1{constructor(e){super(e,e)}map(e,t){let i=e.resolve(t.map(this.head));return l.valid(i)?new l(i):r.Y1.near(i)}content(){return s.p2.empty}eq(e){return e instanceof l&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw RangeError("Invalid input for GapCursor.fromJSON");return new l(e.resolve(t.pos))}getBookmark(){return new d(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let i=e.index(t),o=e.node(t);if(0==i){if(o.type.spec.isolating)return!0;continue}for(let e=o.child(i-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let i=e.indexAfter(t),o=e.node(t);if(i==o.childCount){if(o.type.spec.isolating)return!0;continue}for(let e=o.child(i);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}}return!0}(e))return!1;let i=t.type.spec.allowGapCursor;if(null!=i)return i;let o=t.contentMatchAt(e.index()).defaultType;return o&&o.isTextblock}static findGapCursorFrom(e,t,i=!1){e:for(;;){if(!i&&l.valid(e))return e;let o=e.pos,s=null;for(let i=e.depth;;i--){let r=e.node(i);if(t>0?e.indexAfter(i)<r.childCount:e.index(i)>0){s=r.child(t>0?e.indexAfter(i):e.index(i)-1);break}if(0==i)return null;o+=t;let n=e.doc.resolve(o);if(l.valid(n))return n}for(;;){let n=t>0?s.firstChild:s.lastChild;if(!n){if(s.isAtom&&!s.isText&&!r.qv.isSelectable(s)){e=e.doc.resolve(o+s.nodeSize*t),i=!1;continue e}break}s=n,o+=t;let d=e.doc.resolve(o);if(l.valid(d))return d}return null}}}l.prototype.visible=!1,l.findFrom=l.findGapCursorFrom,r.Y1.jsonID("gapcursor",l);class d{constructor(e){this.pos=e}map(e){return new d(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return l.valid(t)?new l(t):r.Y1.near(t)}}function c(){return new r.Sy({props:{decorations:f,createSelectionBetween:(e,t,i)=>t.pos==i.pos&&l.valid(i)?new l(i):null,handleClick:h,handleKeyDown:a,handleDOMEvents:{beforeinput:p}}})}let a=(0,o.$)({ArrowLeft:u("horiz",-1),ArrowRight:u("horiz",1),ArrowUp:u("vert",-1),ArrowDown:u("vert",1)});function u(e,t){let i="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,o,s){let n=e.selection,d=t>0?n.$to:n.$from,c=n.empty;if(n instanceof r.Bs){if(!s.endOfTextblock(i)||0==d.depth)return!1;c=!1,d=e.doc.resolve(t>0?d.after():d.before())}let a=l.findGapCursorFrom(d,t,c);return!!a&&(o&&o(e.tr.setSelection(new l(a))),!0)}}function h(e,t,i){if(!e||!e.editable)return!1;let o=e.state.doc.resolve(t);if(!l.valid(o))return!1;let s=e.posAtCoords({left:i.clientX,top:i.clientY});return!(s&&s.inside>-1&&r.qv.isSelectable(e.state.doc.nodeAt(s.inside)))&&(e.dispatch(e.state.tr.setSelection(new l(o))),!0)}function p(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof l))return!1;let{$from:i}=e.state.selection,o=i.parent.contentMatchAt(i.index()).findWrapping(e.state.schema.nodes.text);if(!o)return!1;let n=s.HY.empty;for(let e=o.length-1;e>=0;e--)n=s.HY.from(o[e].createAndFill(null,n));let d=e.state.tr.replace(i.pos,i.pos,new s.p2(n,0,0));return d.setSelection(r.Bs.near(d.doc.resolve(i.pos+1))),e.dispatch(d),!1}function f(e){if(!(e.selection instanceof l))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",n.EH.create(e.doc,[n.p.widget(e.selection.head,t,{key:"gapcursor"})])}}}]);
//# sourceMappingURL=2706.29728185c50bb194.js.map