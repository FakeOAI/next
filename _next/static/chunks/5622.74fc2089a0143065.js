"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5622],{95622:function(e,t,r){r.r(t),r.d(t,{DirectorySyncSection:function(){return Y}});var n=r(98601),c=r(16779),s=r(78571),a=r(49764),o=r(75325),i=r(89794),l=r(651);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){let{setEnabled:t,isLoading:r,isEnabled:u}=e,y=(0,a.Z)();return(0,l.jsxs)("div",{className:"flex flex-row content-center items-center justify-items-center",children:[(0,l.jsx)(c.Z,{disabled:r,enabled:u,onChange:t,label:y.formatMessage(i.s.sendInviteEmailsLabel)}),(0,l.jsx)(s._,{className:"ml-2",children:(0,l.jsx)(o.Z,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},i.s.sendInviteEmailsLabel))})]})}var y=r(8040),p=r(97537),f=r(88667),m=r(11550),j=r(53128),b=r(92379);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function O(e){let{setEnabled:t,isLoading:r,isEnabled:n}=e,c=(0,a.Z)(),{0:s,1:d}=(0,b.useState)(!1),u=()=>{d(!0)},y=e=>{d(!1),e&&t(!1)};return(0,l.jsx)("div",{className:"pt-1.5",children:n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.z,{disabled:r,color:"danger",onClick:()=>{r||u()},children:(0,l.jsx)(o.Z,g({},i.s.deleteDirectorySyncConnectionButton))}),(0,l.jsx)(j.Z,{title:c.formatMessage(i.s.deleteDirectorySyncConnectionModalHeader),description:c.formatMessage(i.s.deleteDirectorySyncConnectionModalExplanation),confirmText:c.formatMessage(i.s.deleteDirectorySyncConnectionModalConfirmButton),cancelText:c.formatMessage(i.s.deleteDirectorySyncConnectionModalCancelButton),isOpen:s,primaryButtonColor:"danger",onClose:()=>y(!1),onConfirm:()=>y(!0)})]}):(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(m.z,{disabled:r,color:"primary",onClick:()=>{r||t(!0)},children:(0,l.jsx)(o.Z,g({},i.s.enableDirectorySyncButton))})})})}var h=r(40743),S=r(24740),x=r(28438),w=r(72409);class _{static async getWorkspaceDirectorySyncSettings(e){return w.c.safeGet("/accounts/{account_id}/scim",{parameters:{path:{account_id:e}}})}static async setWorkspaceDirectorySyncEnabled(e,t){return w.c.safePost("/accounts/{account_id}/scim/set_enabled",{parameters:{path:{account_id:e}},requestBody:{enabled:t}})}static async setWorkspaceDirectorySyncEmailInvitesEnabled(e,t){return w.c.safePost("/accounts/{account_id}/scim/set_email_invites_enabled",{parameters:{path:{account_id:e}},requestBody:{enabled:t}})}static async getWorkspaceDirectorySyncPortalUrl(e){return w.c.safeGet("/accounts/{account_id}/scim/portal_link",{parameters:{path:{account_id:e}}})}static async getWorkspaceDirectorySyncFailedEvents(e){return w.c.safeGet("/accounts/{account_id}/scim/failed_events",{parameters:{path:{account_id:e}}})}static async retryWorkspaceDirectorySyncFailedEvent(e,t){return w.c.safePost("/accounts/{account_id}/scim/failed_events/{event_id}/retry",{parameters:{path:{account_id:e,event_id:t}},requestBody:{}})}static async retryAllWorkspaceDirectorySyncFailedEvents(e){return w.c.safePost("/accounts/{account_id}/scim/failed_events/retry_all",{parameters:{path:{account_id:e}},requestBody:{}})}static async discardWorkspaceDirectorySyncFailedEvent(e,t){return w.c.delete(`${x.B}/accounts/${e}/scim/failed_events/${t}`)}static async getWorkspaceDirectorySyncProgressUsers(e){return w.c.safeGet("/accounts/{account_id}/scim/sync_progress_users",{parameters:{path:{account_id:e}}})}static async getWorkspaceDirectorySyncProgressGroups(e){return w.c.safeGet("/accounts/{account_id}/scim/sync_progress_groups",{parameters:{path:{account_id:e}}})}}function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function P(e){let{isLoading:t,workspaceId:r,isDirectoryConnectionConfigured:n}=e,{0:c,1:s}=(0,b.useState)(!1),a=async()=>{try{s(!0);let e=await _.getWorkspaceDirectorySyncPortalUrl(r);s(!1),e?.portal_link?window.open(e.portal_link,"_blank"):S.m.danger("Portal link not found.")}catch(e){e instanceof Error?S.m.danger(e.message):S.m.danger("An unexpected error occurred.")}};return(0,l.jsxs)(m.z,{disabled:t||c,color:"secondary",className:"mt-3",onClick:a,children:[n?(0,l.jsx)(o.Z,E({},i.s.launchDirectorySyncManagementPortalText)):(0,l.jsx)(o.Z,E({},i.s.launchDirectorySyncSetupPortalText)),(0,l.jsx)(h.Pfi,{className:"icon-sm ml-1"})]})}var k=r(19841);function Z(e){let{percentage:t,height:r=10,className:n,backgroundClassName:c="bg-gray-400",transitionDuration:s,transitionTimingFunction:a,onTransitionEnd:o}=e;return(0,l.jsxs)("div",{className:(0,k.default)("relative w-full",n),style:{height:r},children:[(0,l.jsx)("div",{className:(0,k.default)("absolute left-0 top-0 h-full w-full",c)}),(0,l.jsx)("div",{className:"absolute left-0 top-0 h-full bg-current transition-[width]",style:{width:`${Math.max(Math.min(t,100),0)}%`,transitionDuration:s,transitionTimingFunction:a},onTransitionEnd:o})]})}var C=r(24434),N=r(36792);function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function L(e){switch(e){case"dsync.user.created":return i.s.directorySyncEventTypeUserCreated;case"dsync.user.updated":return i.s.directorySyncEventTypeUserUpdated;case"dsync.user.deleted":return i.s.directorySyncEventTypeUserDeleted;case"dsync.group.created":return i.s.directorySyncEventTypeGroupCreated;case"dsync.group.updated":return i.s.directorySyncEventTypeGroupUpdated;case"dsync.group.deleted":return i.s.directorySyncEventTypeGroupDeleted;case"dsync.group.user_added":return i.s.directorySyncEventTypeGroupUserAdded;case"dsync.group.user_removed":return i.s.directorySyncEventTypeGroupUserRemoved;case"dsync.activated":return i.s.directorySyncEventTypeActivated;case"dsync.deleted":case"dsync.deactivated":return i.s.directorySyncEventTypeDeleted}}function B(e){let{isLoading:t,failedEvents:r,retryEventWithId:n,retryAllFailedEvents:c,discardFailedEventWithId:s}=e,{0:d,1:u}=(0,b.useState)(!1),{0:p,1:f}=(0,b.useState)(),j=(0,a.Z)();return(0,l.jsxs)(l.Fragment,{children:[p&&(0,l.jsx)(C.Z,{isOpen:d,onClose:u,title:j.formatMessage(L(p.event.event)),description:p.failure_reason,type:"success",showCloseButton:!0,isScrollable:!0,children:(0,l.jsx)("pre",{children:JSON.stringify(p.event,null,2)})}),r.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(y.i$,{className:"flex items-center space-x-4",children:[(0,l.jsx)(o.Z,W({},i.s.failedDirectorySyncEventsTableHeader)),(0,l.jsx)(m.z,{disabled:t,color:"secondary",size:"small",className:"ml-auto",onClick:()=>{c()},children:(0,l.jsx)(o.Z,W({},i.s.retryAllFailedDirectorySyncEventsButton))})]}),(0,l.jsxs)(N.Z.Root,{className:"w-full table-auto",children:[(0,l.jsxs)(N.Z.Header,{children:[(0,l.jsx)(N.Z.HeaderCell,{className:"bg-token-main-surface-primary",children:(0,l.jsx)(o.Z,W({},i.s.directorySyncEventsTableFailureEventTypeColumnHeader))}),(0,l.jsx)(N.Z.HeaderCell,{className:"bg-token-main-surface-primary",children:(0,l.jsx)(o.Z,W({},i.s.directorySyncEventsTableFailureReasonColumnHeader))}),(0,l.jsx)(N.Z.HeaderCell,{className:"bg-token-main-surface-primary",children:(0,l.jsx)(o.Z,W({},i.s.directorySyncEventsTableActionsColumnHeader))})]}),(0,l.jsx)(N.Z.Body,{children:r.map((e,r)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)(N.Z.Cell,{children:(0,l.jsx)(o.Z,W({},L(e.event.event)))}),(0,l.jsx)(N.Z.Cell,{children:e.failure_reason}),(0,l.jsxs)(N.Z.Cell,{children:[(0,l.jsx)("div",{children:(0,l.jsx)(m.z,{disabled:t,color:"secondary",size:"small",onClick:()=>{f(e),u(!0)},children:(0,l.jsx)(o.Z,W({},i.s.showEventDirectorySyncEventButton))})}),(0,l.jsx)("div",{className:"ml-2",children:(0,l.jsx)(m.z,{disabled:t,color:"secondary",size:"small",onClick:()=>{n(e.event.id)},children:(0,l.jsx)(o.Z,W({},i.s.retryDirectorySyncEventButton))})}),(0,l.jsx)("div",{className:"ml-2",children:s&&(0,l.jsx)(m.z,{disabled:t,color:"secondary",size:"small",onClick:()=>{s(e.event.id)},children:(0,l.jsx)(o.Z,W({},i.s.discardDirectorySyncEventButton))})})]})]},e.event.id))})]})]})]})}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function G(e){let{isLoading:t,numUsersSynced:r,numUsersInDirectory:n,numGroupsSynced:c,numGroupsInDirectory:s,failedEvents:a,retryEventWithId:d,retryAllFailedEvents:u,discardFailedEventWithId:p}=e,{value:m}=(0,f.sB)("2091463435");return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(y.Li,{className:"my-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(o.Z,M(M({},i.s.directorySyncUserSyncStatus),{},{values:{numUsersSynced:r,numUsersInDirectory:n}})),(0,l.jsx)(Z,{percentage:r/(n||1)*100})]}),(0,l.jsx)("div",{className:"mt-4",children:m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex items-center space-x-4",children:(0,l.jsx)(o.Z,M(M({},i.s.directorySyncGroupSyncStatus),{},{values:{numGroupsSynced:c,numGroupsInDirectory:s}}))}),(0,l.jsx)(Z,{percentage:c/(s||1)*100})]})})]}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)(B,{isLoading:t,failedEvents:a,retryEventWithId:d,retryAllFailedEvents:u,discardFailedEventWithId:p})})]})}var U=r(52088),q=r(84760),I=r(42420),A=r(56032);let z=["data"],H=["data"],K=["data"];function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function R(e,t){let{0:r,1:n}=(0,b.useState)(!1),c=(0,q.a)({queryKey:["workspace/directorySync",e],queryFn:async()=>{if(void 0!==e)return await _.getWorkspaceDirectorySyncSettings(e)},enabled:!!e,refetchInterval:!!t&&!!r&&2e3}),{data:s}=c,a=(0,U.Z)(c,z);return(0,b.useEffect)(()=>{s?.enabled&&s?.directory_connection==null?n(!0):n(!1)},[s]),Q({data:s},a)}function J(e,t){let{0:r,1:n}=(0,b.useState)(!1),{data:c}=R(e,t),s=(0,q.a)({queryKey:["workspace/directorySyncStatus/progressUsers","workspace/directorySync",e],queryFn:async()=>{if(void 0!==e)return await _.getWorkspaceDirectorySyncProgressUsers(e)},enabled:!!e&&!!c?.directory_connection,refetchInterval:!!t&&!!r&&2e3}),{data:a}=s,o=(0,U.Z)(s,H);return(0,b.useEffect)(()=>{a?.synced_scim_users===0||a?.synced_scim_users!==a?.total_scim_users?n(!0):n(!1)},[a,c?.directory_connection]),Q({isLoadingUsers:r,data:a},o)}function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Y(e){let{workspaceId:t}=e,{value:r}=(0,f.sB)("2091463435"),{value:n}=(0,f.sB)("2494375100"),{data:c,isLoading:s}=R(t,!0),{data:a,isLoading:d}=J(t,!0),{data:m,isLoading:j}=function(e,t){let{0:r,1:n}=(0,b.useState)(!1),{data:c}=R(e,t),s=(0,q.a)({queryKey:["workspace/directorySyncStatus/progressGroups","workspace/directorySync",e],queryFn:async()=>{if(void 0!==e)return await _.getWorkspaceDirectorySyncProgressGroups(e)},enabled:!!e&&!!c?.directory_connection,refetchInterval:!!t&&!!r&&2e3}),{data:a}=s,o=(0,U.Z)(s,K);return(0,b.useEffect)(()=>{a?.synced_scim_groups===0||a?.synced_scim_groups!==a?.total_scim_groups?n(!0):n(!1)},[a,c?.directory_connection]),Q({isLoadingGroups:r,data:a},o)}(t,r),{data:v,isLoading:g}=function(e,t){let{isLoadingUsers:r}=J(e,t);return(0,q.a)({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySync",e],queryFn:async()=>{if(void 0!==e)return await _.getWorkspaceDirectorySyncFailedEvents(e)},enabled:!!e,refetchInterval:!!t&&!!r&&2e3})}(t,!0),{mutateAsync:h,status:S}=function(e){let t=(0,I.NL)();return(0,A.D)({mutationFn:t=>_.setWorkspaceDirectorySyncEnabled(e,t),onSuccess:()=>{t.refetchQueries({queryKey:["workspace/directorySync",e]})}})}(t),{mutateAsync:x,status:w}=function(e){let t=(0,I.NL)();return(0,A.D)({mutationFn:t=>_.retryWorkspaceDirectorySyncFailedEvent(e,t),onSuccess:()=>{t.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}(t),{mutateAsync:D,status:E}=function(e){let t=(0,I.NL)();return(0,A.D)({mutationFn:()=>_.retryAllWorkspaceDirectorySyncFailedEvents(e),onSuccess:()=>{t.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}(t),{mutateAsync:k,status:Z}=function(e){let t=(0,I.NL)();return(0,A.D)({mutationFn:t=>_.discardWorkspaceDirectorySyncFailedEvent(e,t),onSuccess:()=>{t.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents"]})}})}(t),{mutateAsync:C,status:N}=function(e){let t=(0,I.NL)();return(0,A.D)({mutationFn:t=>_.setWorkspaceDirectorySyncEmailInvitesEnabled(e,t),onSuccess:()=>{t.refetchQueries({queryKey:["workspace/directorySync",e]})}})}(t),F="pending"===S||"pending"===w||"pending"===E||"pending"===Z||"pending"==N||s||d||j||g;return(0,l.jsxs)(y.i9,{className:`${F?"text-token-text-secondary":""}`,children:[(0,l.jsx)(y.A4,{children:(0,l.jsxs)("div",{className:"flex flex-row",children:[(0,l.jsx)("div",{children:(0,l.jsx)(o.Z,X({},i.s.directorySyncTitle))}),(0,l.jsx)("div",{className:"ml-2 mt-1",children:F&&(0,l.jsx)(p.Z,{})})]})}),(0,l.jsx)(y.Li,{children:(0,l.jsx)(o.Z,X({},i.s.directorySyncInfoText))}),c?.directory_connection&&(0,l.jsx)("div",{children:(0,l.jsx)(G,{isLoading:F,numUsersSynced:a?.synced_scim_users??0,numUsersInDirectory:a?.total_scim_users??0,numGroupsSynced:m?.synced_scim_groups??0,numGroupsInDirectory:m?.total_scim_groups??0,failedEvents:v??[],retryEventWithId:x,retryAllFailedEvents:D,discardFailedEventWithId:k})}),n&&c?.enabled&&(0,l.jsx)("div",{children:(0,l.jsx)(u,{setEnabled:C,isLoading:F,isEnabled:c?.send_user_invite_emails??!1})}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)(O,{setEnabled:h,isLoading:F,isEnabled:c?.enabled??!0}),c?.enabled&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(P,{isLoading:F,workspaceId:t,isDirectoryConnectionConfigured:!!c?.directory_connection})})]})]})}},53128:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(49764),c=r(47584),s=r(59144),a=r(24434),o=r(651);function i(e){let{title:t,description:r,confirmText:c,cancelText:i,isOpen:d=!1,onClose:u,onConfirm:y,primaryButtonColor:p="primary",children:f}=e,m=(0,n.Z)();return(0,o.jsx)(a.Z,{isOpen:d,onClose:u,type:"success",title:t,description:r,primaryButton:(0,o.jsx)(s.Z.Button,{title:c??m.formatMessage(l.confirmLabel),color:p,onClick:y}),secondaryButton:(0,o.jsx)(s.Z.Button,{title:i??m.formatMessage(l.cancelLabel),color:"secondary",onClick:u}),children:f})}let l=(0,c.vU)({confirmLabel:{id:"ConfirmModal.confirmLabel",defaultMessage:"Confirm"},cancelLabel:{id:"ConfirmModal.cancelLabel",defaultMessage:"Cancel"}})},78571:function(e,t,r){r.d(t,{_:function(){return a}});var n=r(37088),c=r(92379),s=r(52125);let a=(0,c.forwardRef)((e,t)=>(0,c.createElement)(s.WV.label,(0,n.Z)({},e,{ref:t,onMouseDown:t=>{var r;null===(r=e.onMouseDown)||void 0===r||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault()}})))}}]);
//# sourceMappingURL=5622.74fc2089a0143065.js.map