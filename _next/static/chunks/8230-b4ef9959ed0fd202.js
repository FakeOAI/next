"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8230],{8230:function(e,t,s){s.r(t),s.d(t,{DebugConversation:function(){return er},DebugConversationSidebar:function(){return en},default:function(){return W},downloadMessages:function(){return el}});var a,n,r,l,i,o=s(41141),d=s(94521),c=s(85734),u=(s(64831),s(71840)),m=(s(93223),s(4702)),x=s(86021),g=s(92524),h=s(22770),p=s(20408),b=s(16054),f=(s(96053),s(35226)),j=s(48538),v=s(61888),y=s(86078),w=s.n(y),N=s(92379),C=s(26123),k=s(72256),S=s(25940),O=s(34189),_=s(54368),P=s(74091),T=s(5443),D=s(10727),R=s(82783),I=s(20736),L=s(651);function Z(e){let{children:t,sidebarOpen:s,onClose:a}=e;return(0,L.jsx)(R.u.Root,{show:s,as:N.Fragment,children:(0,L.jsxs)(I.V,{as:"div",className:"relative z-10",onClose:a,children:[(0,L.jsx)("div",{className:"fixed inset-0"}),(0,L.jsx)("div",{className:"fixed inset-0 overflow-hidden",children:(0,L.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,L.jsx)("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:(0,L.jsx)(R.u.Child,{as:N.Fragment,enter:"transform transition ease-in-out duration-100 sm:duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-300 sm:duration-500",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,L.jsx)(I.V.Panel,{className:"pointer-events-auto w-screen max-w-md border-l border-gray-100 dark:border-gray-700",children:(0,L.jsx)("div",{className:"h-full overflow-y-auto bg-token-main-surface-primary shadow-xl",children:t})})})})})})]})})}var M=s(62484),E=s(14975),U=s(92426),z=s(49217),A=s(73487),F=s(94982),V=s(34565);function Q(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function J(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(s),!0).forEach(function(t){(0,d.Z)(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Q(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function G(e){var t;let{clientThreadId:s}=e,{rebaseSystemMessageContent:a,showDebugConversationTurns:n}=(0,V.N)(),{0:r,1:l}=(0,N.useState)(()=>a?JSON.stringify(a,null,2):void 0),{0:i,1:o}=(0,N.useState)(!!a),d=(0,x.u9)(s,x.tQ.getThreadCurrentLeafId(s)),m=(0,v.findLast)(d,e=>e.content.content_type===c.PX.SystemContent),g=null!==(t=null==m?void 0:m.content)&&void 0!==t?t:null,h=(0,N.useMemo)(()=>(0,v.debounce)(e=>{try{e?V.N.setState({rebaseSystemMessageContent:J(J({},JSON.parse(e)),{},{content_type:c.PX.SystemContent})}):V.N.setState({rebaseSystemMessageContent:null}),F.m.closeAll()}catch(e){F.m.danger("The System Message is not valid JSON")}},500),[]);return(0,N.useEffect)(()=>{i?h(r):(h.cancel(),V.N.setState({rebaseSystemMessageContent:null}))},[h,i,r]),(0,L.jsxs)("div",{className:"flex flex-col gap-3 px-4",children:[(0,L.jsxs)("div",{children:[(0,L.jsxs)("div",{className:"flex justify-between",children:[(0,L.jsx)(M.u,{label:"Enable to apply this system message to the current conversation.",children:(0,L.jsx)(u.Z,{id:"enabled",label:"Enabled",checked:i,onChange:e=>o(e.currentTarget.checked)})}),(0,L.jsx)(u.Z,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:n,onChange:()=>{V.N.setState({showDebugConversationTurns:!n})}})]}),(0,L.jsx)(T.z,{disabled:!g,className:"mt-2",onClick:()=>{l(g?JSON.stringify(g,null,2):"")},size:"small",children:"Load active system message"})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("label",{className:"text-sm",children:"System Message"}),(0,L.jsx)(q,{disabled:!i,placeholder:g?"Press `Load active system message` to pre-populate this":"Start a conversation and then press `Load active system message` to pre-populate this",className:"min-h-[75vh] rounded-md border border-gray-400 p-1 font-mono",value:r,onChange:e=>l(e.target.value)})]})]})}let q=P.Z.textarea(a||(a=(0,o.Z)(["w-full rounded-lg border border-token-border-light bg-token-main-surface-primary text-sm text-token-text-primary focus:border-token-text-primary focus:shadow-none focus:outline-none focus:ring-token-text-primary disabled:bg-token-main-surface-tertiary"])));var B=s(19841);function X(e){let{clientThreadId:t}=e,{0:s,1:a}=(0,N.useState)([]),n=x.tQ.getThreadCurrentLeafId(t),r=x.tQ.getThreadConversationTurns(t,n),l=e=>{let s=x.tQ.getTree(t).getLeafFromNode(e);x.tQ.setThreadCurrentLeafId(t,s.id)},i=e=>{a(e=>[...e,n]),l(e)};return(0,L.jsxs)(L.Fragment,{children:[s.length>0&&(0,L.jsxs)(T.z,{className:"absolute left-2 top-2",color:"secondary",onClick:()=>{l(s[s.length-1]),a(e=>e.slice(0,-1))},children:[(0,L.jsx)(U.eF8,{className:"icon-sm"}),"Go back to ",s[s.length-1]]}),(0,L.jsx)("div",{className:"flex flex-col items-center gap-4 overflow-auto p-4 text-xs",children:r.map((e,s)=>{let a;let n=e.messages[0].nodeId,r=x.tQ.getTree(t),l=0!==s?r.getParent(n):null,o=null!=l?l.children.findIndex(e=>n===e):0,d=null!=l?l.children:[],u=d.slice(0,o),m=d.slice(o+1);switch(e.role){case c.uU.User:a="bg-blue-500";break;case c.uU.Assistant:a="bg-gray-600";break;default:a="bg-gray-400"}return(0,L.jsxs)("div",{className:(0,B.default)("relative p-2",a),children:[(0,L.jsx)("div",{className:"absolute bottom-0 left-0 -ml-2 flex -translate-x-full gap-2 pl-2",children:u.map(e=>(0,L.jsx)(Y,{variantId:e,onChangeItemInView:i},e))}),(0,L.jsx)("div",{className:"absolute left-full top-0 ml-2 flex gap-2 pr-2",children:m.map(e=>(0,L.jsx)(Y,{variantId:e,onChangeItemInView:i},e))}),(0,L.jsx)("div",{className:"flex flex-col gap-2",children:e.messages.map(e=>(0,L.jsxs)("div",{className:"h-14 w-32 truncate bg-gray-200 p-1 text-black",children:[(0,L.jsx)("div",{className:"font-semibold",children:e.nodeId}),(0,L.jsx)("div",{className:"italic text-token-text-tertiary",children:e.message.author.role}),(0,L.jsx)("div",{children:(0,g.RR)(e.message)})]},e.nodeId))})]},s)})})]})}function Y(e){let{variantId:t,onChangeItemInView:s}=e;return(0,L.jsx)("button",{className:"w-32 truncate bg-gray-400 p-2 text-black opacity-50 hover:opacity-100",onClick:()=>{s(t)},children:(0,L.jsx)("span",{className:"bg-gray-200 p-2",children:t})},t)}function $(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function H(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?$(Object(s),!0).forEach(function(t){(0,d.Z)(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let K=w()(()=>Promise.all([s.e(5893),s.e(6113)]).then(s.bind(s,26113)).then(e=>e.default),{ssr:!1,loadableGenerated:{webpack:()=>[26113]}});function W(e){let{children:t,title:s,icon:a,isOpen:n,slideOver:r,onClose:l}=e,i=(0,L.jsxs)(ed,{children:[(0,L.jsxs)("div",{className:"flex items-start justify-between",children:[(0,L.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 text-lg font-semibold text-gray-900 dark:text-white",children:[(0,L.jsx)(a,{className:"icon-sm"}),s]}),(0,L.jsx)("div",{className:"mr-2 mt-2 flex h-7 items-center",children:(0,L.jsx)(E.P,{onClick:l})})]}),t]});return r?(0,L.jsx)(Z,{sidebarOpen:n,onClose:l,children:i}):n?i:null}function ee(e){let{nodes:t,setDebugNodeIndex:s}=e,a=t.map((e,t)=>{var a;let n=e.message,{role:r,name:l}=n.author,i=(0,v.get)(n,"metadata.__internal.model_id"),o=(0,v.get)(n,"metadata.__internal.agent.settings.completion_api.engine"),d=(0,v.get)(n,"metadata.__internal.model_experiment_name"),u=(0,v.get)(n,"metadata.__internal.model_experiment_treatment"),m=(0,v.get)(n,"metadata.__internal.normalized_model_side"),x=(0,v.get)(n,"metadata.__internal.model_experiment_group_name"),h=(0,v.get)(n,"metadata.__internal.model_experiment_group_params"),b=(0,v.get)(n,"metadata.__internal.model_experiment_override"),f=(0,v.get)(n,"metadata.__internal.model_experiment_eval_seq"),j=null===(a=(0,v.get)(n,"metadata.__internal.raw_tokens"))||void 0===a?void 0:a.length,y=(0,v.get)(n,"metadata.request_id"),w=p.U.getAudio(n),N=p.U.getAudioAssetPointers(n);return(0,L.jsxs)(eu,{role:"button",onClick:()=>s(t),children:[(0,L.jsxs)("div",{className:"text-xs font-semibold uppercase text-token-text-tertiary",children:[r,l&&l!==r&&" (".concat(l,")"),n.recipient&&" -> ",(0,g.Ej)(n)]}),(n.author.role!==c.uU.System||y)&&(0,L.jsxs)("div",{className:"text-xs text-token-text-tertiary",children:[(0,L.jsxs)("div",{children:["ID: ",n.id]}),e.id!==n.id&&(0,L.jsxs)("div",{children:["UI Node ID: ",e.id]}),(0,L.jsxs)("div",{children:["Req ID: ",y||"Reload page to see ID"]})]}),(0,L.jsx)("div",{className:"line-clamp-6",children:(0,g.RR)(n)}),(j||i||o||d||u||m||x||h||b||f)&&(0,L.jsxs)("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[void 0!==j&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Tokens Count:"})," ",j]}),i&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Model ID:"})," ",i]}),o&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Engine:"})," ",o]}),d&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Experiment:"})," ",d]}),u&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Treatment:"})," ",u]}),m&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Normalized Side:"})," ",m]}),x&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Group Name:"})," ",x]}),h&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Group Params:"}),(0,L.jsx)("div",{children:JSON.stringify(h,null,2)})]}),b&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Above Params are Overridden By:"})," ",b]}),f&&(0,L.jsxs)("div",{children:[(0,L.jsx)("b",{children:"Experiment Eval Seq:"})," click to see"]})]}),w.length||N.length?(0,L.jsxs)("div",{className:"mt-4 flex flex-col flex-nowrap gap-2",children:[w.map((e,t)=>(0,L.jsx)(eo,{audio:e},t)),N.map((e,t)=>(0,L.jsx)(eo,{assetPointer:e},t))]}):null]},n.id)});return(0,L.jsx)(ec,{children:a})}let et=e=>(0,L.jsx)(O.c.Input,H(H({},e),{},{inputClassName:"focus:ring-0"}));function es(){let e=(0,V.N)(),t=(0,A.ZP)().map(e=>({label:e.name,options:e.options.map(e=>({label:"".concat(e.value," (").concat(e.name,")"),value:e.value}))}));return(0,L.jsxs)("div",{className:"mt-2 flex flex-col justify-around gap-3 px-4 py-1 text-xs font-semibold ",children:[(0,L.jsx)(u.Z,{id:"force-paragen",label:"Force Parallel Gen",checked:e.forceParagen,onChange:()=>{V.N.setState({forceParagen:!e.forceParagen})}}),(0,L.jsx)(_.ZP,{options:t,name:"force-paragen-model",className:"shadow-none dark:text-gray-800",isDisabled:!e.forceParagen,isLoading:0===t.length,value:e.forceParagenModel,isClearable:!0,isMulti:!1,components:{Input:et},onChange:e=>{V.N.setState({forceParagenModel:null!=e?e:V.J})}}),(0,L.jsx)(u.Z,{id:"force-paragen",label:"Force Nulligen",checked:e.forceNulligen,onChange:()=>{V.N.setState({forceNulligen:!e.forceNulligen})}}),(0,L.jsx)(u.Z,{id:"force-rate-limit",label:"Force Rate Limit",checked:e.forceRateLimit,onChange:()=>{V.N.setState({forceRateLimit:!e.forceRateLimit})}}),(0,L.jsx)(u.Z,{id:"reset-rate-limit",label:"Reset Rate Limits",checked:e.resetRateLimits,onChange:()=>{V.N.setState({resetRateLimits:!e.resetRateLimits})}}),(0,L.jsx)(M.u,{label:"Enabling this will show debug conversation messages in the chat",children:(0,L.jsx)(u.Z,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:e.showDebugConversationTurns,onChange:()=>{V.N.setState({showDebugConversationTurns:!e.showDebugConversationTurns})}})})]})}let ea=P.Z.div(n||(n=(0,o.Z)(["px-3 pb-2 text-xs font-semibold uppercase border-b-2 ",""])),e=>{let{$isSelected:t}=e;return t?"border-black dark:border-white":"border-transparent"});function en(e){let{clientThreadId:t,isOpen:s,slideOver:a,onClose:n}=e,r=(0,C.Z)(),l=(0,m.hz)(),{0:i,1:o}=(0,N.useState)("conversation");return null!=l&&l.includes("debug")?(0,L.jsx)(W,{icon:U.reV,title:r.formatMessage(em.debugTitle),isOpen:s,slideOver:a,onClose:n,children:(0,L.jsxs)(b.fC,{orientation:"vertical",defaultValue:i,onValueChange:e=>o(e),children:[(0,L.jsxs)(b.aV,{className:"flex items-center justify-center gap-2 px-4 py-1 text-xs font-semibold",children:[(0,L.jsx)(b.xz,{value:"conversation",children:(0,L.jsx)(ea,{$isSelected:"conversation"===i,children:"Conversation"})}),(0,L.jsx)(b.xz,{value:"system-message-editor",className:"p-4",children:(0,L.jsx)(ea,{$isSelected:"system-message-editor"===i,children:"System Message Editor"})})]}),(0,L.jsx)(b.VY,{value:"conversation",children:(0,L.jsx)(er,{clientThreadId:t})}),(0,L.jsx)(b.VY,{value:"system-message-editor",children:(0,L.jsx)(G,{clientThreadId:t})})]})}):null}function er(e){let{clientThreadId:t}=e,s=(0,C.Z)(),a=x.tQ.getThreadCurrentLeafId(t),n=(0,x.Fe)(t,a),{0:r,1:l}=(0,N.useState)(),i=(0,m.hz)(),o=(0,N.useCallback)(()=>{l(void 0)},[]),d=(0,N.useCallback)(()=>{let e=x.tQ.getTree(t);(0,j.v)(e.getTextFromThread(a))},[a,t]),{0:c,1:u}=(0,N.useState)(!1);return null!=i&&i.includes("debug")?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:"mb-2 flex items-center justify-around px-4 py-1 text-xs font-semibold uppercase",children:(0,L.jsx)(ei,{clientThreadId:t,messages:n.map(e=>e.message)})}),!1,(0,L.jsxs)("div",{className:"flex items-center justify-around gap-2 px-4 py-1 text-xs font-semibold uppercase",children:[(0,L.jsx)("div",{children:(0,L.jsx)(D.Z,{onCopy:d,buttonText:s.formatMessage(em.copyText)})}),(0,L.jsxs)("button",{className:"flex items-center justify-center gap-2",onClick:()=>u(!0),children:[(0,L.jsx)(U.aAc,{className:"icon-sm rotate-90"}),"View tree"]})]}),(0,L.jsx)(es,{}),(0,L.jsx)(ee,{nodes:n,setDebugNodeIndex:l}),void 0!==r&&(0,L.jsx)(z.Z,{className:"min-w-[80vw]",isOpen:!0,onClose:o,type:"success",children:(0,L.jsx)("div",{className:"max-h-[80vh] overflow-auto",children:(0,L.jsx)(K,{json:n[r].message})})},"DebugMessageModal-".concat(r)),c&&(0,L.jsx)(z.Z,{isOpen:!0,onClose:()=>u(!1),type:"success",size:"custom",noPadding:!0,children:(0,L.jsx)(X,{clientThreadId:t})},"DebugTreeViewer")]}):null}function el(e,t){let s=new Blob([JSON.stringify({conversation_id:x.tQ.getServerThreadId(e),messages:t},null,2)],{type:"application/json"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download="messages-".concat(x.tQ.getServerThreadId(e),".json"),n.click(),URL.revokeObjectURL(a)}function ei(e){let{clientThreadId:t,messages:s}=e,a=(0,N.useCallback)(()=>{el(t,s)},[t,s]);return(0,L.jsx)(T.z,{onClick:a,color:"primary",size:"small",icon:U._8t,children:(0,L.jsx)(k.Z,H({},em.downloadRawConversation))})}function eo(e){let t=eo.useAssetPointerSource(e.assetPointer),s=eo.useAudioSource(e.audio),a=null!=t?t:s;return a?(0,L.jsx)("audio",{controls:!0,src:a,className:"w-full"}):null}eo.useAssetPointerSource=e=>{let{0:t,1:s}=(0,N.useState)(null),a=(0,f.NL)();return(0,N.useEffect)(()=>{e&&h.j.fetch(a,{asset:e}).then(e=>{s(e.url)})},[a,e]),t},eo.useAudioSource=e=>{let{0:t,1:s}=(0,N.useState)(null);return(0,N.useEffect)(()=>{if(e){let t=atob(e.payload),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let n=new Blob([a],{type:"audio/".concat(e.format)}),r=URL.createObjectURL(n);return s(r),()=>{URL.revokeObjectURL(r)}}},[e]),t};let ed=P.Z.div(r||(r=(0,o.Z)(["overflow-y-auto h-full md:w-[250px] lg:w-[300px] xl:w-[350px] 2xl:w-[400px] md:border-l md:border-gray-100 md:dark:border-gray-700 popover bg-token-main-surface-primary"]))),ec=P.Z.pre(l||(l=(0,o.Z)(["whitespace-pre-wrap text-sm"]))),eu=P.Z.div(i||(i=(0,o.Z)(["px-6 py-4 flex flex-col gap-1 hover:bg-gray-50 dark:hover:bg-gray-500/10 cursor-pointer border-b dark:border-white/10 border-gray-200"]))),em=(0,S.vU)({debugTitle:{id:"DebugSidebar.debugTitle",defaultMessage:"Debug"},copyText:{id:"DebugSidebar.copyText",defaultMessage:"Copy text"},downloadRawConversation:{id:"DebugSidebar.downloadRawConversation",defaultMessage:"Download raw conversation"},uploadRawConversation:{id:"DebugSidebar.uploadRawConversation",defaultMessage:"Upload conversation dump"},closeSidebar:{id:"DebugSidebar.closeSidebar",defaultMessage:"Close sidebar"}})}}]);
//# sourceMappingURL=8230-b4ef9959ed0fd202.js.map