"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2314],{42314:function(e,t,n){n.r(t),n.d(t,{ImageEditor:function(){return en}});var a,s=n(16757),r=n(3430),i=n(75290),o=n(81652),l=n(83747),d=n(182),c=n(54028),u=n(39217),g=n(92745),m=n(22433),f=n(46900),h=n(42420),x=n(82363),p=n(38482),j=n.n(p),b=n(92379),w=n(49764),y=n(47584),v=n(98601),k=n(11550),I=n(62511),E=n(30853),O=n(82164),C=n(66114),N=n(44442),D=n(92355),M=n(40833),S=n(60682),P=n(88690),T=n(99976),_=n(61619),L=n(79746),A=n(88667),Z=n(19841),R=n(88600),z=n(75325),B=n(15478);let F=((a={})[a.Default=0]="Default",a[a.Inpaint=1]="Inpaint",a);var H=n(651);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach(function(t){(0,v.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function W(e){let{imageAsset:t,mode:n,setMode:a,clientThreadId:s,messageId:r,cursorWidth:o,setCursorWidth:l,inpaintingDrawingState:c,isLoadingNewImage:u}=e,m=g.tQ.getServerThreadId(s),{canUndoDrawing:f,undoDrawing:h,canRedoDrawing:x,redoDrawing:p,clearAllDrawings:j}=c,b=(0,w.Z)();return(0,H.jsxs)(R.E.div,G(G({className:"flex h-16 w-full justify-between px-4"},N.e),{},{children:[(0,H.jsx)("div",{className:"flex items-center",children:n===F.Inpaint&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)("div",{className:(0,Z.default)("flex items-center gap-3",u&&"opacity-50"),children:[(0,H.jsx)(J,{className:"h-[11px] w-[11px]"}),(0,H.jsxs)(P.fC,{className:"relative flex w-[90px] items-center",min:32,max:240,step:.01,value:[o],onValueChange:e=>l(e[0]),disabled:u,children:[(0,H.jsx)(P.fQ,{className:"relative h-[2px] grow bg-token-text-quaternary",children:(0,H.jsx)(P.e6,{className:"absolute h-full bg-token-text-secondary"})}),(0,H.jsx)(P.bU,{className:"block h-[11px] w-[11px] rounded-full bg-token-text-secondary"})]}),(0,H.jsx)(J,{className:"h-6 w-6"})]}),(0,H.jsx)(X,{}),(0,H.jsx)(V,{disabled:!f||u,onClick:h,children:(0,H.jsx)(D.UE,{})}),(0,H.jsx)(V,{disabled:!x||u,onClick:p,children:(0,H.jsx)(D.zG,{})}),(0,H.jsx)(X,{}),(0,H.jsx)(V,{disabled:!f||u,onClick:j,children:(0,H.jsx)(z.Z,{id:"imageEditorControls.clearSelectionButtonLabel",defaultMessage:"Clear selection"})})]})}),(0,H.jsx)("div",{className:"flex items-center",children:n===F.Inpaint?(0,H.jsx)(V,{onClick:()=>a(F.Default),disabled:u,children:(0,H.jsx)(z.Z,{id:"imageEditorControls.cancelButtonLabel",defaultMessage:"Cancel"})}):(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(Q,{imageAsset:t,setMode:a,messageId:r,serverThreadId:m}),(0,H.jsx)(V,{tooltip:b.formatMessage({id:"imageEditorControls.downloadButtonTooltip",defaultMessage:"Save"}),onClick:()=>(0,d.HR)(t,m,r),children:(0,H.jsx)(O._8t,{})}),(0,H.jsx)(q,{prompt:(0,d.hG)(t),children:(0,H.jsx)(V,{tooltip:b.formatMessage({id:"imageEditorControls.promptButtonTooltip",defaultMessage:"Prompt"}),children:(0,H.jsx)(O.szr,{})})}),(0,H.jsx)(V,{tooltip:b.formatMessage({id:"imageEditorControls.closeButtonTooltip",defaultMessage:"Close"}),onClick:i.RT.close,children:(0,H.jsx)(O.tPq,{className:"icon-lg"})})]})})]}))}function q(e){let{prompt:t,children:n}=e,{0:a,1:s}=(0,b.useState)(!1),r=(0,w.Z)();return(0,H.jsx)(I.J,{sideOffset:4,alignAgainstAnchor:"end",triggerButton:(0,H.jsx)("div",{className:"group",children:n}),className:"z-10",size:"none",children:(0,H.jsxs)("div",{className:"flex max-w-sm flex-col gap-3 p-4",children:[(0,H.jsx)("div",{className:"text-token-text-secondary",children:(0,H.jsx)(z.Z,{id:"imageEditorControls.promptPopoverLabel",defaultMessage:"Prompt"})}),(0,H.jsx)("div",{children:t}),(0,H.jsx)("div",{children:(0,H.jsx)(k.z,{color:"secondary",disabled:a,onClick:()=>{s(!0),(0,L.v)(t),setTimeout(()=>s(!1),2e3)},icon:O.TIy,children:a?r.formatMessage({id:"imageEditorControls.copiedButtonLabel",defaultMessage:"Copied!"}):r.formatMessage({id:"imageEditorControls.copyButtonLabel",defaultMessage:"Copy"})})})]})})}function V(e){let{children:t,tooltip:n,disabled:a,onClick:s}=e,r=(0,H.jsx)("button",{className:(0,Z.default)("rounded p-2 font-semibold hover:bg-token-main-surface-tertiary group-radix-state-open:bg-token-main-surface-tertiary",a?"text-token-text-quaternary":"text-token-text-secondary"),disabled:a,onClick:s,children:t});return null!=n?(0,H.jsx)(E.u,{label:n,sideOffset:4,children:r}):r}function Q(e){let{imageAsset:t,setMode:n,messageId:a,serverThreadId:s,disabled:r}=e,i=(0,w.Z)(),o=(0,S.qg)(S.pm.DalleEditingOnboarding),l=o.eligible&&!o.isLoading,d=(0,H.jsx)(V,{tooltip:l?void 0:i.formatMessage({id:"imageEditorControls.inpaintButtonTooltip",defaultMessage:"Select"}),onClick:()=>{n(F.Inpaint),A.m9.logEvent("chatgpt_dalle_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false"}),T.A.logEvent(_.M.dalleImageClickInpaint,{conversationId:s,messageId:a,generationId:t.metadata?.dalle?.gen_id,fileId:(0,C.Iy)(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op})},disabled:r,children:(0,H.jsx)(D.GN,{})});return l?(0,H.jsx)(M.v,{show:!0,side:"bottom",sideOffset:0,title:i.formatMessage({id:"imageEditorNUX.title",defaultMessage:"Select area of the image to edit"}),description:i.formatMessage({id:"imageEditorNUX.description",defaultMessage:"Highlight the area and describe changes in chat."}),onDismiss:o.markAsViewed,children:(0,H.jsx)("div",{children:d})}):d}let X=B.Z.div`mx-3 w-[1px] h-6 bg-token-border-light`,J=B.Z.div`rounded-full border-2 border-token-text-secondary`;function K(e){let{mode:t,imageIndex:n,allImages:a,onSwitchImage:s,isLoadingNewImage:r}=e,i=n>0,o=(0,b.useCallback)(()=>{i&&s(a[n-1])},[i,a,n,s]),l=n<a.length-1,d=(0,b.useCallback)(()=>{l&&s(a[n+1])},[l,a,n,s]);return(0,b.useEffect)(()=>{function e(e){e.target instanceof HTMLTextAreaElement||t!==F.Default||("ArrowLeft"===e.key?o():"ArrowRight"===e.key&&d())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,o,d]),(0,H.jsx)("div",{className:"flex h-16 w-full items-center justify-center gap-3 font-semibold text-token-text-secondary",children:t===F.Inpaint?!r&&(0,H.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,H.jsx)(z.Z,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),(0,H.jsx)("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:(0,H.jsx)(O.szr,{className:"icon-md"})})]}):a.length>1?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:o,children:(0,H.jsx)(O.DUf,{className:"icon-lg"})}),(0,H.jsx)("div",{children:(0,H.jsx)(z.Z,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:n+1,numImages:a.length}})}),(0,H.jsx)("button",{disabled:!l,className:"disabled:text-token-text-tertiary",onClick:d,children:(0,H.jsx)(O.ob9,{className:"icon-lg"})})]}):null})}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach(function(t){(0,v.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ee(e){let{imageAsset:t,children:n,containerDimensions:a,isLoadingNewImage:s}=e;return(0,H.jsxs)(R.E.div,Y(Y({className:"absolute",style:function(e,t){let{width:n,height:a}=e,{width:s,height:r}=t,i=s-0,o=r-128,l=n/a,d=l>i/o,c=d?i:o*l,u=d?i/l:o;return{top:(r-u)/2,left:(s-c)/2,width:c,height:u}}(t,a)},N.e),{},{children:[n,(0,H.jsx)("div",{className:(0,Z.default)("absolute inset-0 flex items-center justify-center bg-token-main-surface-primary transition-opacity duration-1000",s?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]}))}let et=j()(()=>Promise.all([n.e(7806),n.e(345),n.e(1100)]).then(n.bind(n,73216)).then(e=>e.DynamicDrawingCanvas),{loadableGenerated:{webpack:()=>[73216]}});function en(e){let{clientThreadId:t,messageId:n,image:a,allImages:r}=e,d=(0,g.oq)(t),u=(0,g.uj)(t,d),p=u?.messages[u.messages.length-1],j=null!=p&&(0,m.rH)(p.message)===m.Cs.Dalle&&!(0,c.We)(p.message),w=(0,h.NL)();return(0,b.useEffect)(()=>{async function e(e,t){try{let n=await (0,l.Mn)(w,e);i.RT.setFocusedObject({type:o.z.Image,image:n[0],allImages:n,messageId:t})}catch(e){x.U.addError(Error("Failed to load newly created images:",{cause:e}))}}null!=p&&(0,m.rH)(p.message)===m.Cs.DalleTool&&p.message.content.content_type===s.PX.MultimodalText&&e(f.U.getImageAssetPointers(p.message),p.message.id)},[w,p]),(0,H.jsx)(ea,{image:a,allImages:r,isLoadingNewImage:j,clientThreadId:t,messageId:n})}function ea(e){let{image:t,allImages:n,isLoadingNewImage:a,clientThreadId:s,messageId:c}=e,{0:g,1:m}=(0,b.useState)(F.Default),{0:f,1:h}=(0,b.useState)({width:window.innerWidth-r.J,height:window.innerHeight}),x=(0,b.useRef)(null),{0:p,1:j}=(0,b.useState)(136),v=function(){let{0:e,1:t}=(0,b.useState)({undoStack:[],currentIndex:-1});return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:function(e){t(t=>({undoStack:[...t.undoStack.slice(0,t.currentIndex+1),e],currentIndex:t.currentIndex+1}))},canUndoDrawing:e.currentIndex>=0,undoDrawing:function(){t(e=>({undoStack:e.undoStack,currentIndex:Math.max(e.currentIndex-1,-1)}))},canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:function(){t(e=>({undoStack:e.undoStack,currentIndex:Math.min(e.currentIndex+1,e.undoStack.length-1)}))},clearAllDrawings:function(){t({undoStack:[],currentIndex:-1})}}}(),{currentDrawnShape:k,onNewDrawnShape:I,clearAllDrawings:E}=v,O=(0,b.useRef)(null),C=(0,w.Z)(),{setTargetedContent:N}=(0,u.Q)();(0,b.useEffect)(()=>{let e=new ResizeObserver(e=>{let{width:t,height:n}=e[0].contentRect;h({width:t,height:n})});return x.current&&e.observe(x.current),()=>{e.disconnect()}},[]),(0,b.useEffect)(()=>{function e(e){"Escape"===e.key&&(g===F.Inpaint?m(F.Default):i.RT.close())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[g]),(0,b.useEffect)(()=>(null==k?N({type:"object",placeholderTextOverride:(0,y.Em)({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:e=>(0,d.$K)(e,t)}):N({type:"object",label:C.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async e=>await (0,d.hx)(e,t,O.current?.getImageData(),C),onCleared:()=>m(F.Default)}),()=>{N(void 0)}),[t,C,N,k]),(0,b.useEffect)(()=>{g!==F.Inpaint&&E()},[g]),(0,b.useEffect)(()=>{m(F.Default)},[t]);let D=n.findIndex(e=>e.asset_pointer===t.asset_pointer);return(0,H.jsxs)("div",{ref:x,className:"flex h-full w-full flex-col justify-between",children:[(0,H.jsx)(W,{imageAsset:t,mode:g,setMode:m,clientThreadId:s,messageId:c,cursorWidth:p,setCursorWidth:j,inpaintingDrawingState:v,isLoadingNewImage:a}),(0,H.jsx)(K,{mode:g,imageIndex:D,allImages:n,onSwitchImage:e=>{i.RT.setFocusedObject({type:o.z.Image,image:e,allImages:n,messageId:c})},isLoadingNewImage:a}),(0,H.jsxs)(ee,{imageAsset:t,containerDimensions:f,isLoadingNewImage:a,children:[(0,H.jsx)(l.sH,{className:"h-full w-full",alt:(0,d.hG)(t),src:t.url,width:t.width,height:t.height,fadeIn:!1}),g===F.Inpaint&&(0,H.jsx)("div",{className:"absolute inset-0",children:(0,H.jsx)(et,{drawingCanvasRef:O,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:p,canvasWidth:t.width,canvasHeight:t.height,currentDrawnShape:k,onNewDrawnShape:I})})]})]})}}}]);
//# sourceMappingURL=2314.9c49ce9998f72fd1.js.map