"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5418],{39358:function(e,t,r){r.d(t,{Z:function(){return b}});var s=r(98601),n=r(92379),a=r(47584),l=r(75325),o=r(15478),i=r(15174),c=r(30853),d=r(82164),u=r(651);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let f=(0,a.vU)({copy:{id:"CopyButton.copy",defaultMessage:"Copy"},copied:{id:"CopyButton.copied",defaultMessage:"Copied!"}});function b(e){let{buttonText:t,shouldChangeText:r=!0,iconClassName:s="icon-sm",onCopy:a,className:o}=e,{0:m,1:b}=(0,n.useState)(!1),h=(0,i.Z)(),g=(0,n.useCallback)(e=>{e.stopPropagation(),a(),b(!0),setTimeout(()=>{h()&&b(!1)},2e3)},[h,a]),j=t;return r&&m?j=(0,u.jsx)(l.Z,x({},f.copied)):!0===t&&(j=(0,u.jsx)(l.Z,x({},f.copy))),(0,u.jsxs)(u.Fragment,{children:[!m&&(0,u.jsx)(c.u,{label:(0,u.jsx)(l.Z,{id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),sideOffset:0,children:(0,u.jsxs)(p,{onClick:g,className:o,children:[(0,u.jsx)(d.TIy,{className:s}),j]})}),m&&(0,u.jsxs)(p,{className:o,children:[(0,u.jsx)(d.$As,{className:s}),j]})]})}let p=o.Z.button`flex gap-1 items-center`},88301:function(e,t,r){r.d(t,{B1:function(){return c},hj:function(){return d},lX:function(){return m},r:function(){return x},yt:function(){return u}});var s=r(82164),n=r(30853),a=r(19841),l=r(75325),o=r(15478),i=r(651);let c=o.Z.textarea`w-full text-sm overflow-y-auto rounded-lg border px-3 py-2 focus:ring-2 focus:ring-blue-400 border-token-border-medium bg-token-main-surface-primary h-32`,d=o.Z.div`mb-6`,u=o.Z.input`w-full resize-none overflow-y-auto rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 border focus:ring-blue-400 border-token-border-medium h-9 bg-token-main-surface-primary`;function m(e){let{label:t,description:r,collapsed:a,onClick:l}=e,o=(0,i.jsx)("label",{className:"block font-semibold text-token-text-primary",children:t});return(0,i.jsxs)("div",{className:"mb-1.5 flex items-center",onClick:l,children:[void 0!==a&&(a?(0,i.jsx)(s.r0F,{className:"icon-sm"}):(0,i.jsx)(s.Tg4,{className:"icon-sm"})),r?(0,i.jsx)(n.u,{label:r,sideOffset:4,side:"top",delayDuration:0,children:o}):(0,i.jsx)(i.Fragment,{children:o})]})}function x(e){let{actionTool:t,onShowActionsEditor:r,isDisabled:n}=e,o="metadata"in t?t.metadata?.domain:void 0;return(0,i.jsxs)("div",{className:(0,a.default)("flex rounded-lg border border-token-border-medium text-sm hover:cursor-pointer",n?"bg-token-main-surface-secondary":""),onClick:r,children:[(0,i.jsx)("div",{className:"h-9 grow px-3 py-2",children:o??(0,i.jsx)("span",{className:"text-red-500",children:(0,i.jsx)(l.Z,{id:"TJYXrY",defaultMessage:"Invalid action"})})}),(0,i.jsx)("div",{className:"w-px bg-token-border-medium"}),(0,i.jsx)("button",{disabled:n,className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none",children:(0,i.jsx)(s.SWE,{className:"icon-sm"})})]})}},65418:function(e,t,r){r.r(t),r.d(t,{DebugConversation:function(){return ed},DebugConversationSidebar:function(){return ec},OpenDebugSidebarButton:function(){return es},default:function(){return en},downloadMessages:function(){return eu}});var s=r(98601),n=r(16757),a=(r(34095),r(55963)),l=r(88301),o=(r(2721),r(93951)),i=r(92745),c=r(31438),d=r(22433),u=r(93180),m=r(46900),x=(r(66290),r(30757)),f=(r(56032),r(42420)),b=r(79746),p=r(88667),h=r(2423),g=r.n(h),j=r(38482),v=r.n(j),y=r(92379),w=r(49764),N=r(75325),k=r(47584),C=r(67526),S=r(75592),O=r(75853),_=r(15478),P=r(11550),D=r(39358),I=r(94273),T=r(75130),Z=r(651);function F(e){let{children:t,sidebarOpen:r,onClose:s}=e;return(0,Z.jsx)(I.u.Root,{show:r,as:y.Fragment,children:(0,Z.jsxs)(T.V,{as:"div",className:"relative z-10",onClose:s,children:[(0,Z.jsx)("div",{className:"fixed inset-0"}),(0,Z.jsx)("div",{className:"fixed inset-0 overflow-hidden",children:(0,Z.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,Z.jsx)("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:(0,Z.jsx)(I.u.Child,{as:y.Fragment,enter:"transform transition ease-in-out duration-100 sm:duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-300 sm:duration-500",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:(0,Z.jsx)(T.V.Panel,{className:"pointer-events-auto w-screen max-w-md border-l border-gray-100 dark:border-gray-700",children:(0,Z.jsx)("div",{className:"h-full overflow-y-auto bg-token-main-surface-primary shadow-xl",children:t})})})})})})]})})}var R=r(30853),L=r(30115),M=r(82164),U=r(24434),E=r(73468),A=r(89678),z=r.n(A),V=r(13859),Q=r.n(V),$=r(24740),B=r(88815);function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function q(e){let{clientThreadId:t}=e,{rebaseSystemMessageContent:r,showDebugConversationTurns:s}=(0,B.N)(),{0:l,1:o}=(0,y.useState)(()=>r?JSON.stringify(r,null,2):void 0),{0:c,1:d}=(0,y.useState)(!!r),u=(0,i.u9)(t,i.tQ.getThreadCurrentLeafId(t)),m=Q()(u,e=>e.content.content_type===n.PX.SystemContent),x=m?.content??null,f=(0,y.useMemo)(()=>z()(e=>{try{e?B.N.setState({rebaseSystemMessageContent:G(G({},JSON.parse(e)),{},{content_type:n.PX.SystemContent})}):B.N.setState({rebaseSystemMessageContent:null}),$.m.closeAll()}catch(e){$.m.danger("The System Message is not valid JSON")}},500),[]);return(0,y.useEffect)(()=>{c?f(l):(f.cancel(),B.N.setState({rebaseSystemMessageContent:null}))},[f,c,l]),(0,Z.jsxs)("div",{className:"flex flex-col gap-3 px-4",children:[(0,Z.jsxs)("div",{children:[(0,Z.jsxs)("div",{className:"flex justify-between",children:[(0,Z.jsx)(R.u,{label:"Enable to apply this system message to the current conversation.",children:(0,Z.jsx)(a.Z,{id:"enabled",label:"Enabled",checked:c,onChange:e=>d(e.currentTarget.checked)})}),(0,Z.jsx)(a.Z,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:s,onChange:()=>{B.N.setState({showDebugConversationTurns:!s})}})]}),(0,Z.jsx)(P.z,{disabled:!x,className:"mt-2",onClick:()=>{o(x?JSON.stringify(x,null,2):"")},size:"small",children:"Load active system message"})]}),(0,Z.jsxs)("div",{children:[(0,Z.jsx)("label",{className:"text-sm",children:"System Message"}),(0,Z.jsx)(X,{disabled:!c,placeholder:x?"Press `Load active system message` to pre-populate this":"Start a conversation and then press `Load active system message` to pre-populate this",className:"min-h-[75vh] rounded-md border border-gray-400 p-1 font-mono",value:l,onChange:e=>o(e.target.value)})]})]})}let X=_.Z.textarea`w-full rounded-lg border border-token-border-light bg-token-main-surface-primary text-sm text-token-text-primary focus:border-token-text-primary focus:shadow-none focus:outline-none focus:ring-token-text-primary disabled:bg-token-main-surface-tertiary`;var Y=r(19841);function W(e){let{clientThreadId:t}=e,{0:r,1:s}=(0,y.useState)([]),a=i.tQ.getThreadCurrentLeafId(t),l=i.tQ.getThreadConversationTurns(t,a),o=e=>{let r=i.tQ.getTree(t).getLeafFromNode(e);i.tQ.setThreadCurrentLeafId(t,r.id)},c=e=>{s(e=>[...e,a]),o(e)};return(0,Z.jsxs)(Z.Fragment,{children:[r.length>0&&(0,Z.jsxs)(P.z,{className:"absolute left-2 top-2",color:"secondary",onClick:()=>{o(r[r.length-1]),s(e=>e.slice(0,-1))},children:[(0,Z.jsx)(M.eF8,{className:"icon-sm"}),"Go back to ",r[r.length-1]]}),(0,Z.jsx)("div",{className:"flex flex-col items-center gap-4 overflow-auto p-4 text-xs",children:l.map((e,r)=>{let s;let a=e.messages[0].nodeId,l=i.tQ.getTree(t),o=0!==r?l.getParent(a):null,u=null!=o?o.children.findIndex(e=>a===e):0,m=null!=o?o.children:[],x=m.slice(0,u),f=m.slice(u+1);switch(e.role){case n.uU.User:s="bg-blue-500";break;case n.uU.Assistant:s="bg-gray-600";break;default:s="bg-gray-400"}return(0,Z.jsxs)("div",{className:(0,Y.default)("relative p-2",s),children:[(0,Z.jsx)("div",{className:"absolute bottom-0 left-0 -ml-2 flex -translate-x-full gap-2 pl-2",children:x.map(e=>(0,Z.jsx)(H,{variantId:e,onChangeItemInView:c},e))}),(0,Z.jsx)("div",{className:"absolute left-full top-0 ml-2 flex gap-2 pr-2",children:f.map(e=>(0,Z.jsx)(H,{variantId:e,onChangeItemInView:c},e))}),(0,Z.jsx)("div",{className:"flex flex-col gap-2",children:e.messages.map(e=>(0,Z.jsxs)("div",{className:"h-14 w-32 truncate bg-gray-200 p-1 text-black",children:[(0,Z.jsx)("div",{className:"font-semibold",children:e.nodeId}),(0,Z.jsx)("div",{className:"italic text-token-text-tertiary",children:e.message.author.role}),(0,Z.jsx)("div",{children:(0,d.RR)(e.message)})]},e.nodeId))})]},r)})})]})}function H(e){let{variantId:t,onChangeItemInView:r}=e;return(0,Z.jsx)("button",{className:"w-32 truncate bg-gray-400 p-2 text-black opacity-50 hover:opacity-100",onClick:()=>{r(t)},children:(0,Z.jsx)("span",{className:"bg-gray-200 p-2",children:t})},t)}function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let et=v()(()=>Promise.all([r.e(6923),r.e(1981),r.e(6925),r.e(1502)]).then(r.bind(r,19042)).then(e=>e.DebugModalContents),{ssr:!1,loadableGenerated:{webpack:()=>[19042]}}),er=v()(()=>r.e(1583).then(r.bind(r,51583)).then(e=>e.FramesViewer),{ssr:!1,loadableGenerated:{webpack:()=>[51583]}});function es(){return(0,Z.jsx)("button",{className:"flex h-6 w-6 items-center justify-center rounded-full border border-token-border-light text-xs text-token-text-secondary",onClick:()=>{c.vm.setActiveSidebar("debug")},children:(0,Z.jsx)(M.reV,{className:"icon-xs"})})}function en(e){let{children:t,title:r,icon:s,isOpen:n,slideOver:a,onClose:l}=e,o=(0,Z.jsxs)(eb,{children:[(0,Z.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Z.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 text-lg font-semibold text-gray-900 dark:text-white",children:[(0,Z.jsx)(s,{className:"icon-sm"}),r]}),(0,Z.jsx)("div",{className:"mr-2 mt-2 flex h-7 items-center",children:(0,Z.jsx)(L.P,{onClick:l})})]}),t]});return a?(0,Z.jsx)(F,{sidebarOpen:n,onClose:l,children:o}):n?o:null}function ea(e){let{nodes:t,setDebugNodeIndex:r,setFrameSrc:s}=e,a=t.map((e,t)=>{let a=e.message,{role:l,name:o}=a.author,i=g()(a,"metadata.__internal.model_id"),c=g()(a,"metadata.__internal.agent.settings.completion_api.engine"),u=g()(a,"metadata.__internal.model_experiment_name"),x=g()(a,"metadata.__internal.model_experiment_treatment"),f=g()(a,"metadata.__internal.normalized_model_side"),b=g()(a,"metadata.__internal.model_experiment_group_name"),p=g()(a,"metadata.__internal.model_experiment_group_params"),h=g()(a,"metadata.__internal.model_experiment_override"),j=g()(a,"metadata.__internal.model_experiment_eval_seq"),v=g()(a,"metadata.__internal.raw_tokens")?.length,y=g()(a,"metadata.request_id"),w=m.U.getAudio(a),N=m.U.getAudioAssetPointers(a),k=m.U.getFrameAssetPointers(a);return(0,Z.jsxs)(eh,{role:"button",onClick:()=>r(t),children:[(0,Z.jsxs)("div",{className:"text-xs font-semibold uppercase text-token-text-tertiary",children:[l,o&&o!==l&&` (${o})`,a.recipient&&" -> ",(0,d.Ej)(a)]}),(a.author.role!==n.uU.System||y)&&(0,Z.jsxs)("div",{className:"text-xs text-token-text-tertiary",children:[(0,Z.jsxs)("div",{children:["ID: ",a.id]}),e.id!==a.id&&(0,Z.jsxs)("div",{children:["UI Node ID: ",e.id]}),(0,Z.jsxs)("div",{children:["Req ID: ",y||"Reload page to see ID"]})]}),(0,Z.jsx)("div",{className:"line-clamp-6",children:(0,d.RR)(a)}),(v||i||c||u||x||f||b||p||h||j)&&(0,Z.jsxs)("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[void 0!==v&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Tokens Count:"})," ",v]}),i&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Model ID:"})," ",i]}),c&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Engine:"})," ",c]}),u&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Experiment:"})," ",u]}),x&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Treatment:"})," ",x]}),f&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Normalized Side:"})," ",f]}),b&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Group Name:"})," ",b]}),p&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Group Params:"}),(0,Z.jsx)("div",{children:JSON.stringify(p,null,2)})]}),h&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Above Params are Overridden By:"})," ",h]}),j&&(0,Z.jsxs)("div",{children:[(0,Z.jsx)("b",{children:"Experiment Eval Seq:"})," click to see"]})]}),w.length||N.length?(0,Z.jsxs)("div",{className:"mt-4 flex flex-col flex-nowrap gap-2",children:[(0,Z.jsx)(ex,{frameAssets:k,setFrameSrc:s},t),w.map((e,t)=>(0,Z.jsx)(ef,{audio:e},t)),N.map((e,t)=>(0,Z.jsx)(ef,{assetPointer:e},t))]}):null]},a.id)});return(0,Z.jsx)(ep,{children:a})}let el=e=>(0,Z.jsx)(C.c.Input,ee(ee({},e),{},{inputClassName:"focus:ring-0"}));function eo(){let e=(0,B.N)(),t=(0,E.ZP)().map(e=>({label:e.name,options:e.options.map(e=>({label:`${e.value} (${e.name})`,value:e.value}))}));return(0,Z.jsxs)("div",{className:"mt-2 flex flex-col justify-around gap-3 px-4 py-1 text-xs font-semibold",children:[(0,Z.jsx)(a.Z,{id:"force-paragen",label:"Force Parallel Gen",checked:e.forceParagen,onChange:()=>{B.N.setState({forceParagen:!e.forceParagen})}}),(0,Z.jsx)(O.Z,{options:t,name:"force-paragen-model",className:"shadow-none dark:text-gray-800",isDisabled:!e.forceParagen,isLoading:0===t.length,value:e.forceParagenModel,isClearable:!0,isMulti:!1,components:{Input:el},onChange:e=>{B.N.setState({forceParagenModel:e??B.J})}}),(0,Z.jsx)(a.Z,{id:"force-paragen",label:"Force Nulligen",checked:e.forceNulligen,onChange:()=>{B.N.setState({forceNulligen:!e.forceNulligen})}}),(0,Z.jsx)("div",{id:"force-use-search-label",children:"Force Use Search:"}),(0,Z.jsx)(S.ZP,{id:"force-use-search",options:[{label:"Default",value:"default"},{label:"Force",value:"true"},{label:"Disable",value:"false"}],name:"force-use-search",className:"shadow-none dark:text-gray-800",value:null==e.forceUseSearch?{value:"default",label:"Default"}:e.forceUseSearch?{value:"true",label:"Force"}:{value:"false",label:"Disable"},isMulti:!1,components:{Input:el},onChange:e=>{B.N.setState({forceUseSearch:(e?.value??"default")==="default"?null:e?.value==="true"})}}),(0,Z.jsx)(a.Z,{id:"force-indepth-feedback",label:"Force Indepth Feedback with prompt:",checked:e.forceIndepthFeedback,onChange:()=>{B.N.setState({forceIndepthFeedback:!e.forceIndepthFeedback})}}),(0,Z.jsx)(l.B1,{id:"force-indepth-feedback-prompt",value:e.forceIndepthFeedbackPrompt,disabled:!e.forceIndepthFeedback,className:"font-weight-normal font-mono text-xs",onChange:e=>{B.N.setState({forceIndepthFeedbackPrompt:e.target.value})}}),(0,Z.jsx)(a.Z,{id:"force-rate-limit",label:"Force Rate Limit",checked:e.forceRateLimit,onChange:()=>{B.N.setState({forceRateLimit:!e.forceRateLimit})}}),(0,Z.jsx)(a.Z,{id:"reset-rate-limit",label:"Reset Rate Limits",checked:e.resetRateLimits,onChange:()=>{B.N.setState({resetRateLimits:!e.resetRateLimits})}}),(0,Z.jsx)(R.u,{label:"Enabling this will show debug conversation messages in the chat",children:(0,Z.jsx)(a.Z,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:e.showDebugConversationTurns,onChange:()=>{B.N.setState({showDebugConversationTurns:!e.showDebugConversationTurns})}})})]})}let ei=_.Z.div`px-3 pb-2 text-xs font-semibold uppercase border-b-2 ${e=>{let{$isSelected:t}=e;return t?"border-black dark:border-white":"border-transparent"}}`;function ec(e){let{clientThreadId:t,isOpen:r,slideOver:s,onClose:n}=e,a=(0,w.Z)(),l=(0,o.hz)(),{0:i,1:c}=(0,y.useState)("conversation");return l?.includes("debug")?(0,Z.jsx)(en,{icon:M.reV,title:a.formatMessage(eg.debugTitle),isOpen:r,slideOver:s,onClose:n,children:(0,Z.jsxs)(x.fC,{orientation:"vertical",defaultValue:i,onValueChange:e=>c(e),children:[(0,Z.jsxs)(x.aV,{className:"flex items-center justify-center gap-2 px-4 py-1 text-xs font-semibold",children:[(0,Z.jsx)(x.xz,{value:"conversation",children:(0,Z.jsx)(ei,{$isSelected:"conversation"===i,children:"Conversation"})}),(0,Z.jsx)(x.xz,{value:"system-message-editor",className:"p-4",children:(0,Z.jsx)(ei,{$isSelected:"system-message-editor"===i,children:"System Message Editor"})})]}),(0,Z.jsx)(x.VY,{value:"conversation",children:(0,Z.jsx)(ed,{clientThreadId:t})}),(0,Z.jsx)(x.VY,{value:"system-message-editor",children:(0,Z.jsx)(q,{clientThreadId:t})})]})}):null}function ed(e){let{clientThreadId:t}=e,r=(0,w.Z)(),s=i.tQ.getThreadCurrentLeafId(t),n=(0,i.Fe)(t,s),{0:a,1:l}=(0,y.useState)(),c=(0,o.hz)(),d=(0,y.useCallback)(()=>{l(void 0)},[]),u=(0,y.useCallback)(()=>{let e=i.tQ.getTree(t);(0,b.v)(e.getTextFromThread(s))},[s,t]),{0:m,1:x}=(0,y.useState)(!1),{0:f,1:p}=(0,y.useState)(void 0);return c?.includes("debug")?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{className:"mb-2 flex items-center justify-around px-4 py-1 text-xs font-semibold uppercase",children:(0,Z.jsx)(em,{clientThreadId:t,messages:n.map(e=>e.message)})}),!1,(0,Z.jsxs)("div",{className:"flex items-center justify-around gap-2 px-4 py-1 text-xs font-semibold uppercase",children:[(0,Z.jsx)("div",{children:(0,Z.jsx)(D.Z,{onCopy:u,buttonText:r.formatMessage(eg.copyText)})}),(0,Z.jsxs)("button",{className:"flex items-center justify-center gap-2",onClick:()=>x(!0),children:[(0,Z.jsx)(M.aAc,{className:"icon-sm rotate-90"}),"View tree"]})]}),(0,Z.jsx)(eo,{}),(0,Z.jsx)(ea,{nodes:n,setDebugNodeIndex:l,setFrameSrc:p}),void 0!==a&&(0,Z.jsx)(U.Z,{type:"success",size:"fullscreen",noPadding:!0,isOpen:!0,onClose:d,children:(0,Z.jsx)(et,{threadId:n[a].message.metadata?.__internal?.sonic_thread_id,threadUserId:n[a].message.metadata?.__internal?.sonic_user_id,onClose:d,message:n[a].message})},`DebugMessageModal-${a}`),m&&(0,Z.jsx)(U.Z,{isOpen:!0,onClose:()=>x(!1),type:"success",size:"custom",noPadding:!0,children:(0,Z.jsx)(W,{clientThreadId:t})},"DebugTreeViewer"),f&&(0,Z.jsx)(U.Z,{size:"normal",isOpen:!0,onClose:()=>p(void 0),type:"success",children:(0,Z.jsx)("img",{src:f,alt:"debug image"})},"DebugFrameViewer")]}):null}function eu(e,t){let r=new Blob([JSON.stringify({conversation_id:i.tQ.getServerThreadId(e),messages:t},null,2)],{type:"application/json"}),s=URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download=`messages-${i.tQ.getServerThreadId(e)}.json`,n.click(),URL.revokeObjectURL(s)}function em(e){let{clientThreadId:t,messages:r}=e,s=(0,y.useCallback)(()=>{eu(t,r)},[t,r]);return(0,Z.jsx)(P.z,{onClick:s,color:"primary",size:"small",icon:M._8t,children:(0,Z.jsx)(N.Z,ee({},eg.downloadRawConversation))})}function ex(e){let{0:t,1:r}=(0,y.useState)([]),s=(0,f.NL)(),{frameAssets:n}=e;return(0,y.useEffect)(()=>{async function e(){return Promise.all(n.map(async e=>{let{image_asset_pointer:t,timestamp:r}=e;return{src:(await u.j.fetch(s,{asset:t})).url,timestamp:r}}))}n.length>0&&e().then(r)},[n,s]),(0,Z.jsx)(er,{frames:t,setFrameSrc:e.setFrameSrc})}function ef(e){let t=ef.useAssetPointerSource(e.assetPointer),r=ef.useAudioSource(e.audio),s=t??r,n=(0,p.xb)("3230069703").config.value.expirySeconds,{0:a,1:l}=(0,y.useState)(Date.now()),o=(0,y.useRef)(null);return((0,y.useEffect)(()=>{let e=setInterval(()=>{o.current&&o.current.currentTime>0&&!o.current.paused&&!o.current.ended&&o.current.readyState>2||l(Date.now())},1e3*n);return()=>clearInterval(e)},[n]),s)?(0,Z.jsx)("audio",{ref:o,controls:!0,src:s,className:"w-full"},a):null}ef.useAssetPointerSource=e=>{let{0:t,1:r}=(0,y.useState)(null),s=(0,f.NL)();return(0,y.useEffect)(()=>{e&&u.j.fetch(s,{asset:e}).then(e=>{r(e.url)})},[s,e]),t},ef.useAudioSource=e=>{let{0:t,1:r}=(0,y.useState)(null);return(0,y.useEffect)(()=>{if(e){let t=atob(e.payload),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);let n=new Blob([s],{type:`audio/${e.format}`}),a=URL.createObjectURL(n);return r(a),()=>{URL.revokeObjectURL(a)}}},[e]),t};let eb=_.Z.div`overflow-y-auto h-full md:w-[250px] lg:w-[300px] xl:w-[350px] 2xl:w-[400px] md:border-l md:border-gray-100 md:dark:border-gray-700 popover bg-token-main-surface-primary`,ep=_.Z.pre`whitespace-pre-wrap text-sm`,eh=_.Z.div`px-6 py-4 flex flex-col gap-1 hover:bg-gray-50 dark:hover:bg-gray-500/10 cursor-pointer border-b dark:border-white/10 border-gray-200`,eg=(0,k.vU)({debugTitle:{id:"DebugSidebar.debugTitle",defaultMessage:"Debug"},copyText:{id:"DebugSidebar.copyText",defaultMessage:"Copy text"},downloadRawConversation:{id:"DebugSidebar.downloadRawConversation",defaultMessage:"Download raw conversation"},uploadRawConversation:{id:"DebugSidebar.uploadRawConversation",defaultMessage:"Upload conversation dump"},closeSidebar:{id:"DebugSidebar.closeSidebar",defaultMessage:"Close sidebar"}})}}]);
//# sourceMappingURL=5418.e70931d9630f9cfe.js.map